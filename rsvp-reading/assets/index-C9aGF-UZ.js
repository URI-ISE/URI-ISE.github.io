var va=o=>{throw TypeError(o)};var Xn=(o,t,e)=>t.has(o)||va("Cannot "+e);var kt=(o,t,e)=>(Xn(o,t,"read from private field"),e?e.call(o):t.get(o)),je=(o,t,e)=>t.has(o)?va("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),me=(o,t,e,s)=>(Xn(o,t,"write to private field"),s?s.call(o,e):t.set(o,e),e),$e=(o,t,e)=>(Xn(o,t,"access private method"),e);var ba=(o,t,e,s)=>({set _(i){me(o,t,i,e)},get _(){return kt(o,t,s)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const ar=!1;var Cr=Array.isArray,Ql=Array.prototype.indexOf,Dn=Array.from,Zl=Object.defineProperty,ai=Object.getOwnPropertyDescriptor,po=Object.getOwnPropertyDescriptors,th=Object.prototype,eh=Array.prototype,Tr=Object.getPrototypeOf,ya=Object.isExtensible;function sh(o){return o()}function or(o){for(var t=0;t<o.length;t++)o[t]()}function go(){var o,t,e=new Promise((s,i)=>{o=s,t=i});return{promise:e,resolve:o,reject:t}}const te=2,An=4,Gi=8,mo=1<<24,us=16,fs=32,Gs=64,Pr=128,Oe=512,Zt=1024,ce=2048,Qe=4096,Pe=8192,os=16384,kr=32768,di=65536,wa=1<<17,vo=1<<18,yi=1<<19,bo=1<<20,bs=1<<25,js=32768,lr=1<<21,Mr=1<<22,ys=1<<23,Ns=Symbol("$state"),ih=Symbol("legacy props"),nh=Symbol(""),ti=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Rr(o){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function rh(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ah(o){throw new Error("https://svelte.dev/e/effect_in_teardown")}function oh(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function lh(o){throw new Error("https://svelte.dev/e/effect_orphan")}function hh(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ch(o){throw new Error("https://svelte.dev/e/props_invalid_value")}function dh(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function uh(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function fh(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ph(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const gh=1,mh=2,vh=16,bh=1,yh=2,wh=4,_h=8,Ah=16,Sh=1,Eh=2,Kt=Symbol(),xh="http://www.w3.org/1999/xhtml";function Ch(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function yo(o){return o===this.v}function Th(o,t){return o!=o?t==t:o!==t||o!==null&&typeof o=="object"||typeof o=="function"}function wo(o){return!Th(o,this.v)}let wi=!1,Ph=!1;function kh(){wi=!0}let Ct=null;function ui(o){Ct=o}function Es(o,t=!1,e){Ct={p:Ct,i:!1,c:null,e:null,s:o,x:null,l:wi&&!t?{s:null,u:null,$:[]}:null}}function xs(o){var t=Ct,e=t.e;if(e!==null){t.e=null;for(var s of e)Uo(s)}return t.i=!0,Ct=t.p,{}}function qi(){return!wi||Ct!==null&&Ct.l===null}let Rs=[];function _o(){var o=Rs;Rs=[],or(o)}function _i(o){if(Rs.length===0&&!Oi){var t=Rs;queueMicrotask(()=>{t===Rs&&_o()})}Rs.push(o)}function Mh(){for(;Rs.length>0;)_o()}function Ao(o){var t=wt;if(t===null)return ht.f|=ys,o;if((t.f&kr)===0){if((t.f&Pr)===0)throw o;t.b.error(o)}else fi(o,t)}function fi(o,t){for(;t!==null;){if((t.f&Pr)!==0)try{t.b.error(o);return}catch(e){o=e}t=t.parent}throw o}const Rh=-7169;function jt(o,t){o.f=o.f&Rh|t}function Dr(o){(o.f&Oe)!==0||o.deps===null?jt(o,Zt):jt(o,Qe)}function So(o){if(o!==null)for(const t of o)(t.f&te)===0||(t.f&js)===0||(t.f^=js,So(t.deps))}function Eo(o,t,e){(o.f&ce)!==0?t.add(o):(o.f&Qe)!==0&&e.add(o),So(o.deps),jt(o,Zt)}const ln=new Set;let St=null,yn=null,Ue=null,Ie=[],Ln=null,hr=!1,Oi=!1;class Ke{committed=!1;current=new Map;previous=new Map;#t=new Set;#e=new Set;#i=0;#s=0;#a=null;#r=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(t){Ie=[],yn=null,this.apply();var e=[],s=[];for(const i of t)this.#o(i,e,s);this.is_fork||this.#l(),this.is_deferred()?(this.#h(s),this.#h(e)):(yn=this,St=null,_a(s),_a(e),yn=null,this.#a?.resolve()),Ue=null}#o(t,e,s){t.f^=Zt;for(var i=t.first,n=null;i!==null;){var r=i.f,a=(r&(fs|Gs))!==0,l=a&&(r&Zt)!==0,h=l||(r&Pe)!==0||this.skipped_effects.has(i);if(!h&&i.fn!==null){a?i.f^=Zt:n!==null&&(r&(An|Gi|mo))!==0?n.b.defer_effect(i):(r&An)!==0?e.push(i):Si(i)&&((r&us)!==0&&this.#r.add(i),mi(i));var c=i.first;if(c!==null){i=c;continue}}var d=i.parent;for(i=i.next;i===null&&d!==null;)d===n&&(n=null),i=d.next,d=d.parent}}#h(t){for(var e=0;e<t.length;e+=1)Eo(t[e],this.#r,this.#n)}capture(t,e){e!==Kt&&!this.previous.has(t)&&this.previous.set(t,e),(t.f&ys)===0&&(this.current.set(t,t.v),Ue?.set(t,t.v))}activate(){St=this,this.apply()}deactivate(){St===this&&(St=null,Ue=null)}flush(){if(this.activate(),Ie.length>0){if(xo(),St!==null&&St!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const t of this.#e)t(this);this.#e.clear()}#l(){if(this.#s===0){for(const t of this.#t)t();this.#t.clear()}this.#i===0&&this.#u()}#u(){if(ln.size>1){this.previous.clear();var t=Ue,e=!0;for(const i of ln){if(i===this){e=!1;continue}const n=[];for(const[a,l]of this.current){if(i.current.has(a))if(e&&l!==i.current.get(a))i.current.set(a,l);else continue;n.push(a)}if(n.length===0)continue;const r=[...i.current.keys()].filter(a=>!this.current.has(a));if(r.length>0){var s=Ie;Ie=[];const a=new Set,l=new Map;for(const h of n)Co(h,r,a,l);if(Ie.length>0){St=i,i.apply();for(const h of Ie)i.#o(h,[],[]);i.deactivate()}Ie=s}}St=null,Ue=t}this.committed=!0,ln.delete(this)}increment(t){this.#i+=1,t&&(this.#s+=1)}decrement(t){this.#i-=1,t&&(this.#s-=1),this.revive()}revive(){for(const t of this.#r)this.#n.delete(t),jt(t,ce),hs(t);for(const t of this.#n)jt(t,Qe),hs(t);this.flush()}oncommit(t){this.#t.add(t)}ondiscard(t){this.#e.add(t)}settled(){return(this.#a??=go()).promise}static ensure(){if(St===null){const t=St=new Ke;ln.add(St),Oi||Ke.enqueue(()=>{St===t&&t.flush()})}return St}static enqueue(t){_i(t)}apply(){}}function Dh(o){var t=Oi;Oi=!0;try{for(var e;;){if(Mh(),Ie.length===0&&(St?.flush(),Ie.length===0))return Ln=null,e;xo()}}finally{Oi=t}}function xo(){var o=Us;hr=!0;var t=null;try{var e=0;for(En(!0);Ie.length>0;){var s=Ke.ensure();if(e++>1e3){var i,n;Lh()}s.process(Ie),ws.clear()}}finally{hr=!1,En(o),Ln=null}}function Lh(){try{hh()}catch(o){fi(o,Ln)}}let ns=null;function _a(o){var t=o.length;if(t!==0){for(var e=0;e<t;){var s=o[e++];if((s.f&(os|Pe))===0&&Si(s)&&(ns=new Set,mi(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?jo(s):s.fn=null),ns?.size>0)){ws.clear();for(const i of ns){if((i.f&(os|Pe))!==0)continue;const n=[i];let r=i.parent;for(;r!==null;)ns.has(r)&&(ns.delete(r),n.push(r)),r=r.parent;for(let a=n.length-1;a>=0;a--){const l=n[a];(l.f&(os|Pe))===0&&mi(l)}}ns.clear()}}ns=null}}function Co(o,t,e,s){if(!e.has(o)&&(e.add(o),o.reactions!==null))for(const i of o.reactions){const n=i.f;(n&te)!==0?Co(i,t,e,s):(n&(Mr|us))!==0&&(n&ce)===0&&To(i,t,s)&&(jt(i,ce),hs(i))}}function To(o,t,e){const s=e.get(o);if(s!==void 0)return s;if(o.deps!==null)for(const i of o.deps){if(t.includes(i))return!0;if((i.f&te)!==0&&To(i,t,e))return e.set(i,!0),!0}return e.set(o,!1),!1}function hs(o){for(var t=Ln=o;t.parent!==null;){t=t.parent;var e=t.f;if(hr&&t===wt&&(e&us)!==0&&(e&vo)===0)return;if((e&(Gs|fs))!==0){if((e&Zt)===0)return;t.f^=Zt}}Ie.push(t)}function Ih(o){let t=0,e=$s(0),s;return()=>{Ir()&&(m(e),Ai(()=>(t===0&&(s=et(()=>o(()=>Ni(e)))),t+=1,()=>{_i(()=>{t-=1,t===0&&(s?.(),s=void 0,Ni(e))})})))}}var Fh=di|yi|Pr;function Oh(o,t,e){new Nh(o,t,e)}class Nh{parent;is_pending=!1;#t;#e=null;#i;#s;#a;#r=null;#n=null;#o=null;#h=null;#l=null;#u=0;#d=0;#f=!1;#m=new Set;#p=new Set;#c=null;#g=Ih(()=>(this.#c=$s(this.#u),()=>{this.#c=null}));constructor(t,e,s){this.#t=t,this.#i=e,this.#s=s,this.parent=wt.b,this.is_pending=!!this.#i.pending,this.#a=Or(()=>{wt.b=this;{var i=this.#v();try{this.#r=Fe(()=>s(i))}catch(n){this.error(n)}this.#d>0?this.#S():this.is_pending=!1}return()=>{this.#l?.remove()}},Fh)}#b(){try{this.#r=Fe(()=>this.#s(this.#t))}catch(t){this.error(t)}}#w(){const t=this.#i.pending;t&&(this.#n=Fe(()=>t(this.#t)),Ke.enqueue(()=>{var e=this.#v();this.#r=this.#E(()=>(Ke.ensure(),Fe(()=>this.#s(e)))),this.#d>0?this.#S():(Bs(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#v(){var t=this.#t;return this.is_pending&&(this.#l=_s(),this.#t.before(this.#l),t=this.#l),t}defer_effect(t){Eo(t,this.#m,this.#p)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#i.pending}#E(t){var e=wt,s=ht,i=Ct;Je(this.#a),_e(this.#a),ui(this.#a.ctx);try{return t()}catch(n){return Ao(n),null}finally{Je(e),_e(s),ui(i)}}#S(){const t=this.#i.pending;this.#r!==null&&(this.#h=document.createDocumentFragment(),this.#h.append(this.#l),Vo(this.#r,this.#h)),this.#n===null&&(this.#n=Fe(()=>t(this.#t)))}#y(t){if(!this.has_pending_snippet()){this.parent&&this.parent.#y(t);return}if(this.#d+=t,this.#d===0){this.is_pending=!1;for(const e of this.#m)jt(e,ce),hs(e);for(const e of this.#p)jt(e,Qe),hs(e);this.#m.clear(),this.#p.clear(),this.#n&&Bs(this.#n,()=>{this.#n=null}),this.#h&&(this.#t.before(this.#h),this.#h=null)}}update_pending_count(t){this.#y(t),this.#u+=t,this.#c&&pi(this.#c,this.#u)}get_effect_pending(){return this.#g(),m(this.#c)}error(t){var e=this.#i.onerror;let s=this.#i.failed;if(this.#f||!e&&!s)throw t;this.#r&&(Ae(this.#r),this.#r=null),this.#n&&(Ae(this.#n),this.#n=null),this.#o&&(Ae(this.#o),this.#o=null);var i=!1,n=!1;const r=()=>{if(i){Ch();return}i=!0,n&&ph(),Ke.ensure(),this.#u=0,this.#o!==null&&Bs(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#r=this.#E(()=>(this.#f=!1,Fe(()=>this.#s(this.#t)))),this.#d>0?this.#S():this.is_pending=!1};var a=ht;try{_e(null),n=!0,e?.(t,r),n=!1}catch(l){fi(l,this.#a&&this.#a.parent)}finally{_e(a)}s&&_i(()=>{this.#o=this.#E(()=>{Ke.ensure(),this.#f=!0;try{return Fe(()=>{s(this.#t,()=>t,()=>r)})}catch(l){return fi(l,this.#a.parent),null}finally{this.#f=!1}})})}}function Bh(o,t,e,s){const i=qi()?In:Ds;if(e.length===0&&o.length===0){s(t.map(i));return}var n=St,r=wt,a=Uh();function l(){Promise.all(e.map(h=>Hh(h))).then(h=>{a();try{s([...t.map(i),...h])}catch(c){(r.f&os)===0&&fi(c,r)}n?.deactivate(),Sn()}).catch(h=>{fi(h,r)})}o.length>0?Promise.all(o).then(()=>{a();try{return l()}finally{n?.deactivate(),Sn()}}):l()}function Uh(){var o=wt,t=ht,e=Ct,s=St;return function(n=!0){Je(o),_e(t),ui(e),n&&s?.activate()}}function Sn(){Je(null),_e(null),ui(null)}function In(o){var t=te|ce,e=ht!==null&&(ht.f&te)!==0?ht:null;return wt!==null&&(wt.f|=yi),{ctx:Ct,deps:null,effects:null,equals:yo,f:t,fn:o,reactions:null,rv:0,v:Kt,wv:0,parent:e??wt,ac:null}}function Hh(o,t,e){let s=wt;s===null&&rh();var i=s.b,n=void 0,r=$s(Kt),a=!ht,l=new Map;return Kh(()=>{var h=go();n=h.promise;try{Promise.resolve(o()).then(h.resolve,h.reject).then(()=>{c===St&&c.committed&&c.deactivate(),Sn()})}catch(f){h.reject(f),Sn()}var c=St;if(a){var d=i.is_rendered();i.update_pending_count(1),c.increment(d),l.get(c)?.reject(ti),l.delete(c),l.set(c,h)}const u=(f,p=void 0)=>{if(c.activate(),p)p!==ti&&(r.f|=ys,pi(r,p));else{(r.f&ys)!==0&&(r.f^=ys),pi(r,f);for(const[g,b]of l){if(l.delete(g),g===c)break;b.reject(ti)}}a&&(i.update_pending_count(-1),c.decrement(d))};h.promise.then(u,f=>u(null,f||"unknown"))}),Bo(()=>{for(const h of l.values())h.reject(ti)}),new Promise(h=>{function c(d){function u(){d===n?h(r):c(n)}d.then(u,u)}c(n)})}function Ds(o){const t=In(o);return t.equals=wo,t}function Po(o){var t=o.effects;if(t!==null){o.effects=null;for(var e=0;e<t.length;e+=1)Ae(t[e])}}function zh(o){for(var t=o.parent;t!==null;){if((t.f&te)===0)return(t.f&os)===0?t:null;t=t.parent}return null}function Lr(o){var t,e=wt;Je(zh(o));try{o.f&=~js,Po(o),t=Yo(o)}finally{Je(e)}return t}function ko(o){var t=Lr(o);if(!o.equals(t)&&(o.wv=qo(),(!St?.is_fork||o.deps===null)&&(o.v=t,o.deps===null))){jt(o,Zt);return}As||(Ue!==null?(Ir()||St?.is_fork)&&Ue.set(o,t):Dr(o))}let cr=new Set;const ws=new Map;let Mo=!1;function $s(o,t){var e={f:0,v:o,reactions:null,equals:yo,rv:0,wv:0};return e}function gs(o,t){const e=$s(o);return Zh(e),e}function V(o,t=!1,e=!0){const s=$s(o);return t||(s.equals=wo),wi&&e&&Ct!==null&&Ct.l!==null&&(Ct.l.s??=[]).push(s),s}function x(o,t,e=!1){ht!==null&&(!He||(ht.f&wa)!==0)&&qi()&&(ht.f&(te|us|Mr|wa))!==0&&!ls?.includes(o)&&fh();let s=e?ei(t):t;return pi(o,s)}function pi(o,t){if(!o.equals(t)){var e=o.v;As?ws.set(o,t):ws.set(o,e),o.v=t;var s=Ke.ensure();if(s.capture(o,e),(o.f&te)!==0){const i=o;(o.f&ce)!==0&&Lr(i),Dr(i)}o.wv=qo(),Ro(o,ce),qi()&&wt!==null&&(wt.f&Zt)!==0&&(wt.f&(fs|Gs))===0&&(Le===null?tc([o]):Le.push(o)),!s.is_fork&&cr.size>0&&!Mo&&jh()}return t}function jh(){Mo=!1;var o=Us;En(!0);const t=Array.from(cr);try{for(const e of t)(e.f&Zt)!==0&&jt(e,Qe),Si(e)&&mi(e)}finally{En(o)}cr.clear()}function Aa(o,t=1){var e=m(o),s=t===1?e++:e--;return x(o,e),s}function Ni(o){x(o,o.v+1)}function Ro(o,t){var e=o.reactions;if(e!==null)for(var s=qi(),i=e.length,n=0;n<i;n++){var r=e[n],a=r.f;if(!(!s&&r===wt)){var l=(a&ce)===0;if(l&&jt(r,t),(a&te)!==0){var h=r;Ue?.delete(h),(a&js)===0&&(a&Oe&&(r.f|=js),Ro(h,Qe))}else l&&((a&us)!==0&&ns!==null&&ns.add(r),hs(r))}}}function ei(o){if(typeof o!="object"||o===null||Ns in o)return o;const t=Tr(o);if(t!==th&&t!==eh)return o;var e=new Map,s=Cr(o),i=gs(0),n=Hs,r=a=>{if(Hs===n)return a();var l=ht,h=Hs;_e(null),Ta(n);var c=a();return _e(l),Ta(h),c};return s&&e.set("length",gs(o.length)),new Proxy(o,{defineProperty(a,l,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&dh();var c=e.get(l);return c===void 0?c=r(()=>{var d=gs(h.value);return e.set(l,d),d}):x(c,h.value,!0),!0},deleteProperty(a,l){var h=e.get(l);if(h===void 0){if(l in a){const c=r(()=>gs(Kt));e.set(l,c),Ni(i)}}else x(h,Kt),Ni(i);return!0},get(a,l,h){if(l===Ns)return o;var c=e.get(l),d=l in a;if(c===void 0&&(!d||ai(a,l)?.writable)&&(c=r(()=>{var f=ei(d?a[l]:Kt),p=gs(f);return p}),e.set(l,c)),c!==void 0){var u=m(c);return u===Kt?void 0:u}return Reflect.get(a,l,h)},getOwnPropertyDescriptor(a,l){var h=Reflect.getOwnPropertyDescriptor(a,l);if(h&&"value"in h){var c=e.get(l);c&&(h.value=m(c))}else if(h===void 0){var d=e.get(l),u=d?.v;if(d!==void 0&&u!==Kt)return{enumerable:!0,configurable:!0,value:u,writable:!0}}return h},has(a,l){if(l===Ns)return!0;var h=e.get(l),c=h!==void 0&&h.v!==Kt||Reflect.has(a,l);if(h!==void 0||wt!==null&&(!c||ai(a,l)?.writable)){h===void 0&&(h=r(()=>{var u=c?ei(a[l]):Kt,f=gs(u);return f}),e.set(l,h));var d=m(h);if(d===Kt)return!1}return c},set(a,l,h,c){var d=e.get(l),u=l in a;if(s&&l==="length")for(var f=h;f<d.v;f+=1){var p=e.get(f+"");p!==void 0?x(p,Kt):f in a&&(p=r(()=>gs(Kt)),e.set(f+"",p))}if(d===void 0)(!u||ai(a,l)?.writable)&&(d=r(()=>gs(void 0)),x(d,ei(h)),e.set(l,d));else{u=d.v!==Kt;var g=r(()=>ei(h));x(d,g)}var b=Reflect.getOwnPropertyDescriptor(a,l);if(b?.set&&b.set.call(c,h),!u){if(s&&typeof l=="string"){var v=e.get("length"),w=Number(l);Number.isInteger(w)&&w>=v.v&&x(v,w+1)}Ni(i)}return!0},ownKeys(a){m(i);var l=Reflect.ownKeys(a).filter(d=>{var u=e.get(d);return u===void 0||u.v!==Kt});for(var[h,c]of e)c.v!==Kt&&!(h in a)&&l.push(h);return l},setPrototypeOf(){uh()}})}var Sa,Do,Lo,Io;function $h(){if(Sa===void 0){Sa=window,Do=/Firefox/.test(navigator.userAgent);var o=Element.prototype,t=Node.prototype,e=Text.prototype;Lo=ai(t,"firstChild").get,Io=ai(t,"nextSibling").get,ya(o)&&(o.__click=void 0,o.__className=void 0,o.__attributes=null,o.__style=void 0,o.__e=void 0),ya(e)&&(e.__t=void 0)}}function _s(o=""){return document.createTextNode(o)}function gi(o){return Lo.call(o)}function Xi(o){return Io.call(o)}function M(o,t){return gi(o)}function ne(o,t=!1){{var e=gi(o);return e instanceof Comment&&e.data===""?Xi(e):e}}function k(o,t=1,e=!1){let s=o;for(;t--;)s=Xi(s);return s}function Wh(o){o.textContent=""}function Fo(){return!1}function Ea(o,t){{const e=document.body;o.autofocus=!0,_i(()=>{document.activeElement===e&&o.focus()})}}let xa=!1;function Vh(){xa||(xa=!0,document.addEventListener("reset",o=>{Promise.resolve().then(()=>{if(!o.defaultPrevented)for(const t of o.target.elements)t.__on_r?.()})},{capture:!0}))}function Fn(o){var t=ht,e=wt;_e(null),Je(null);try{return o()}finally{_e(t),Je(e)}}function Oo(o,t,e,s=e){o.addEventListener(t,()=>Fn(e));const i=o.__on_r;i?o.__on_r=()=>{i(),s(!0)}:o.__on_r=()=>s(!0),Vh()}function No(o){wt===null&&(ht===null&&lh(),oh()),As&&ah()}function Gh(o,t){var e=t.last;e===null?t.last=t.first=o:(e.next=o,o.prev=e,t.last=o)}function Ze(o,t,e){var s=wt;s!==null&&(s.f&Pe)!==0&&(o|=Pe);var i={ctx:Ct,deps:null,nodes:null,f:o|ce|Oe,first:null,fn:t,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(e)try{mi(i),i.f|=kr}catch(a){throw Ae(i),a}else t!==null&&hs(i);var n=i;if(e&&n.deps===null&&n.teardown===null&&n.nodes===null&&n.first===n.last&&(n.f&yi)===0&&(n=n.first,(o&us)!==0&&(o&di)!==0&&n!==null&&(n.f|=di)),n!==null&&(n.parent=s,s!==null&&Gh(n,s),ht!==null&&(ht.f&te)!==0&&(o&Gs)===0)){var r=ht;(r.effects??=[]).push(n)}return i}function Ir(){return ht!==null&&!He}function Bo(o){const t=Ze(Gi,null,!1);return jt(t,Zt),t.teardown=o,t}function dr(o){No();var t=wt.f,e=!ht&&(t&fs)!==0&&(t&kr)===0;if(e){var s=Ct;(s.e??=[]).push(o)}else return Uo(o)}function Uo(o){return Ze(An|bo,o,!1)}function qh(o){return No(),Ze(Gi|bo,o,!0)}function Xh(o){Ke.ensure();const t=Ze(Gs|yi,o,!0);return(e={})=>new Promise(s=>{e.outro?Bs(t,()=>{Ae(t),s(void 0)}):(Ae(t),s(void 0))})}function Yh(o){return Ze(An,o,!1)}function Jt(o,t){var e=Ct,s={effect:null,ran:!1,deps:o};e.l.$.push(s),s.effect=Ai(()=>{o(),!s.ran&&(s.ran=!0,et(t))})}function Fr(){var o=Ct;Ai(()=>{for(var t of o.l.$){t.deps();var e=t.effect;(e.f&Zt)!==0&&e.deps!==null&&jt(e,Qe),Si(e)&&mi(e),t.ran=!1}})}function Kh(o){return Ze(Mr|yi,o,!0)}function Ai(o,t=0){return Ze(Gi|t,o,!0)}function lt(o,t=[],e=[],s=[]){Bh(s,t,e,i=>{Ze(Gi,()=>o(...i.map(m)),!0)})}function Or(o,t=0){var e=Ze(us|t,o,!0);return e}function Fe(o){return Ze(fs|yi,o,!0)}function Ho(o){var t=o.teardown;if(t!==null){const e=As,s=ht;Ca(!0),_e(null);try{t.call(null)}finally{Ca(e),_e(s)}}}function zo(o,t=!1){var e=o.first;for(o.first=o.last=null;e!==null;){const i=e.ac;i!==null&&Fn(()=>{i.abort(ti)});var s=e.next;(e.f&Gs)!==0?e.parent=null:Ae(e,t),e=s}}function Jh(o){for(var t=o.first;t!==null;){var e=t.next;(t.f&fs)===0&&Ae(t),t=e}}function Ae(o,t=!0){var e=!1;(t||(o.f&vo)!==0)&&o.nodes!==null&&o.nodes.end!==null&&(Qh(o.nodes.start,o.nodes.end),e=!0),zo(o,t&&!e),xn(o,0),jt(o,os);var s=o.nodes&&o.nodes.t;if(s!==null)for(const n of s)n.stop();Ho(o);var i=o.parent;i!==null&&i.first!==null&&jo(o),o.next=o.prev=o.teardown=o.ctx=o.deps=o.fn=o.nodes=o.ac=null}function Qh(o,t){for(;o!==null;){var e=o===t?null:Xi(o);o.remove(),o=e}}function jo(o){var t=o.parent,e=o.prev,s=o.next;e!==null&&(e.next=s),s!==null&&(s.prev=e),t!==null&&(t.first===o&&(t.first=s),t.last===o&&(t.last=e))}function Bs(o,t,e=!0){var s=[];$o(o,s,!0);var i=()=>{e&&Ae(o),t&&t()},n=s.length;if(n>0){var r=()=>--n||i();for(var a of s)a.out(r)}else i()}function $o(o,t,e){if((o.f&Pe)===0){o.f^=Pe;var s=o.nodes&&o.nodes.t;if(s!==null)for(const a of s)(a.is_global||e)&&t.push(a);for(var i=o.first;i!==null;){var n=i.next,r=(i.f&di)!==0||(i.f&fs)!==0&&(o.f&us)!==0;$o(i,t,r?e:!1),i=n}}}function Nr(o){Wo(o,!0)}function Wo(o,t){if((o.f&Pe)!==0){o.f^=Pe,(o.f&Zt)===0&&(jt(o,ce),hs(o));for(var e=o.first;e!==null;){var s=e.next,i=(e.f&di)!==0||(e.f&fs)!==0;Wo(e,i?t:!1),e=s}var n=o.nodes&&o.nodes.t;if(n!==null)for(const r of n)(r.is_global||t)&&r.in()}}function Vo(o,t){if(o.nodes)for(var e=o.nodes.start,s=o.nodes.end;e!==null;){var i=e===s?null:Xi(e);t.append(e),e=i}}let Us=!1;function En(o){Us=o}let As=!1;function Ca(o){As=o}let ht=null,He=!1;function _e(o){ht=o}let wt=null;function Je(o){wt=o}let ls=null;function Zh(o){ht!==null&&(ls===null?ls=[o]:ls.push(o))}let le=null,Ee=0,Le=null;function tc(o){Le=o}let Go=1,Hi=0,Hs=Hi;function Ta(o){Hs=o}function qo(){return++Go}function Si(o){var t=o.f;if((t&ce)!==0)return!0;if(t&te&&(o.f&=~js),(t&Qe)!==0){for(var e=o.deps,s=e.length,i=0;i<s;i++){var n=e[i];if(Si(n)&&ko(n),n.wv>o.wv)return!0}(t&Oe)!==0&&Ue===null&&jt(o,Zt)}return!1}function Xo(o,t,e=!0){var s=o.reactions;if(s!==null&&!ls?.includes(o))for(var i=0;i<s.length;i++){var n=s[i];(n.f&te)!==0?Xo(n,t,!1):t===n&&(e?jt(n,ce):(n.f&Zt)!==0&&jt(n,Qe),hs(n))}}function Yo(o){var t=le,e=Ee,s=Le,i=ht,n=ls,r=Ct,a=He,l=Hs,h=o.f;le=null,Ee=0,Le=null,ht=(h&(fs|Gs))===0?o:null,ls=null,ui(o.ctx),He=!1,Hs=++Hi,o.ac!==null&&(Fn(()=>{o.ac.abort(ti)}),o.ac=null);try{o.f|=lr;var c=o.fn,d=c(),u=o.deps;if(le!==null){var f;if(xn(o,Ee),u!==null&&Ee>0)for(u.length=Ee+le.length,f=0;f<le.length;f++)u[Ee+f]=le[f];else o.deps=u=le;if(Ir()&&(o.f&Oe)!==0)for(f=Ee;f<u.length;f++)(u[f].reactions??=[]).push(o)}else u!==null&&Ee<u.length&&(xn(o,Ee),u.length=Ee);if(qi()&&Le!==null&&!He&&u!==null&&(o.f&(te|Qe|ce))===0)for(f=0;f<Le.length;f++)Xo(Le[f],o);return i!==null&&i!==o&&(Hi++,Le!==null&&(s===null?s=Le:s.push(...Le))),(o.f&ys)!==0&&(o.f^=ys),d}catch(p){return Ao(p)}finally{o.f^=lr,le=t,Ee=e,Le=s,ht=i,ls=n,ui(r),He=a,Hs=l}}function ec(o,t){let e=t.reactions;if(e!==null){var s=Ql.call(e,o);if(s!==-1){var i=e.length-1;i===0?e=t.reactions=null:(e[s]=e[i],e.pop())}}if(e===null&&(t.f&te)!==0&&(le===null||!le.includes(t))){var n=t;(n.f&Oe)!==0&&(n.f^=Oe,n.f&=~js),Dr(n),Po(n),xn(n,0)}}function xn(o,t){var e=o.deps;if(e!==null)for(var s=t;s<e.length;s++)ec(o,e[s])}function mi(o){var t=o.f;if((t&os)===0){jt(o,Zt);var e=wt,s=Us;wt=o,Us=!0;try{(t&(us|mo))!==0?Jh(o):zo(o),Ho(o);var i=Yo(o);o.teardown=typeof i=="function"?i:null,o.wv=Go;var n;ar&&Ph&&(o.f&ce)!==0&&o.deps}finally{Us=s,wt=e}}}async function sc(){await Promise.resolve(),Dh()}function m(o){var t=o.f,e=(t&te)!==0;if(ht!==null&&!He){var s=wt!==null&&(wt.f&os)!==0;if(!s&&!ls?.includes(o)){var i=ht.deps;if((ht.f&lr)!==0)o.rv<Hi&&(o.rv=Hi,le===null&&i!==null&&i[Ee]===o?Ee++:le===null?le=[o]:le.includes(o)||le.push(o));else{(ht.deps??=[]).push(o);var n=o.reactions;n===null?o.reactions=[ht]:n.includes(ht)||n.push(ht)}}}if(As&&ws.has(o))return ws.get(o);if(e){var r=o;if(As){var a=r.v;return((r.f&Zt)===0&&r.reactions!==null||Jo(r))&&(a=Lr(r)),ws.set(r,a),a}var l=(r.f&Oe)===0&&!He&&ht!==null&&(Us||(ht.f&Oe)!==0),h=r.deps===null;Si(r)&&(l&&(r.f|=Oe),ko(r)),l&&!h&&Ko(r)}if(Ue?.has(o))return Ue.get(o);if((o.f&ys)!==0)throw o.v;return o.v}function Ko(o){if(o.deps!==null){o.f|=Oe;for(const t of o.deps)(t.reactions??=[]).push(o),(t.f&te)!==0&&(t.f&Oe)===0&&Ko(t)}}function Jo(o){if(o.v===Kt)return!0;if(o.deps===null)return!1;for(const t of o.deps)if(ws.has(t)||(t.f&te)!==0&&Jo(t))return!0;return!1}function et(o){var t=He;try{return He=!0,o()}finally{He=t}}function zt(o){if(!(typeof o!="object"||!o||o instanceof EventTarget)){if(Ns in o)ur(o);else if(!Array.isArray(o))for(let t in o){const e=o[t];typeof e=="object"&&e&&Ns in e&&ur(e)}}}function ur(o,t=new Set){if(typeof o=="object"&&o!==null&&!(o instanceof EventTarget)&&!t.has(o)){t.add(o),o instanceof Date&&o.getTime();for(let s in o)try{ur(o[s],t)}catch{}const e=Tr(o);if(e!==Object.prototype&&e!==Array.prototype&&e!==Map.prototype&&e!==Set.prototype&&e!==Date.prototype){const s=po(e);for(let i in s){const n=s[i].get;if(n)try{n.call(o)}catch{}}}}}const ic=["touchstart","touchmove"];function nc(o){return ic.includes(o)}const rc=new Set,Pa=new Set;function ac(o,t,e,s={}){function i(n){if(s.capture||Ri.call(t,n),!n.cancelBubble)return Fn(()=>e?.call(this,n))}return o.startsWith("pointer")||o.startsWith("touch")||o==="wheel"?_i(()=>{t.addEventListener(o,i,s)}):t.addEventListener(o,i,s),i}function q(o,t,e,s,i){var n={capture:s,passive:i},r=ac(o,t,e,n);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&Bo(()=>{t.removeEventListener(o,r,n)})}let ka=null;function Ri(o){var t=this,e=t.ownerDocument,s=o.type,i=o.composedPath?.()||[],n=i[0]||o.target;ka=o;var r=0,a=ka===o&&o.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(t===document||t===window)){o.__root=t;return}var h=i.indexOf(t);if(h===-1)return;l<=h&&(r=l)}if(n=i[r]||o.target,n!==t){Zl(o,"currentTarget",{configurable:!0,get(){return n||e}});var c=ht,d=wt;_e(null),Je(null);try{for(var u,f=[];n!==null;){var p=n.assignedSlot||n.parentNode||n.host||null;try{var g=n["__"+s];g!=null&&(!n.disabled||o.target===n)&&g.call(n,o)}catch(b){u?f.push(b):u=b}if(o.cancelBubble||p===t||p===null)break;n=p}if(u){for(let b of f)queueMicrotask(()=>{throw b});throw u}}finally{o.__root=t,delete o.currentTarget,_e(c),Je(d)}}}function Qo(o){var t=document.createElement("template");return t.innerHTML=o.replaceAll("<!>","<!---->"),t.content}function Cn(o,t){var e=wt;e.nodes===null&&(e.nodes={start:o,end:t,a:null,t:null})}function G(o,t){var e=(t&Sh)!==0,s=(t&Eh)!==0,i,n=!o.startsWith("<!>");return()=>{i===void 0&&(i=Qo(n?o:"<!>"+o),e||(i=gi(i)));var r=s||Do?document.importNode(i,!0):i.cloneNode(!0);if(e){var a=gi(r),l=r.lastChild;Cn(a,l)}else Cn(r,r);return r}}function oc(o,t,e="svg"){var s=!o.startsWith("<!>"),i=`<${e}>${s?o:"<!>"+o}</${e}>`,n;return()=>{if(!n){var r=Qo(i),a=gi(r);n=gi(a)}var l=n.cloneNode(!0);return Cn(l,l),l}}function On(o,t){return oc(o,t,"svg")}function lc(){var o=document.createDocumentFragment(),t=document.createComment(""),e=_s();return o.append(t,e),Cn(t,e),o}function $(o,t){o!==null&&o.before(t)}function pt(o,t){var e=t==null?"":typeof t=="object"?t+"":t;e!==(o.__t??=o.nodeValue)&&(o.__t=e,o.nodeValue=e+"")}function hc(o,t){return cc(o,t)}const Ks=new Map;function cc(o,{target:t,anchor:e,props:s={},events:i,context:n,intro:r=!0}){$h();var a=new Set,l=d=>{for(var u=0;u<d.length;u++){var f=d[u];if(!a.has(f)){a.add(f);var p=nc(f);t.addEventListener(f,Ri,{passive:p});var g=Ks.get(f);g===void 0?(document.addEventListener(f,Ri,{passive:p}),Ks.set(f,1)):Ks.set(f,g+1)}}};l(Dn(rc)),Pa.add(l);var h=void 0,c=Xh(()=>{var d=e??t.appendChild(_s());return Oh(d,{pending:()=>{}},u=>{if(n){Es({});var f=Ct;f.c=n}i&&(s.$$events=i),h=o(u,s)||{},n&&xs()}),()=>{for(var u of a){t.removeEventListener(u,Ri);var f=Ks.get(u);--f===0?(document.removeEventListener(u,Ri),Ks.delete(u)):Ks.set(u,f)}Pa.delete(l),d!==e&&d.parentNode?.removeChild(d)}});return dc.set(h,c),h}let dc=new WeakMap;class uc{anchor;#t=new Map;#e=new Map;#i=new Map;#s=new Set;#a=!0;constructor(t,e=!0){this.anchor=t,this.#a=e}#r=()=>{var t=St;if(this.#t.has(t)){var e=this.#t.get(t),s=this.#e.get(e);if(s)Nr(s),this.#s.delete(e);else{var i=this.#i.get(e);i&&(this.#e.set(e,i.effect),this.#i.delete(e),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),s=i.effect)}for(const[n,r]of this.#t){if(this.#t.delete(n),n===t)break;const a=this.#i.get(r);a&&(Ae(a.effect),this.#i.delete(r))}for(const[n,r]of this.#e){if(n===e||this.#s.has(n))continue;const a=()=>{if(Array.from(this.#t.values()).includes(n)){var h=document.createDocumentFragment();Vo(r,h),h.append(_s()),this.#i.set(n,{effect:r,fragment:h})}else Ae(r);this.#s.delete(n),this.#e.delete(n)};this.#a||!s?(this.#s.add(n),Bs(r,a,!1)):a()}}};#n=t=>{this.#t.delete(t);const e=Array.from(this.#t.values());for(const[s,i]of this.#i)e.includes(s)||(Ae(i.effect),this.#i.delete(s))};ensure(t,e){var s=St,i=Fo();if(e&&!this.#e.has(t)&&!this.#i.has(t))if(i){var n=document.createDocumentFragment(),r=_s();n.append(r),this.#i.set(t,{effect:Fe(()=>e(r)),fragment:n})}else this.#e.set(t,Fe(()=>e(this.anchor)));if(this.#t.set(s,t),i){for(const[a,l]of this.#e)a===t?s.skipped_effects.delete(l):s.skipped_effects.add(l);for(const[a,l]of this.#i)a===t?s.skipped_effects.delete(l.effect):s.skipped_effects.add(l.effect);s.oncommit(this.#r),s.ondiscard(this.#n)}else this.#r()}}function st(o,t,e=!1){var s=new uc(o),i=e?di:0;function n(r,a){s.ensure(r,a)}Or(()=>{var r=!1;t((a,l=!0)=>{r=!0,n(l,a)}),r||n(!1,null)},i)}function Zo(o,t){return t}function fc(o,t,e){for(var s=[],i=t.length,n,r=t.length,a=0;a<i;a++){let d=t[a];Bs(d,()=>{if(n){if(n.pending.delete(d),n.done.add(d),n.pending.size===0){var u=o.outrogroups;fr(Dn(n.done)),u.delete(n),u.size===0&&(o.outrogroups=null)}}else r-=1},!1)}if(r===0){var l=s.length===0&&e!==null;if(l){var h=e,c=h.parentNode;Wh(c),c.append(h),o.items.clear()}fr(t,!l)}else n={pending:new Set(t),done:new Set},(o.outrogroups??=new Set).add(n)}function fr(o,t=!0){for(var e=0;e<o.length;e++)Ae(o[e],t)}var Ma;function tl(o,t,e,s,i,n=null){var r=o,a=new Map;{var l=o;r=l.appendChild(_s())}var h=null,c=Ds(()=>{var b=e();return Cr(b)?b:b==null?[]:Dn(b)}),d,u=!0;function f(){g.fallback=h,pc(g,d,r,t,s),h!==null&&(d.length===0?(h.f&bs)===0?Nr(h):(h.f^=bs,Di(h,null,r)):Bs(h,()=>{h=null}))}var p=Or(()=>{d=m(c);for(var b=d.length,v=new Set,w=St,y=Fo(),_=0;_<b;_+=1){var A=d[_],S=s(A,_),E=u?null:a.get(S);E?(E.v&&pi(E.v,A),E.i&&pi(E.i,_),y&&w.skipped_effects.delete(E.e)):(E=gc(a,u?r:Ma??=_s(),A,S,_,i,t,e),u||(E.e.f|=bs),a.set(S,E)),v.add(S)}if(b===0&&n&&!h&&(u?h=Fe(()=>n(r)):(h=Fe(()=>n(Ma??=_s())),h.f|=bs)),!u)if(y){for(const[T,C]of a)v.has(T)||w.skipped_effects.add(C.e);w.oncommit(f),w.ondiscard(()=>{})}else f();m(c)}),g={effect:p,items:a,outrogroups:null,fallback:h};u=!1}function pc(o,t,e,s,i){var n=t.length,r=o.items,a=o.effect.first,l,h=null,c=[],d=[],u,f,p,g;for(g=0;g<n;g+=1){if(u=t[g],f=i(u,g),p=r.get(f).e,o.outrogroups!==null)for(const T of o.outrogroups)T.pending.delete(p),T.done.delete(p);if((p.f&bs)!==0)if(p.f^=bs,p===a)Di(p,null,e);else{var b=h?h.next:a;p===o.effect.last&&(o.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),ms(o,h,p),ms(o,p,b),Di(p,b,e),h=p,c=[],d=[],a=h.next;continue}if((p.f&Pe)!==0&&Nr(p),p!==a){if(l!==void 0&&l.has(p)){if(c.length<d.length){var v=d[0],w;h=v.prev;var y=c[0],_=c[c.length-1];for(w=0;w<c.length;w+=1)Di(c[w],v,e);for(w=0;w<d.length;w+=1)l.delete(d[w]);ms(o,y.prev,_.next),ms(o,h,y),ms(o,_,v),a=v,h=_,g-=1,c=[],d=[]}else l.delete(p),Di(p,a,e),ms(o,p.prev,p.next),ms(o,p,h===null?o.effect.first:h.next),ms(o,h,p),h=p;continue}for(c=[],d=[];a!==null&&a!==p;)(l??=new Set).add(a),d.push(a),a=a.next;if(a===null)continue}(p.f&bs)===0&&c.push(p),h=p,a=p.next}if(o.outrogroups!==null){for(const T of o.outrogroups)T.pending.size===0&&(fr(Dn(T.done)),o.outrogroups?.delete(T));o.outrogroups.size===0&&(o.outrogroups=null)}if(a!==null||l!==void 0){var A=[];if(l!==void 0)for(p of l)(p.f&Pe)===0&&A.push(p);for(;a!==null;)(a.f&Pe)===0&&a!==o.fallback&&A.push(a),a=a.next;var S=A.length;if(S>0){var E=n===0?e:null;fc(o,A,E)}}}function gc(o,t,e,s,i,n,r,a){var l=(r&gh)!==0?(r&vh)===0?V(e,!1,!1):$s(e):null,h=(r&mh)!==0?$s(i):null;return{v:l,i:h,e:Fe(()=>(n(t,l??e,h??i,a),()=>{o.delete(s)}))}}function Di(o,t,e){if(o.nodes)for(var s=o.nodes.start,i=o.nodes.end,n=t&&(t.f&bs)===0?t.nodes.start:e;s!==null;){var r=Xi(s);if(n.before(s),s===i)return;s=r}}function ms(o,t,e){t===null?o.effect.first=e:t.next=e,e===null?o.effect.last=t:e.prev=t}const Ra=[...` 	
\r\f \v\uFEFF`];function mc(o,t,e){var s=o==null?"":""+o;if(e){for(var i in e)if(e[i])s=s?s+" "+i:i;else if(s.length)for(var n=i.length,r=0;(r=s.indexOf(i,r))>=0;){var a=r+n;(r===0||Ra.includes(s[r-1]))&&(a===s.length||Ra.includes(s[a]))?s=(r===0?"":s.substring(0,r))+s.substring(a+1):r=a}}return s===""?null:s}function vc(o,t){return o==null?null:String(o)}function Bt(o,t,e,s,i,n){var r=o.__className;if(r!==e||r===void 0){var a=mc(e,s,n);a==null?o.removeAttribute("class"):o.className=a,o.__className=e}else if(n&&i!==n)for(var l in n){var h=!!n[l];(i==null||h!==!!i[l])&&o.classList.toggle(l,h)}return n}function si(o,t,e,s){var i=o.__style;if(i!==t){var n=vc(t);n==null?o.removeAttribute("style"):o.style.cssText=n,o.__style=t}return s}const bc=Symbol("is custom element"),yc=Symbol("is html");function Ye(o,t,e,s){var i=wc(o);i[t]!==(i[t]=e)&&(t==="loading"&&(o[nh]=e),e==null?o.removeAttribute(t):typeof e!="string"&&_c(o).includes(t)?o[t]=e:o.setAttribute(t,e))}function wc(o){return o.__attributes??={[bc]:o.nodeName.includes("-"),[yc]:o.namespaceURI===xh}}var Da=new Map;function _c(o){var t=o.getAttribute("is")||o.nodeName,e=Da.get(t);if(e)return e;Da.set(t,e=[]);for(var s,i=o,n=Element.prototype;n!==i;){s=po(i);for(var r in s)s[r].set&&e.push(r);i=Tr(i)}return e}function be(o,t,e=t){var s=new WeakSet;Oo(o,"input",async i=>{var n=i?o.defaultValue:o.value;if(n=Yn(o)?Kn(n):n,e(n),St!==null&&s.add(St),await sc(),n!==(n=t())){var r=o.selectionStart,a=o.selectionEnd,l=o.value.length;if(o.value=n??"",a!==null){var h=o.value.length;r===a&&a===l&&h>l?(o.selectionStart=h,o.selectionEnd=h):(o.selectionStart=r,o.selectionEnd=Math.min(a,h))}}}),et(t)==null&&o.value&&(e(Yn(o)?Kn(o.value):o.value),St!==null&&s.add(St)),Ai(()=>{var i=t();if(o===document.activeElement){var n=yn??St;if(s.has(n))return}Yn(o)&&i===Kn(o.value)||o.type==="date"&&!i&&!o.value||i!==o.value&&(o.value=i??"")})}function Ac(o,t,e=t){Oo(o,"change",s=>{var i=s?o.defaultChecked:o.checked;e(i)}),et(t)==null&&e(o.checked),Ai(()=>{var s=t();o.checked=!!s})}function Yn(o){var t=o.type;return t==="number"||t==="range"}function Kn(o){return o===""?null:+o}function La(o,t){return o===t||o?.[Ns]===t}function Sc(o={},t,e,s){return Yh(()=>{var i,n;return Ai(()=>{i=n,n=[],et(()=>{o!==e(...n)&&(t(o,...n),i&&La(e(...i),o)&&t(null,...i))})}),()=>{_i(()=>{n&&La(e(...n),o)&&t(null,...n)})}}),o}function Ia(o){return function(...t){var e=t[0];e.target===this&&o?.apply(this,t)}}function Fa(o){return function(...t){var e=t[0];return e.preventDefault(),o?.apply(this,t)}}function qs(o=!1){const t=Ct,e=t.l.u;if(!e)return;let s=()=>zt(t.s);if(o){let i=0,n={};const r=In(()=>{let a=!1;const l=t.s;for(const h in l)l[h]!==n[h]&&(n[h]=l[h],a=!0);return a&&i++,i});s=()=>m(r)}e.b.length&&qh(()=>{Oa(t,s),or(e.b)}),dr(()=>{const i=et(()=>e.m.map(sh));return()=>{for(const n of i)typeof n=="function"&&n()}}),e.a.length&&dr(()=>{Oa(t,s),or(e.a)})}function Oa(o,t){if(o.l.s)for(const e of o.l.s)m(e);t()}let hn=!1;function Ec(o){var t=hn;try{return hn=!1,[o(),hn]}finally{hn=t}}function J(o,t,e,s){var i=!wi||(e&yh)!==0,n=(e&_h)!==0,r=(e&Ah)!==0,a=s,l=!0,h=()=>(l&&(l=!1,a=r?et(s):s),a),c;if(n){var d=Ns in o||ih in o;c=ai(o,t)?.set??(d&&t in o?y=>o[t]=y:void 0)}var u,f=!1;n?[u,f]=Ec(()=>o[t]):u=o[t],u===void 0&&s!==void 0&&(u=h(),c&&(i&&ch(),c(u)));var p;if(i?p=()=>{var y=o[t];return y===void 0?h():(l=!0,y)}:p=()=>{var y=o[t];return y!==void 0&&(a=void 0),y===void 0?a:y},i&&(e&wh)===0)return p;if(c){var g=o.$$legacy;return(function(y,_){return arguments.length>0?((!i||!_||g||f)&&c(_?p():y),y):p()})}var b=!1,v=((e&bh)!==0?In:Ds)(()=>(b=!1,p()));n&&m(v);var w=wt;return(function(y,_){if(arguments.length>0){const A=_?m(v):i&&n?ei(y):y;return x(v,A),b=!0,a!==void 0&&(a=A),y}return As&&b||(w.f&os)!==0?v.v:m(v)})}function el(o){Ct===null&&Rr(),wi&&Ct.l!==null?Tc(Ct).m.push(o):dr(()=>{const t=et(o);if(typeof t=="function")return t})}function xc(o){Ct===null&&Rr(),el(()=>()=>et(o))}function Cc(o,t,{bubbles:e=!1,cancelable:s=!1}={}){return new CustomEvent(o,{detail:t,bubbles:e,cancelable:s})}function Yi(){const o=Ct;return o===null&&Rr(),(t,e,s)=>{const i=o.s.$$events?.[t];if(i){const n=Cr(i)?i.slice():[i],r=Cc(t,e,s);for(const a of n)a.call(o.x,r);return!r.defaultPrevented}return!0}}function Tc(o){var t=o.l;return t.u??={a:[],b:[],m:[]}}const Pc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Pc);kh();function kc(o){return!o||typeof o!="string"?[]:o.trim().split(/\s+/).filter(t=>t.length>0)}function Mc(o){if(!o||typeof o!="string")return 0;const t=o.replace(/[^\p{L}]/gu,"").length;return t<=1||t<=3?0:t<=5?1:t<=9?2:t<=12?3:Math.floor(Math.log2(t-1))+1}const Rc=new RegExp("\\p{L}","u");function Na(o){if(!o||typeof o!="string")return 0;const t=Mc(o);let e=0;for(let s=0;s<o.length;s++)if(Rc.test(o[s])){if(e===t)return s;e++}return Math.min(t,o.length-1)}function Dc(o,t,e=!0,s=2,i=0){if(!o||typeof o!="string")return 6e4/t;if(!t||t<=0)return 200;var n=6e4/t;if(i>0&&o.length>=12&&(n*=1+i/100*(o.length-12)),e){if(/[.!?;:]$/.test(o))return n*s;if(/[,]$/.test(o))return n*1.5}return n}function Lc(o,t){if(o<=0||!t||t<=0)return"0:00";const e=Math.ceil(o/t*60),s=Math.floor(e/60),i=e%60;return`${s}:${i.toString().padStart(2,"0")}`}function Ic(o,t){return t<=0||o<=0?!1:o%t===0}function Fc(o,t,e){if(e<=1||t>=o.length)return{subset:[o[t]||""],centerOffset:0};const s=Math.floor(e/2),i=Math.max(0,t-s),n=Math.min(o.length,t+s+1),r=o.slice(i,n),a=t-i;return{subset:r,centerOffset:a}}const Oc="modulepreload",Nc=function(o){return"/rsvp-reading/"+o},Ba={},Br=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){let l=function(h){return Promise.all(h.map(c=>Promise.resolve(c).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=r?.nonce||r?.getAttribute("nonce");i=l(e.map(h=>{if(h=Nc(h),h in Ba)return;Ba[h]=!0;const c=h.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${d}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":Oc,c||(u.as="script"),u.crossOrigin="",u.href=h,a&&u.setAttribute("nonce",a),document.head.appendChild(u),c)return new Promise((f,p)=>{u.addEventListener("load",f),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return i.then(r=>{for(const a of r||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})},oe=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),pr=[.001,0,0,.001,0,0],Jn=1.35,xe={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},as={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},zi="pdfjs_internal_editor_",Y={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},nt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},sl={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},gr={TRIANGLES:1,LATTICE:2},Ht={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Bi={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ft={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Qs={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Ki={ERRORS:0,WARNINGS:1,INFOS:5},vi={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Ci={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},il={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Nn=Ki.WARNINGS;function Bc(o){Number.isInteger(o)&&(Nn=o)}function Uc(){return Nn}function Bn(o){Nn>=Ki.INFOS&&console.info(`Info: ${o}`)}function K(o){Nn>=Ki.WARNINGS&&console.warn(`Warning: ${o}`)}function xt(o){throw new Error(o)}function ot(o,t){o||xt(t)}function Hc(o){switch(o?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ur(o,t=null,e=null){if(!o)return null;if(e&&typeof o=="string"&&(e.addDefaultProtocol&&o.startsWith("www.")&&o.match(/\./g)?.length>=2&&(o=`http://${o}`),e.tryConvertEncoding))try{o=Vc(o)}catch{}const s=t?URL.parse(o,t):URL.parse(o);return Hc(s)?s:null}function Hr(o,t,e=!1){const s=URL.parse(o);return s?(s.hash=t,s.href):e&&Ur(o,"http://example.com")?o.split("#",1)[0]+`${t?`#${t}`:""}`:""}function X(o,t,e,s=!1){return Object.defineProperty(o,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const Xs=(function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t})();class Ua extends Xs{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Qn extends Xs{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Tn extends Xs{constructor(t){super(t,"InvalidPDFException")}}class ji extends Xs{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class zc extends Xs{constructor(t){super(t,"FormatError")}}class cs extends Xs{constructor(t){super(t,"AbortException")}}function nl(o){(typeof o!="object"||o?.length===void 0)&&xt("Invalid argument for bytesToString");const t=o.length,e=8192;if(t<e)return String.fromCharCode.apply(null,o);const s=[];for(let i=0;i<t;i+=e){const n=Math.min(i+e,t),r=o.subarray(i,n);s.push(String.fromCharCode.apply(null,r))}return s.join("")}function Ji(o){typeof o!="string"&&xt("Invalid argument for stringToBytes");const t=o.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=o.charCodeAt(s)&255;return e}function jc(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function $c(){const o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function Wc(){try{return new Function(""),!0}catch{return!1}}class Ut{static get isLittleEndian(){return X(this,"isLittleEndian",$c())}static get isEvalSupported(){return X(this,"isEvalSupported",Wc())}static get isOffscreenCanvasSupported(){return X(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return X(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return X(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return X(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return X(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return X(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Zn=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0"));class F{static makeHexColor(t,e,s){return`#${Zn[t]}${Zn[e]}${Zn[s]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,s=0){const i=t[s],n=t[s+1];t[s]=i*e[0]+n*e[2]+e[4],t[s+1]=i*e[1]+n*e[3]+e[5]}static applyTransformToBezier(t,e,s=0){const i=e[0],n=e[1],r=e[2],a=e[3],l=e[4],h=e[5];for(let c=0;c<6;c+=2){const d=t[s+c],u=t[s+c+1];t[s+c]=d*i+u*r+l,t[s+c+1]=d*n+u*a+h}}static applyInverseTransform(t,e){const s=t[0],i=t[1],n=e[0]*e[3]-e[1]*e[2];t[0]=(s*e[3]-i*e[2]+e[2]*e[5]-e[4]*e[3])/n,t[1]=(-s*e[1]+i*e[0]+e[4]*e[1]-e[5]*e[0])/n}static axialAlignedBoundingBox(t,e,s){const i=e[0],n=e[1],r=e[2],a=e[3],l=e[4],h=e[5],c=t[0],d=t[1],u=t[2],f=t[3];let p=i*c+l,g=p,b=i*u+l,v=b,w=a*d+h,y=w,_=a*f+h,A=_;if(n!==0||r!==0){const S=n*c,E=n*u,T=r*d,C=r*f;p+=T,v+=T,b+=C,g+=C,w+=S,A+=S,_+=E,y+=E}s[0]=Math.min(s[0],p,b,g,v),s[1]=Math.min(s[1],w,_,y,A),s[2]=Math.max(s[2],p,b,g,v),s[3]=Math.max(s[3],w,_,y,A)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const s=t[0],i=t[1],n=t[2],r=t[3],a=s**2+i**2,l=s*n+i*r,h=n**2+r**2,c=(a+h)/2,d=Math.sqrt(c**2-(a*h-l**2));e[0]=Math.sqrt(c+d||1),e[1]=Math.sqrt(c-d||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>r?null:[s,n,i,r]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,i,n){n[0]=Math.min(n[0],t,s),n[1]=Math.min(n[1],e,i),n[2]=Math.max(n[2],t,s),n[3]=Math.max(n[3],e,i)}static#t(t,e,s,i,n,r,a,l,h,c){if(h<=0||h>=1)return;const d=1-h,u=h*h,f=u*h,p=d*(d*(d*t+3*h*e)+3*u*s)+f*i,g=d*(d*(d*n+3*h*r)+3*u*a)+f*l;c[0]=Math.min(c[0],p),c[1]=Math.min(c[1],g),c[2]=Math.max(c[2],p),c[3]=Math.max(c[3],g)}static#e(t,e,s,i,n,r,a,l,h,c,d,u){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&this.#t(t,e,s,i,n,r,a,l,-d/c,u);return}const f=c**2-4*d*h;if(f<0)return;const p=Math.sqrt(f),g=2*h;this.#t(t,e,s,i,n,r,a,l,(-c+p)/g,u),this.#t(t,e,s,i,n,r,a,l,(-c-p)/g,u)}static bezierBoundingBox(t,e,s,i,n,r,a,l,h){h[0]=Math.min(h[0],t,a),h[1]=Math.min(h[1],e,l),h[2]=Math.max(h[2],t,a),h[3]=Math.max(h[3],e,l),this.#e(t,s,n,a,e,i,r,l,3*(-t+3*(s-n)+a),6*(t-2*s+n),3*(s-t),h),this.#e(t,s,n,a,e,i,r,l,3*(-e+3*(i-r)+l),6*(e-2*i+r),3*(i-e),h)}}function Vc(o){return decodeURIComponent(escape(o))}let tr=null,Ha=null;function rl(o){return tr||(tr=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ha=new Map([["ﬅ","ſt"]])),o.replaceAll(tr,(t,e,s)=>e?e.normalize("NFKC"):Ha.get(s))}function zr(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const o=new Uint8Array(32);return crypto.getRandomValues(o),nl(o)}const ii="pdfjs_internal_id_";function Gc(o,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,i,...n]=e;if(!o(s)&&!Number.isInteger(s)||!t(i))return!1;const r=n.length;let a=!0;switch(i.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;a=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||a&&l===null))return!1;return!0}function ie(o,t,e){return Math.min(Math.max(o,t),e)}function al(o){return Uint8Array.prototype.toBase64?o.toBase64():btoa(nl(o))}function qc(o){return Uint8Array.fromBase64?Uint8Array.fromBase64(o):Ji(atob(o))}typeof Promise.try!="function"&&(Promise.try=function(o,...t){return new Promise(e=>{e(o(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(o){return o.reduce((t,e)=>t+e,0)});class $i{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(n){if(!n)return;let r=null;const a=n.name;if(a==="#text")r=n.value;else if($i.shouldBuildText(a))n?.attributes?.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&e.push({str:r}),!!n.children)for(const l of n.children)i(l)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class jr{static setupStorage(t,e,s,i,n){const r=i.getValue(e,{value:null});switch(s.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),n==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn?t.setAttribute("checked",!0):r.value===s.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",a=>{i.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),n==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const a of s.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const l=a.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(e,{value:h})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:n}){const{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(const[l,h]of Object.entries(r))if(h!=null)switch(l){case"class":h.length&&t.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",h);break;case"style":Object.assign(t.style,h);break;case"textContent":t.textContent=h;break;default:(!a||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,h)}a&&n.addLinkAttributes(t,r.href,r.newWindow),s&&r.dataId&&this.setupStorage(t,r.dataId,e,s)}static render(t){const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,n=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:n,linkService:s});const a=n!=="richText",l=t.div;if(l.append(r),t.viewport){const d=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=d}a&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const d=document.createTextNode(i.value);r.append(d),a&&$i.shouldBuildText(i.name)&&h.push(d)}return{textDivs:h}}const c=[[i,-1,r]];for(;c.length>0;){const[d,u,f]=c.at(-1);if(u+1===d.children.length){c.pop();continue}const p=d.children[++c.at(-1)[1]];if(p===null)continue;const{name:g}=p;if(g==="#text"){const v=document.createTextNode(p.value);h.push(v),f.append(v);continue}const b=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,g):document.createElement(g);if(f.append(b),p.attributes&&this.setAttributes({html:b,element:p,storage:e,intent:n,linkService:s}),p.children?.length>0)c.push([p,-1,b]);else if(p.value){const v=document.createTextNode(p.value);a&&$i.shouldBuildText(g)&&h.push(v),b.append(v)}}for(const d of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:h}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const is="http://www.w3.org/2000/svg";class Ws{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Ei(o,t="text"){if(Li(o,document.baseURI)){const e=await fetch(o);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",o,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class Qi{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=r,s*=e;const l=(t[2]+t[0])/2,h=(t[3]+t[1])/2;let c,d,u,f;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,d=0,u=0,f=1;break;case 90:c=0,d=1,u=1,f=0;break;case 270:c=0,d=-1,u=-1,f=0;break;case 0:c=1,d=0,u=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(u=-u,f=-f);let p,g,b,v;c===0?(p=Math.abs(h-t[1])*s+n,g=Math.abs(l-t[0])*s+r,b=(t[3]-t[1])*s,v=(t[2]-t[0])*s):(p=Math.abs(l-t[0])*s+n,g=Math.abs(h-t[1])*s+r,b=(t[2]-t[0])*s,v=(t[3]-t[1])*s),this.transform=[c*s,d*s,u*s,f*s,p-c*s*l-u*s*h,g-d*s*l-f*s*h],this.width=b,this.height=v}get rawDims(){const t=this.viewBox;return X(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new Qi({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(t,e){const s=[t,e];return F.applyTransform(s,this.transform),s}convertToViewportRectangle(t){const e=[t[0],t[1]];F.applyTransform(e,this.transform);const s=[t[2],t[3]];return F.applyTransform(s,this.transform),[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){const s=[t,e];return F.applyInverseTransform(s,this.transform),s}}class Un extends Xs{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Zi(o){const t=o.length;let e=0;for(;e<t&&o[e].trim()==="";)e++;return o.substring(e,e+5).toLowerCase()==="data:"}function Hn(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function ol(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function ll(o,t="document.pdf"){if(typeof o!="string")return t;if(Zi(o))return K('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const s=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(o);if(!s)return t;const i=a=>{try{let l=decodeURIComponent(a);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:a):l}catch{return a}},n=/\.pdf$/i,r=s.pathname.split("/").at(-1);if(n.test(r))return i(r);if(s.searchParams.size>0){const a=Array.from(s.searchParams.values()).reverse();for(const h of a)if(n.test(h))return i(h);const l=Array.from(s.searchParams.keys()).reverse();for(const h of l)if(n.test(h))return i(h)}if(s.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(l)return i(l[0])}return t}class za{started=Object.create(null);times=[];time(t){t in this.started&&K(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||K(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:n}of this.times)t.push(`${s.padEnd(e)} ${n-i}ms
`);return t.join("")}}function Li(o,t){const e=t?URL.parse(o,t):URL.parse(o);return e?.protocol==="http:"||e?.protocol==="https:"}function ke(o){o.preventDefault()}function Lt(o){o.preventDefault(),o.stopPropagation()}function Xc(o){console.log("Deprecated API usage: "+o)}class Pn{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const h=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(e[9],10)||0;return d=d>=0&&d<=59?d:0,h==="-"?(r+=c,a+=d):h==="+"&&(r-=c,a-=d),new Date(Date.UTC(s,i,n,r,a,l))}}function hl(o,{scale:t=1,rotation:e=0}){const{width:s,height:i}=o.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new Qi({viewBox:n,userUnit:1,scale:t,rotation:e})}function xi(o){if(o.startsWith("#")){const t=parseInt(o.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(t=>parseInt(t)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(K(`Not a valid color format: "${o}"`),[0,0,0])}function Yc(o){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of o.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;o.set(e,xi(s))}t.remove()}function Dt(o){const{a:t,b:e,c:s,d:i,e:n,f:r}=o.getTransform();return[t,e,s,i,n,r]}function We(o){const{a:t,b:e,c:s,d:i,e:n,f:r}=o.getTransform().invertSelf();return[t,e,s,i,n,r]}function Ss(o,t,e=!1,s=!0){if(t instanceof Qi){const{pageWidth:i,pageHeight:n}=t.rawDims,{style:r}=o,a=Ut.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${n}px`,c=a?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,d=a?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!e||t.rotation%180===0?(r.width=c,r.height=d):(r.width=d,r.height=c)}s&&o.setAttribute("data-main-rotation",t.rotation)}class ze{constructor(){const{pixelRatio:t}=ze;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,i,n=-1){let r=1/0,a=1/0,l=1/0;s=ze.capPixels(s,n),s>0&&(r=Math.sqrt(s/(t*e))),i!==-1&&(a=i/t,l=i/e);const h=Math.min(r,a,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,s):s}return t}}const kn=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Kc{static get isDarkMode(){return X(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class cl{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:s}=window.getComputedStyle(t);return t.remove(),X(this,"commentForegroundColor",xi(s))}}function dl(o,t,e,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return o=Math.round(o*s+i),t=Math.round(t*s+i),e=Math.round(e*s+i),[o,t,e]}function ja(o,t){const e=o[0]/255,s=o[1]/255,i=o[2]/255,n=Math.max(e,s,i),r=Math.min(e,s,i),a=(n+r)/2;if(n===r)t[0]=t[1]=0;else{const l=n-r;switch(t[1]=a<.5?l/(n+r):l/(2-n-r),n){case e:t[0]=((s-i)/l+(s<i?6:0))*60;break;case s:t[0]=((i-e)/l+2)*60;break;case i:t[0]=((e-s)/l+4)*60;break}}t[2]=a}function mr(o,t){const e=o[0],s=o[1],i=o[2],n=(1-Math.abs(2*i-1))*s,r=n*(1-Math.abs(e/60%2-1)),a=i-n/2;switch(Math.floor(e/60)){case 0:t[0]=n+a,t[1]=r+a,t[2]=a;break;case 1:t[0]=r+a,t[1]=n+a,t[2]=a;break;case 2:t[0]=a,t[1]=n+a,t[2]=r+a;break;case 3:t[0]=a,t[1]=r+a,t[2]=n+a;break;case 4:t[0]=r+a,t[1]=a,t[2]=n+a;break;case 5:case 6:t[0]=n+a,t[1]=a,t[2]=r+a;break}}function $a(o){return o<=.03928?o/12.92:((o+.055)/1.055)**2.4}function Wa(o,t,e){mr(o,e),e.map($a);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];mr(t,e),e.map($a);const i=.2126*e[0]+.7152*e[1]+.0722*e[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const Va=new Map;function ul(o,t){const e=o[0]+o[1]*256+o[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let s=Va.get(e);if(s)return s;const i=new Float32Array(9),n=i.subarray(0,3),r=i.subarray(3,6);ja(o,r);const a=i.subarray(6,9);ja(t,a);const l=a[2]<.5,h=l?12:4.5;if(r[2]=l?Math.sqrt(r[2]):1-Math.sqrt(1-r[2]),Wa(r,a,n)<h){let c,d;l?(c=r[2],d=1):(c=0,d=r[2]);const u=.005;for(;d-c>u;){const f=r[2]=(c+d)/2;l===Wa(r,a,n)<h?c=f:d=f}r[2]=l?d:c}return mr(r,n),s=F.makeHexColor(Math.round(n[0]*255),Math.round(n[1]*255),Math.round(n[2]*255)),Va.set(e,s),s}function $r({html:o,dir:t,className:e},s){const i=document.createDocumentFragment();if(typeof o=="string"){const n=document.createElement("p");n.dir=t||"auto";const r=o.split(/(?:\r\n?|\n)/);for(let a=0,l=r.length;a<l;++a){const h=r[a];n.append(document.createTextNode(h)),a<l-1&&n.append(document.createElement("br"))}i.append(n)}else jr.render({xfaHtml:o,div:i,intent:"richText"});i.firstElementChild.classList.add("richText",e),s.append(i)}function fl(o){const t=new Path2D;if(!o)return t;for(let e=0,s=o.length;e<s;)switch(o[e++]){case Ci.moveTo:t.moveTo(o[e++],o[e++]);break;case Ci.lineTo:t.lineTo(o[e++],o[e++]);break;case Ci.curveTo:t.bezierCurveTo(o[e++],o[e++],o[e++],o[e++],o[e++],o[e++]);break;case Ci.quadraticCurveTo:t.quadraticCurveTo(o[e++],o[e++],o[e++],o[e++]);break;case Ci.closePath:t.closePath();break;default:K(`Unrecognized drawing path operator: ${o[e-1]}`);break}return t}class Ui{#t=null;#e=null;#i;#s=null;#a=null;#r=null;#n=null;#o=null;static#h=null;constructor(t){this.#i=t,Ui.#h||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#i._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",ke,{signal:e}),t.addEventListener("pointerdown",Ui.#l,{signal:e}));const s=this.#s=document.createElement("div");s.className="buttons",t.append(s);const i=this.#i.toolbarPosition;if(i){const{style:n}=t,r=this.#i._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#u(t){this.#i._focusEventsAllowed=!1,Lt(t)}#d(t){this.#i._focusEventsAllowed=!0,Lt(t)}#f(t){const e=this.#i._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#u.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",ke,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#i,s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",Ui.#h[t]),this.#f(s)&&s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),this.#s.append(s)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#s.append(e,this.#m),this.#a=t}addComment(t,e=null){if(this.#r)return;const s=t.renderForToolbar();if(!s)return;this.#f(s);const i=this.#n=this.#m;e?(this.#s.insertBefore(s,e),this.#s.insertBefore(i,e)):this.#s.append(s,i),this.#r=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#s.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#o=await t.renderEditButton(this.#i);this.#f(e),this.#s.append(e,this.#m)}removeButton(t){t==="comment"&&(this.#r?.removeToolbarCommentButton(),this.#r=null,this.#n?.remove(),this.#n=null)}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,s){if(!e&&t==="comment")return;const i=this.#s.querySelector(s);i&&t==="comment"&&this.addComment(e,i)}updateEditSignatureButton(t){this.#o&&(this.#o.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class Jc{#t=null;#e=null;#i;constructor(t){this.#i=t}#s(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#i._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",ke,{signal:e});const s=this.#t=document.createElement("div");return s.className="buttons",t.append(s),this.#i.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#i.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#i.highlightSelection("floating_button")}),t}#a(t,e){let s=0,i=0;for(const n of t){const r=n.y+n.height;if(r<s)continue;const a=n.x+(e?n.width:0);if(r>s){i=a,s=r;continue}e?a>i&&(i=a):a<i&&(i=a)}return[e?1-i:i,s]}show(t,e,s){const[i,n]=this.#a(e,s),{style:r}=this.#e||=this.#s();t.append(this.#e),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#r(t,e,s,i){const n=document.createElement("button");n.classList.add("basic",t),n.tabIndex=0,n.setAttribute("data-l10n-id",e);const r=document.createElement("span");n.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",s);const a=this.#i._signal;a instanceof AbortSignal&&!a.aborted&&(n.addEventListener("contextmenu",ke,{signal:a}),n.addEventListener("click",i,{signal:a})),this.#t.append(n)}}function pl(o,t,e){for(const s of e)t.addEventListener(s,o[s].bind(o))}class mt{static#t=NaN;static#e=null;static#i=NaN;static#s=null;static initializeAndAddPointerId(t){(mt.#e||=new Set).add(t)}static setPointer(t,e){mt.#t||=e,mt.#s??=t}static setTimeStamp(t){mt.#i=t}static isSamePointerId(t){return mt.#t===t}static isSamePointerIdOrRemove(t){return mt.#t===t?!0:(mt.#e?.delete(t),!1)}static isSamePointerType(t){return mt.#s===t}static isInitializedAndDifferentPointerType(t){return mt.#s!==null&&!mt.isSamePointerType(t)}static isSameTimeStamp(t){return mt.#i===t}static isUsingMultiplePointers(){return mt.#e?.size>=1}static clearPointerType(){mt.#s=null}static clearPointerIds(){mt.#t=NaN,mt.#e=null}static clearTimeStamp(){mt.#i=NaN}}class Qc{#t=0;get id(){return`${zi}${this.#t++}`}}class Wr{#t=zr();#e=0;#i=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return X(this,"_isSVGFittingCanvas",n)}async#s(t,e){this.#i||=new Map;let s=this.#i.get(t);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof e=="string"?(s.url=e,i=await Ei(e,"blob")):e instanceof File?i=s.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){const n=Wr._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((h,c)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,h()},r.onload=async()=>{const d=s.svgUrl=r.result;a.src=await n?`${d}#svgView(preserveAspectRatio(none))`:d},a.onerror=r.onerror=c});r.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){K(i),s=null}return this.#i.set(t,s),s&&this.#i.set(s.id,s),s}async getFromFile(t){const{lastModified:e,name:s,size:i,type:n}=t;return this.#s(`${e}_${s}_${i}_${n}`,t)}async getFromUrl(t){return this.#s(t,t)}async getFromBlob(t,e){const s=await e;return this.#s(t,s)}async getFromId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#i||=new Map;let s=this.#i.get(t);if(s?.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(t,s),this.#i.set(s.id,s),s}getSvgUrl(t){const e=this.#i.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=i.convertToBlob()}s.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class Zc{#t=[];#e=!1;#i;#s=-1;constructor(t=128){this.#i=t}add({cmd:t,undo:e,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(i&&t(),this.#e)return;const l={cmd:t,undo:e,post:s,type:n};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(l);return}if(r&&this.#t[this.#s].type===n){a&&(l.undo=this.#t[this.#s].undo),this.#t[this.#s]=l;return}const h=this.#s+1;h===this.#i?this.#t.splice(0,1):(this.#s=h,h<this.#t.length&&this.#t.splice(h)),this.#t.push(l)}undo(){if(this.#s===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(t){if(this.#s!==-1){for(let e=this.#s;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#s-e),this.#s=e;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}}class tn{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Ut.platform;for(const[s,i,n={}]of t)for(const r of s){const a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(this.#t(e));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:r=[],checker:a=null}}=s;a&&!a(t,e)||(i.bind(t,...r,e)(),n||Lt(e))}}class Vr{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return Yc(t),X(this,"_colors",t)}convert(t){const e=xi(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((n,r)=>n===e[r]))return Vr._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?F.makeHexColor(...e):t}}class ds{#t=new AbortController;#e=null;#i=null;#s=new Map;#a=new Map;#r=null;#n=null;#o=null;#h=new Zc;#l=null;#u=null;#d=null;#f=0;#m=new Set;#p=null;#c=null;#g=new Set;_editorUndoBar=null;#b=!1;#w=!1;#v=!1;#E=null;#S=null;#y=null;#T=null;#_=!1;#x=null;#M=new Qc;#P=!1;#k=!1;#N=!1;#D=null;#I=null;#B=null;#F=null;#W=null;#C=Y.NONE;#A=new Set;#L=null;#U=null;#z=null;#q=null;#G=null;#X={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#j=[0,0];#O=null;#V=null;#Q=null;#Z=null;#H=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ds.prototype,e=r=>r.#V.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),s=(r,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return X(this,"_keyboardManager",new tn([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#V.contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#V.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}constructor(t,e,s,i,n,r,a,l,h,c,d,u,f,p,g,b){const v=this._signal=this.#t.signal;this.#V=t,this.#Q=e,this.#Z=s,this.#r=i,this.#l=n,this.#U=r,this.#G=l,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:v}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:v}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:v}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:v}),a._on("setpreference",this.onSetPreference.bind(this),{signal:v}),a._on("switchannotationeditorparams",w=>this.updateParams(w.type,w.value),{signal:v}),window.addEventListener("pointerdown",()=>{this.#k=!0},{capture:!0,signal:v}),window.addEventListener("pointerup",()=>{this.#k=!1},{capture:!0,signal:v}),this.#at(),this.#ut(),this.#et(),this.#n=l.annotationStorage,this.#E=l.filterFactory,this.#z=h,this.#T=c||null,this.#b=d,this.#w=u,this.#v=f,this.#W=p||null,this.viewParameters={realScale:Ws.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=b!==!1,n?.setSidebarUiManager(this)}destroy(){this.#H?.resolve(),this.#H=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#a.values())t.destroy();this.#a.clear(),this.#s.clear(),this.#g.clear(),this.#F?.clear(),this.#e=null,this.#A.clear(),this.#h.destroy(),this.#r?.destroy(),this.#l?.destroy(),this.#U?.destroy(),this.#x?.hide(),this.#x=null,this.#B?.destroy(),this.#B=null,this.#i=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this._editorUndoBar?.destroy(),this.#G=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#W}get useNewAltTextFlow(){return this.#w}get useNewAltTextWhenAddingImage(){return this.#v}get hcmFilter(){return X(this,"hcmFilter",this.#z?this.#E.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return X(this,"direction",getComputedStyle(this.#V).direction)}get _highlightColors(){return X(this,"_highlightColors",this.#T?new Map(this.#T.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return X(this,"highlightColors",null);const e=new Map,s=!!this.#z;for(const[i,n]of t){const r=i.endsWith("_HCM");if(s&&r){e.set(i.replace("_HCM",""),n);continue}!s&&!r&&e.set(i,n)}return X(this,"highlightColors",e)}get highlightColorNames(){return X(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=t}setMainHighlightColorPicker(t){this.#B=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,s,i){this.#l?.showDialog(this,t,e,s,i)}selectComment(t,e){this.#a.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}toggleComment(t,e,s=void 0){this.#l?.toggleCommentPopup(t,e,s)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#a.has(t-1))return;const{resolve:e,promise:s}=Promise.withResolvers(),i=n=>{n.pageNumber===t&&(this._eventBus._off("editorsrendered",i),e())};this._eventBus.on("editorsrendered",i),await s}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){t==="enableNewAltTextWhenAddingImage"&&(this.#v=e)}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#V.focus()}findParent(t,e){for(const s of this.#a.values()){const{x:i,y:n,width:r,height:a}=s.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=n&&e<=n+a)return s}return null}disableUserSelect(t=!1){this.#Q.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#g.add(t)}removeShouldRescale(t){this.#g.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Ws.PDF_TO_CSS_UNITS;for(const e of this.#g)e.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#J({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of this.#a.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t="",e=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a}=s,l=s.toString(),c=this.#J(s).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;s.empty();const u=this.#tt(c),f=this.#C===Y.NONE,p=()=>{const g=u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a,text:l});f&&this.showAllEditors("highlight",!0,!0),e&&g?.editComment()};if(f){this.switchToMode(Y.HIGHLIGHT,p);return}p()}commentSelection(t=""){this.highlightSelection(t,!0)}#nt(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=this.#J(t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(this.#x||=new Jc(this),this.#x.show(s,i,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#n)return null;const e=`${zi}${t}`,s=this.#n.getRawValue(e);return s&&this.#n.remove(e),s}addToAnnotationStorage(t){!t.isEmpty()&&this.#n&&!this.#n.has(t.id)&&this.#n.setValue(t.id,t)}a11yAlert(t,e=null){const s=this.#Z;s&&(s.setAttribute("data-l10n-id",t),e?s.setAttribute("data-l10n-args",JSON.stringify(e)):s.removeAttribute("data-l10n-args"))}#rt(){const t=document.getSelection();if(!t||t.isCollapsed){this.#L&&(this.#x?.hide(),this.#L=null,this.#R({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#L)return;const i=this.#J(t).closest(".textLayer");if(!i){this.#L&&(this.#x?.hide(),this.#L=null,this.#R({hasSelectedText:!1}));return}if(this.#x?.hide(),this.#L=e,this.#R({hasSelectedText:!0}),!(this.#C!==Y.HIGHLIGHT&&this.#C!==Y.NONE)&&(this.#C===Y.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#_=this.isShiftKeyDown,!this.isShiftKeyDown)){const n=this.#C===Y.HIGHLIGHT?this.#tt(i):null;if(n?.toggleDrawing(),this.#k){const r=new AbortController,a=this.combinedSignal(r),l=h=>{h.type==="pointerup"&&h.button!==0||(r.abort(),n?.toggleDrawing(!0),h.type==="pointerup"&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}else n?.toggleDrawing(!0),this.#Y("main_toolbar")}}#Y(t=""){this.#C===Y.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#nt()}#at(){document.addEventListener("selectionchange",this.#rt.bind(this),{signal:this._signal})}#ot(){if(this.#y)return;this.#y=new AbortController;const t=this.combinedSignal(this.#y);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#lt(){this.#y?.abort(),this.#y=null}blur(){if(this.isShiftKeyDown=!1,this.#_&&(this.#_=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#A)if(e.div.contains(t)){this.#I=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#I)return;const[t,e]=this.#I;this.#I=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#D)return;this.#D=new AbortController;const t=this.combinedSignal(this.#D);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ht(){this.#D?.abort(),this.#D=null}#ct(){if(this.#u)return;this.#u=new AbortController;const t=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#dt(){this.#u?.abort(),this.#u=null}#ut(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.setEditingState(!0)}removeEditListeners(){this.#ht(),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of this.#c)if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#c)if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of this.#A){const i=s.serialize(!0);i&&e.push(i)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const r of this.#c)if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){K(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const l of s){const h=await i.deserialize(l);if(!h)return;n.push(h)}const r=()=>{for(const l of n)this.#st(l);this.#it(n)},a=()=>{for(const l of n)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(n){K(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#C!==Y.NONE&&!this.isEditorHandlingKeyboard&&ds._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#_&&(this.#_=!1,this.#Y("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#R(t){Object.entries(t).some(([s,i])=>this.#X[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#X,t)}),this.#C===Y.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#$([[nt.HIGHLIGHT_FREE,!0]]))}#$(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ot(),this.#ct(),this.#R({isEditing:this.#C!==Y.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#h.hasSomethingToUndo(),hasSomethingToRedo:this.#h.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#lt(),this.#dt(),this.#R({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#c){this.#c=t;for(const e of this.#c)this.#$(e.defaultPropertiesToUpdate)}}getId(){return this.#M.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(t){return this.#a.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#a.set(t.pageIndex,t),this.#P?t.enable():t.disable()}removeLayer(t){this.#a.delete(t.pageIndex)}async updateMode(t,e=null,s=!1,i=!1,n=!1,r=!1){if(this.#C!==t&&!(this.#H&&(await this.#H.promise,!this.#H))){if(this.#H=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#C===Y.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#C=t,t===Y.NONE){this.setEditingState(!1),this.#pt();for(const a of this.#s.values())a.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#H.resolve();return}for(const a of this.#s.values())a.addStandaloneCommentButton();t===Y.SIGNATURE&&await this.#U?.loadSignatures(),s&&mt.clearPointerType(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const a of this.#a.values())a.updateMode(t);if(t===Y.POPUP){this.#i||=await this.#G.getAnnotationsByType(new Set(this.#c.map(h=>h._editorType)));const a=new Set,l=[];for(const h of this.#s.values()){const{annotationElementId:c,hasComment:d,deleted:u}=h;c&&a.add(c),d&&!u&&l.push(h.getData())}for(const h of this.#i){const{id:c,popupRef:d,contentsObj:u}=h;d&&u?.str&&!a.has(c)&&!this.#m.has(c)&&l.push(h)}this.#l?.showSidebar(l)}if(!e){i&&this.addNewEditorFromKeyboard(),this.#H.resolve();return}for(const a of this.#s.values())a.uid===e?(this.setSelected(a),r?a.editComment():n?a.enterInEditMode():a.focus()):a.unselect();this.#H.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#C&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#c){switch(t){case nt.CREATE:this.currentLayer.addNewEditor(e);return;case nt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#q||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const s of this.#A)s.updateParams(t,e);else for(const s of this.#c)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){for(const n of this.#s.values())n.editorType===t&&n.show(e);(this.#q?.get(nt.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#$([[nt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#N!==t){this.#N=t;for(const e of this.#a.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#P){this.#P=!0;const t=[];for(const e of this.#a.values())t.push(e.enable());await Promise.all(t);for(const e of this.#s.values())e.enable()}}#pt(){if(this.unselectAll(),this.#P){this.#P=!1;for(const t of this.#a.values())t.disable();for(const t of this.#s.values())t.disable()}}*getEditors(t){for(const e of this.#s.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#s.get(t)}addEditor(t){this.#s.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#s.delete(t.id),t.annotationElementId&&this.#F?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#m.has(t.annotationElementId))&&this.#n?.remove(t.id)}addDeletedAnnotationElement(t){this.#m.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#m.has(t)}removeDeletedAnnotationElement(t){this.#m.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#st(t){const e=this.#a.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#$(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#A);return t}updateUI(t){this.#gt===t&&this.#$(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#$(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#A.has(t)){this.#A.delete(t),t.unselect(),this.#R({hasSelectedEditor:this.hasSelection});return}this.#A.add(t),t.select(),this.#$(t.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.uid}),this.#d?.commitOrRemove();for(const e of this.#A)e!==t&&e.unselect();this.#A.clear(),this.#A.add(t),t.select(),this.#$(t.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}isSelected(t){return this.#A.has(t)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(t){t.unselect(),this.#A.delete(t),this.#R({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#A.size!==0}get isEnterHandled(){return this.#A.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#h.undo(),this.#R({hasSomethingToUndo:this.#h.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#h.redo(),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:this.#h.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#h.add(t),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#h.cleanType(t)}#K(){if(this.#s.size===0)return!0;if(this.#s.size===1)for(const t of this.#s.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#A],s=()=>{this._editorUndoBar?.show(i,e.length===1?e[0].editorType:e.length);for(const n of e)n.remove()},i=()=>{for(const n of e)this.#st(n)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#it(t){for(const e of this.#A)e.unselect();this.#A.clear();for(const e of t)e.isEmpty()||(this.#A.add(e),e.select());this.#R({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#A)t.commit();this.#it(this.#s.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#C!==Y.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const t of this.#A)t.unselect();this.#A.clear(),this.#R({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#j[0]+=t,this.#j[1]+=e;const[i,n]=this.#j,r=[...this.#A],a=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#j[0]=this.#j[1]=0,this.addCommands({cmd:()=>{for(const l of r)this.#s.has(l.id)&&(l.translateInPage(i,n),l.translationDone())},undo:()=>{for(const l of r)this.#s.has(l.id)&&(l.translateInPage(-i,-n),l.translationDone())},mustExec:!1})},a);for(const l of r)l.translateInPage(t,e),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const t of this.#A)this.#p.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const t=this.#p;this.#p=null;let e=!1;for(const[{x:i,y:n,pageIndex:r},a]of t)a.newX=i,a.newY=n,a.newPageIndex=r,e||=i!==a.savedX||n!==a.savedY||r!==a.savedPageIndex;if(!e)return!1;const s=(i,n,r,a)=>{if(this.#s.has(i.id)){const l=this.#a.get(a);l?i._setParentAndPosition(l,n,r):(i.pageIndex=a,i.x=n,i.y=r)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:r,newPageIndex:a}]of t)s(i,n,r,a)},undo:()=>{for(const[i,{savedX:n,savedY:r,savedPageIndex:a}]of t)s(i,n,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#p)for(const s of this.#p.keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#A.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#C}isEditingMode(){return this.#C!==Y.NONE}get imageManager(){return X(this,"imageManager",new Wr)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let h=0,c=e.rangeCount;h<c;h++)if(!t.contains(e.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:r}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(h,c,d,u)=>({x:(c-i)/r,y:1-(h+d-s)/n,width:u/r,height:d/n});break;case"180":a=(h,c,d,u)=>({x:1-(h+d-s)/n,y:1-(c+u-i)/r,width:d/n,height:u/r});break;case"270":a=(h,c,d,u)=>({x:1-(c+u-i)/r,y:(h-s)/n,width:u/r,height:d/n});break;default:a=(h,c,d,u)=>({x:(h-s)/n,y:(c-i)/r,width:d/n,height:u/r});break}const l=[];for(let h=0,c=e.rangeCount;h<c;h++){const d=e.getRangeAt(h);if(!d.collapsed)for(const{x:u,y:f,width:p,height:g}of d.getClientRects())p===0||g===0||l.push(a(u,f,p,g))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const s=this.#n.getRawValue(e);s&&(this.#C===Y.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){const i=this.#F?.get(t);i&&(i.setCanvas(e,s),this.#F.delete(t))}addMissingCanvas(t,e){(this.#F||=new Map).set(t,e)}}class qe{#t=null;#e=!1;#i=null;#s=null;#a=null;#r=null;#n=!1;#o=null;#h=null;#l=null;#u=null;#d=!1;static#f=null;static _l10n=null;constructor(t){this.#h=t,this.#d=t._uiManager.useNewAltTextFlow,qe.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){qe._l10n??=t}async render(){const t=this.#i=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#s=document.createElement("span");t.append(e),this.#d?(t.classList.add("new"),t.setAttribute("data-l10n-id",qe.#f.missing),e.setAttribute("data-l10n-id",qe.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#h._uiManager._signal;t.addEventListener("contextmenu",ke,{signal:s}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),this.#h._uiManager.editAltText(this.#h),this.#d&&this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#n=!0,i(n))},{signal:s}),await this.#p(),t}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#n}),this.#n=!1)}isEmpty(){return this.#d?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#d?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#u=await qe._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())}toggleAltTextBadge(t=!1){if(!this.#d||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#h.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#u),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(this.#l=s,this.#u=i),!(this.#t===t&&this.#e===e)&&(n||(this.#t=t,this.#e=e),this.#p())}toggle(t=!1){this.#i&&(!t&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#i.disabled=!t)}shown(){this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#a=null,this.#o?.remove(),this.#o=null}async#p(){const t=this.#i;if(!t)return;if(this.#d){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",qe.#f[this.#m]),this.#s?.setAttribute("data-l10n-id",qe.#f[`${this.#m}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#a;if(!e){this.#a=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#h.id}`;const i=100,n=this.#h._uiManager._signal;n.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#a.classList.add("show"),this.#h._reportTelemetry({action:"alt_text_tooltip"})},i)},{signal:n}),t.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#a?.classList.remove("show")},{signal:n})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#h.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}let cn=class{#t=null;#e=null;#i=!1;#s=null;#a=null;#r=null;#n=null;#o=null;#h=!1;#l=null;constructor(t){this.#s=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#u(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#s.commentButtonPosition;if(e){const{style:s}=t;s.insetInlineEnd=`calc(${100*(this.#s._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const i=this.#s.commentButtonColor;i&&(s.backgroundColor=i)}return this.#u(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#s.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#s._uiManager.updatePopupColor(this.#s)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#s.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:s}=this.#t.getBoundingClientRect(),{x:i,y:n,width:r,height:a}=this.#s.parent.boundingClientRect;return[(t-i)/r,(e+s-n)/a]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#u(t,e){if(!this.#s._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#s._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=this.#s._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return t;t.addEventListener("contextmenu",ke,{signal:s}),e&&(t.addEventListener("focusin",n=>{this.#s._focusEventsAllowed=!1,Lt(n)},{capture:!0,signal:s}),t.addEventListener("focusout",n=>{this.#s._focusEventsAllowed=!0,Lt(n)},{capture:!0,signal:s})),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),t===this.#e?this.edit():this.#s.toggleComment(!0)};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#i=!0,i(n))},{signal:s}),t.addEventListener("pointerenter",()=>{this.#s.toggleComment(!1,!0)},{signal:s}),t.addEventListener("pointerleave",()=>{this.#s.toggleComment(!1,!1)},{signal:s}),t}edit(t){const e=this.commentPopupPositionInLayer;let s,i;if(e)[s,i]=e;else{[s,i]=this.#s.commentButtonPosition;const{width:c,height:d,x:u,y:f}=this.#s;s=u+s*c,i=f+i*d}const n=this.#s.parent.boundingClientRect,{x:r,y:a,width:l,height:h}=n;this.#s._uiManager.editComment(this.#s,r+s*l,a+i*h,{...t,parentDimensions:n})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#i}),this.#i=!1)}isDeleted(){return this.#h||this.#n===""}isEmpty(){return this.#n===null}hasBeenEdited(){return this.isDeleted()||this.#n!==this.#a}serialize(){return this.data}get data(){return{text:this.#n,richText:this.#r,date:this.#o,deleted:this.isDeleted()}}set data(t){if(t!==this.#n&&(this.#r=null),t===null){this.#n="",this.#h=!0;return}this.#n=t,this.#o=new Date,this.#h=!1}setInitialText(t,e=null){this.#a=t,this.data=t,this.#o=null,this.#r=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#n="",this.#r=null,this.#o=null,this.#s=null,this.#i=!1,this.#h=!1}};class en{#t;#e=!1;#i=null;#s;#a;#r;#n;#o=null;#h;#l=null;#u;#d=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:a}){this.#t=t,this.#i=s,this.#s=e,this.#a=i,this.#r=n,this.#n=r,this.#u=new AbortController,this.#h=AbortSignal.any([a,this.#u.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#h})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ze.pixelRatio}#f(t){if(this.#s?.())return;if(t.touches.length===1){if(this.#o)return;const i=this.#o=new AbortController,n=AbortSignal.any([this.#h,i.signal]),r=this.#t,a={capture:!0,signal:n,passive:!1},l=h=>{h.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};r.addEventListener("pointerdown",h=>{h.pointerType==="touch"&&(Lt(h),l(h))},a),r.addEventListener("pointerup",l,a),r.addEventListener("pointercancel",l,a);return}if(!this.#d){this.#d=new AbortController;const i=AbortSignal.any([this.#h,this.#d.signal]),n=this.#t,r={signal:i,capture:!1,passive:!1};n.addEventListener("touchmove",this.#m.bind(this),r);const a=this.#p.bind(this);n.addEventListener("touchend",a,r),n.addEventListener("touchcancel",a,r),r.capture=!0,n.addEventListener("pointerdown",Lt,r),n.addEventListener("pointermove",Lt,r),n.addEventListener("pointercancel",Lt,r),n.addEventListener("pointerup",Lt,r),this.#a?.()}if(Lt(t),t.touches.length!==2||this.#i?.()){this.#l=null;return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#m(t){if(!this.#l||t.touches.length!==2)return;Lt(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:n}=e,{screenX:r,screenY:a}=s,l=this.#l,{touch0X:h,touch0Y:c,touch1X:d,touch1Y:u}=l,f=d-h,p=u-c,g=r-i,b=a-n,v=Math.hypot(g,b)||1,w=Math.hypot(f,p)||1;if(!this.#e&&Math.abs(w-v)<=en.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=r,l.touch1Y=a,!this.#e){this.#e=!0;return}const y=[(i+r)/2,(n+a)/2];this.#r?.(y,w,v)}#p(t){t.touches.length>=2||(this.#d&&(this.#d.abort(),this.#d=null,this.#n?.()),this.#l&&(Lt(t),this.#l=null,this.#e=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#o?.abort(),this.#o=null}}class W{#t=null;#e=null;#i=null;#s=null;#a=null;#r=!1;#n=null;#o="";#h=null;#l=null;#u=null;#d=null;#f=null;#m="";#p=!1;#c=null;#g=!1;#b=!1;#w=!1;#v=null;#E=0;#S=0;#y=null;#T=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#_=!1;#x=W._zIndex++;static _borderLineWidth=-1;static _colorManager=new Vr;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=W.prototype._resizeWithKeyboard,e=ds.TRANSLATE_SMALL,s=ds.TRANSLATE_BIG;return X(this,"_resizerKeyboardManager",new tn([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],W.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,r];const[a,l]=this.parentDimensions;this.x=t.x/a,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return X(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new td({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(W._l10n??=t,W._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),W._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);W._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){xt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#_}set _isDraggable(t){this.#_=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#x}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#O(),this.#d?.remove(),this.#d=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#p?this.#p=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[n,r]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/n,this.y=(e+i)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i),this._onTranslated()}#M([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#M(this.parentDimensions,t,e)}translateInPage(t,e){this.#c||=[this.x,this.y,this.width,this.height],this.#M(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#c||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[i,n]}=this;if(this.x+=t/i,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[l,h]=this.getBaseTranslation();r+=l,a+=h;const{style:c}=s;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#c&&(this.#c[0]!==this.x||this.#c[1]!==this.y)}get _hasBeenResized(){return!!this.#c&&(this.#c[2]!==this.width||this.#c[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=W,i=s/t,n=s/e;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:n,y:r,width:a,height:l}=this;if(a*=s,l*=i,n*=s,r*=i,this._mustFixPosition)switch(t){case 0:n=ie(n,0,s-a),r=ie(r,0,i-l);break;case 90:n=ie(n,0,s-l),r=ie(r,a,i);break;case 180:n=ie(n,a,s),r=ie(r,l,i);break;case 270:n=ie(n,l,s),r=ie(r,0,i-a);break}this.x=n/=s,this.y=r/=i;const[h,c]=this.getBaseTranslation();n+=h,r+=c,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#P(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return W.#P(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return W.#P(t,e,360-this.parentRotation)}#k(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(){const{div:{style:t},width:e,height:s}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#N(){if(this.#h)return;this.#h=document.createElement("div"),this.#h.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");this.#h.append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",this.#D.bind(this,s),{signal:e}),i.addEventListener("contextmenu",ke,{signal:e}),i.tabIndex=-1}this.div.prepend(this.#h)}#D(t,e){e.preventDefault();const{isMac:s}=Ut.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#i?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#F.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Lt,{passive:!1,signal:r}),window.addEventListener("contextmenu",ke,{signal:r}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const h=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#B()};window.addEventListener("pointerup",h,{signal:r}),window.addEventListener("blur",h,{signal:r})}#I(t,e,s,i){this.width=s,this.height=i,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#B(){if(!this.#u)return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=this.#u;this.#u=null;const n=this.x,r=this.y,a=this.width,l=this.height;n===t&&r===e&&a===s&&l===i||this.addCommands({cmd:this.#I.bind(this,n,r,a,l),undo:this.#I.bind(this,t,e,s,i),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#F(t,e){const[s,i]=this.parentDimensions,n=this.x,r=this.y,a=this.width,l=this.height,h=W.MIN_SIZE/s,c=W.MIN_SIZE/i,d=this.#k(this.rotation),u=(L,O)=>[d[0]*L+d[2]*O,d[1]*L+d[3]*O],f=this.#k(360-this.rotation),p=(L,O)=>[f[0]*L+f[2]*O,f[1]*L+f[3]*O];let g,b,v=!1,w=!1;switch(t){case"topLeft":v=!0,g=(L,O)=>[0,0],b=(L,O)=>[L,O];break;case"topMiddle":g=(L,O)=>[L/2,0],b=(L,O)=>[L/2,O];break;case"topRight":v=!0,g=(L,O)=>[L,0],b=(L,O)=>[0,O];break;case"middleRight":w=!0,g=(L,O)=>[L,O/2],b=(L,O)=>[0,O/2];break;case"bottomRight":v=!0,g=(L,O)=>[L,O],b=(L,O)=>[0,0];break;case"bottomMiddle":g=(L,O)=>[L/2,O],b=(L,O)=>[L/2,0];break;case"bottomLeft":v=!0,g=(L,O)=>[0,O],b=(L,O)=>[L,0];break;case"middleLeft":w=!0,g=(L,O)=>[0,O/2],b=(L,O)=>[L,O/2];break}const y=g(a,l),_=b(a,l);let A=u(..._);const S=W._round(n+A[0]),E=W._round(r+A[1]);let T=1,C=1,D,R;if(e.fromKeyboard)({deltaX:D,deltaY:R}=e);else{const{screenX:L,screenY:O}=e,[j,ft]=this.#l;[D,R]=this.screenToPageTranslation(L-j,O-ft),this.#l[0]=L,this.#l[1]=O}if([D,R]=p(D/s,R/i),v){const L=Math.hypot(a,l);T=C=Math.max(Math.min(Math.hypot(_[0]-y[0]-D,_[1]-y[1]-R)/L,1/a,1/l),h/a,c/l)}else w?T=ie(Math.abs(_[0]-y[0]-D),h,1)/a:C=ie(Math.abs(_[1]-y[1]-R),c,1)/l;const I=W._round(a*T),z=W._round(l*C);A=u(...b(I,z));const U=S-A[0],Q=E-A[1];this.#c||=[this.x,this.y,this.width,this.height],this.width=I,this.height=z,this.x=U,this.y=Q,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#b)return this._editToolbar;this._editToolbar=new Ui(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,s]of t)await this._editToolbar.addButton(e,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#i?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(qe.initialize(W._l10n),this.#i=new qe(this),this.#t&&(this.#i.data=this.#t,this.#t=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(t){this.#i&&(this.#i.data=t)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(t){await this.#i?.setGuessedText(t)}serializeAltText(t){return this.#i?.serialize(t)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}focusCommentButton(){this.#s?.focusButton()}addCommentButton(){return this.canAddComment?this.#s||=new cn(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#s.renderForStandalone(),this.div.append(this.#a))}}removeStandaloneCommentButton(){this.#s.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:s,deleted:i}}=this.#s;return{text:e,richText:t,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#s||=new cn(this),this.#s.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:s}){if(!e||(this.#s||=new cn(this),this.#s.setInitialText(t,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){return this.#s?.hasBeenEdited()}get hasDeletedComment(){return this.#s?.isDeleted()}get hasComment(){return!!this.#s&&!this.#s.isEmpty()&&!this.#s.isDeleted()}async editComment(t){this.#s||=new cn(this),this.#s.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#s.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,i]=t.rect,[n]=this.pageDimensions,[r]=this.pageTranslation,a=r+n+1,l=i-100,h=a+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,l,h,i]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#s.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#z();const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),pl(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#T||=new en({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#W.bind(this),onPinching:this.#C.bind(this),onPinchEnd:this.#A.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#W(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#C(t,e,s){let n=.7*(s/e)+1-.7;if(n===1)return;const r=this.#k(this.rotation),a=(S,E)=>[r[0]*S+r[2]*E,r[1]*S+r[3]*E],[l,h]=this.parentDimensions,c=this.x,d=this.y,u=this.width,f=this.height,p=W.MIN_SIZE/l,g=W.MIN_SIZE/h;n=Math.max(Math.min(n,1/u,1/f),p/u,g/f);const b=W._round(u*n),v=W._round(f*n);if(b===u&&v===f)return;this.#c||=[c,d,u,f];const w=a(u/2,f/2),y=W._round(c+w[0]),_=W._round(d+w[1]),A=a(b/2,v/2);this.x=y-A[0],this.y=_-A[1],this.width=b,this.height=v,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#A(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#B()}pointerdown(t){const{isMac:e}=Ut.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#p=!0,this._isDraggable){this.#U(t);return}this.#L(t)}#L(t){const{isMac:e}=Ut.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:n},a=h=>{i.abort(),this.#n=null,this.#p=!1,this._uiManager.endDragSession()||this.#L(h),s&&this._onStopDragging()};e&&(this.#E=t.clientX,this.#S=t.clientY,this.#n=t.pointerId,this.#o=t.pointerType,window.addEventListener("pointermove",h=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:c,clientY:d,pointerId:u}=h;if(u!==this.#n){Lt(h);return}const[f,p]=this.screenToPageTranslation(c-this.#E,d-this.#S);this.#E=c,this.#S=d,this._uiManager.dragSelectedEditors(f,p)},r),window.addEventListener("touchmove",Lt,r),window.addEventListener("pointerdown",h=>{h.pointerType===this.#o&&(this.#T||h.isPrimary)&&a(h),Lt(h)},r));const l=h=>{if(!this.#n||this.#n===h.pointerId){a(h);return}Lt(h)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.#v=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[n,r]=this.pageDimensions,[a,l]=this.pageTranslation,h=t/i,c=e/i,d=this.x*n,u=this.y*r,f=this.width*n,p=this.height*r;switch(s){case 0:return[d+h+a,r-u-c-p+l,d+h+f+a,r-u-c+l];case 90:return[d+c+a,r-u+h+l,d+c+p+a,r-u+h+f+l];case 180:return[d-h-f+a,r-u+c+l,d-h+a,r-u+c+p+l];case 270:return[d-c-p+a,r-u-h-f+l,d-c+a,r-u-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,n,r]=t,a=n-s,l=r-i;switch(this.rotation){case 0:return[s,e-r,a,l];case 90:return[s,e-i,l,a];case 180:return[n,e-i,a,l];case 270:return[n,e-r,l,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&W._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#s?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:s,opacity:i,deleted:n,richText:r},uid:a,pageIndex:l,creationDate:h,modificationDate:c}=this;return{id:a,pageIndex:l,rect:this.getPDFRect(),richText:r,contentsObj:{str:t},creationDate:h,modificationDate:s||c,popupRef:!n,color:e,opacity:i}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#b=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#b=!1,!0):!1}isInEditMode(){return this.#b}shouldGetKeyboardEvents(){return this.#w}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return e<r&&i>0&&t<n&&s>0}#z(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#z()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});i.rotation=t.rotation,i.#t=t.accessibilityData,i._isCopy=t.isCopy||!1;const[n,r]=i.pageDimensions,[a,l,h,c]=i.getRectInCurrentCoords(t.rect,r);return i.x=a/n,i.y=l/r,i.width=h/n,i.height=c/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#v&&(clearTimeout(this.#v),this.#v=null),this.#O(),this.removeEditToolbar(),this.#y){for(const t of this.#y.values())clearTimeout(t);this.#y=null}this.parent=null,this.#T?.destroy(),this.#T=null,this.#d?.remove(),this.#d=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#N(),this.#h.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[s,i,n,r]=this.getPDFRect();return[W._round(s+(n-s)*t),W._round(i+(r-i)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#s.commentPopupPositionInLayer}set commentPopupPosition(t){this.#s.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#s.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#s.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#s?.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#h.children;if(!this.#e){this.#e=Array.from(e);const r=this.#q.bind(this),a=this.#G.bind(this),l=this._uiManager._signal;for(const h of this.#e){const c=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",r,{signal:l}),h.addEventListener("blur",a,{signal:l}),h.addEventListener("focus",this.#X.bind(this,c),{signal:l}),h.setAttribute("data-l10n-id",W._l10nResizer[c])}}const s=this.#e[0];let i=0;for(const r of e){if(r===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==i){if(n<i)for(let a=0;a<i-n;a++)this.#h.append(this.#h.firstElementChild);else if(n>i)for(let a=0;a<n-i;a++)this.#h.firstElementChild.before(this.#h.lastElementChild);let r=0;for(const a of e){const h=this.#e[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",W._l10nResizer[h])}}this.#j(0),this.#w=!0,this.#h.firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#q(t){W._resizerKeyboardManager.exec(this,t)}#G(t){this.#w&&t.relatedTarget?.parentNode!==this.#h&&this.#O()}#X(t){this.#m=this.#w?t:""}#j(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#w&&this.#F(this.#m,{deltaX:t,deltaY:e,fromKeyboard:!0})}#O(){this.#w=!1,this.#j(-1),this.#B()}_stopResizingWithKeyboard(){this.#O(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#h?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#g}set isEditing(t){this.#g=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#y||=new Map;const{action:s}=t;let i=this.#y.get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),this.#y.delete(s),this.#y.size===0&&(this.#y=null)},W._telemetryTimeout),this.#y.set(s,i);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(t){if(!this.#d&&!this.deleted){this.#d=t.addFakeAnnotation(this);return}if(this.deleted){this.#d.remove(),this.#d=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#d.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class td extends W{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Ga=3285377520,Re=4294901760,Ve=65535;class gl{constructor(t){this.h1=t?t&4294967295:Ga,this.h2=t?t&4294967295:Ga}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let g=0,b=t.length;g<b;g++){const v=t.charCodeAt(g);v<=255?e[s++]=v:(e[s++]=v>>>8,e[s++]=v&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,r=new Uint32Array(e.buffer,0,i);let a=0,l=0,h=this.h1,c=this.h2;const d=3432918353,u=461845907,f=d&Ve,p=u&Ve;for(let g=0;g<i;g++)g&1?(a=r[g],a=a*d&Re|a*f&Ve,a=a<<15|a>>>17,a=a*u&Re|a*p&Ve,h^=a,h=h<<13|h>>>19,h=h*5+3864292196):(l=r[g],l=l*d&Re|l*f&Ve,l=l<<15|l>>>17,l=l*u&Re|l*p&Ve,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(a=0,n){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4],a=a*d&Re|a*f&Ve,a=a<<15|a>>>17,a=a*u&Re|a*p&Ve,i&1?h^=a:c^=a}this.h1=h,this.h2=c}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Re|t*36045&Ve,e=e*4283543511&Re|((e<<16|t>>>16)*2950163797&Re)>>>16,t^=e>>>1,t=t*444984403&Re|t*60499&Ve,e=e*3301882366&Re|((e<<16|t>>>16)*3120437893&Re)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const vr=Object.freeze({map:null,hash:"",transfer:void 0});class Gr{#t=!1;#e=null;#i=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=this.#s.get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return this.#s.get(t)}remove(t){const e=this.#s.get(t);if(e!==void 0&&(e instanceof W&&this.#i.delete(e.annotationElementId),this.#s.delete(t),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of this.#s.values())if(s instanceof W)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#s.get(t);let i=!1;if(s!==void 0)for(const[n,r]of Object.entries(e))s[n]!==r&&(i=!0,s[n]=r);else i=!0,this.#s.set(t,e);i&&this.#a(),e instanceof W&&((this.#i||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#s.has(t)}get size(){return this.#s.size}#a(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new ml(this)}get serializable(){if(this.#s.size===0)return vr;const t=new Map,e=new gl,s=[],i=Object.create(null);let n=!1;for(const[r,a]of this.#s){const l=a instanceof W?a.serialize(!1,i):a;l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(const r of t.values())r.bitmap&&s.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:vr}get editorStats(){let t=null;const e=new Map;let s=0,i=0;for(const n of this.#s.values()){if(!(n instanceof W)){n.popup&&(n.popup.deleted?i+=1:s+=1);continue}n.isCommentDeleted?i+=1:n.hasEditedComment&&(s+=1);const r=n.telemetryFinalData;if(!r)continue;const{type:a}=r;e.has(a)||e.set(a,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const l=t[a]||=new Map;for(const[h,c]of Object.entries(r)){if(h==="type")continue;let d=l.get(h);d||(d=new Map,l.set(h,d));const u=d.get(c)??0;d.set(c,u+1)}}if((i>0||s>0)&&(t||=Object.create(null),t.comments={deleted:i,edited:s}),!t)return null;for(const[n,r]of e)t[n]=r.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const s=this.#i?.get(t);return s?(s.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#i?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#i)for(const e of this.#i.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#s.entries()}}class ml extends Gr{#t;constructor(t){super();const{map:e,hash:s,transfer:i}=t.serializable,n=structuredClone(e,i?{transfer:i}:null);this.#t={map:n,hash:s,transfer:i}}get print(){xt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return X(this,"modifiedIds",{ids:new Set,hash:""})}}class ed{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||this.#t.has(t.loadedName))){if(ot(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:r}=t,a=new FontFace(i,n,r);this.addNativeFontFace(a);try{await a.load(),this.#t.add(i),s?.(t)}catch{K(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}xt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw K(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return X(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return X(this,"isSyncFontLoadingSupported",oe||Ut.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(ot(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return X(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(_,A){return _.charCodeAt(A)<<24|_.charCodeAt(A+1)<<16|_.charCodeAt(A+2)<<8|_.charCodeAt(A+3)&255}function i(_,A,S,E){const T=_.substring(0,A),C=_.substring(A+S);return T+E+C}let n,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let h=0;function c(_,A){if(++h>30){K("Load test font never loaded."),A();return}if(l.font="30px "+_,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){A();return}setTimeout(c.bind(null,_,A))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=i(u,976,d.length,d);const p=16,g=1482184792;let b=s(u,p);for(n=0,r=d.length-3;n<r;n+=4)b=b-g+s(d,n)|0;n<d.length&&(b=b-g+s(d+"XXX",n)|0),u=i(u,p,4,jc(b));const v=`url(data:font/opentype;base64,${btoa(u)});`,w=`@font-face {font-family:"${d}";src:${v}}`;this.insertRule(w);const y=this._document.createElement("div");y.style.visibility="hidden",y.style.width=y.style.height="10px",y.style.position="absolute",y.style.top=y.style.left="0px";for(const _ of[t.loadedName,d]){const A=this._document.createElement("span");A.textContent="Hi",A.style.fontFamily=_,y.append(A)}this._document.body.append(y),c(d,()=>{y.remove(),e.complete()})}}class sd{#t;constructor(t,e=null,s,i){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${al(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(r){K(`getPathGenerator - ignoring character: "${r}".`)}const n=fl(i?.path);return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=n}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}set disableFontFace(t){X(this,"disableFontFace",!!t)}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}set bbox(t){X(this,"bbox",t)}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}class oi{#t;#e;#i;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,s={};let i=0;for(const h of oi.strings){const c=e.encode(t[h]);s[h]=c,i+=4+c.length}const n=new ArrayBuffer(i),r=new Uint8Array(n),a=new DataView(n);let l=0;for(const h of oi.strings){const c=s[h],d=c.length;a.setUint32(l,d),r.set(c,l+4),l+=4+d}return ot(l===n.byteLength,"CssFontInfo.write: Buffer overflow"),n}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}#s(t){ot(t<oi.strings.length,"Invalid string index");let e=0;for(let i=0;i<t;i++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,s))}get fontFamily(){return this.#s(0)}get fontWeight(){return this.#s(1)}get italicAngle(){return this.#s(2)}}class li{#t;#e;#i;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,s={};let i=0;for(const u of li.strings){const f=e.encode(t[u]);s[u]=f,i+=4+f.length}i+=4;let n,r,a=1+i;t.style&&(n=e.encode(t.style.style),r=e.encode(t.style.weight),a+=4+n.length+4+r.length);const l=new ArrayBuffer(a),h=new Uint8Array(l),c=new DataView(l);let d=0;c.setUint8(d++,t.guessFallback?1:0),c.setUint32(d,0),d+=4,i=0;for(const u of li.strings){const f=s[u],p=f.length;i+=4+p,c.setUint32(d,p),h.set(f,d+4),d+=4+p}return c.setUint32(d-i-4,i),t.style&&(c.setUint32(d,n.length),h.set(n,d+4),d+=4+n.length,c.setUint32(d,r.length),h.set(r,d+4),d+=4+r.length),ot(d<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(d)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#s(t){ot(t<li.strings.length,"Invalid string index");let e=5;for(let i=0;i<t;i++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,s))}get css(){return this.#s(0)}get loadedName(){return this.#s(1)}get baseFontName(){return this.#s(2)}get src(){return this.#s(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),s=this.#i.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const i=this.#e.getUint32(t),n=this.#i.decode(new Uint8Array(this.#t,t+4,i));return{style:s,weight:n}}}class At{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#i=this.#e+1+8;static#s=this.#i+1+48;static#a=this.#s+1+6;#r;#n;#o;constructor({data:t,extra:e}){this.#r=t,this.#n=new TextDecoder,this.#o=new DataView(this.#r),e&&Object.assign(this,e)}#h(t){ot(t<At.bools.length,"Invalid boolean index");const e=Math.floor(t/4),s=t*2%8,i=this.#o.getUint8(e)>>s&3;return i===0?void 0:i===2}get black(){return this.#h(0)}get bold(){return this.#h(1)}get disableFontFace(){return this.#h(2)}get fontExtraProperties(){return this.#h(3)}get isInvalidPDFjsFont(){return this.#h(4)}get isType3Font(){return this.#h(5)}get italic(){return this.#h(6)}get missingFile(){return this.#h(7)}get remeasure(){return this.#h(8)}get vertical(){return this.#h(9)}#l(t){return ot(t<At.numbers.length,"Invalid number index"),this.#o.getFloat64(At.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=At.#e;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<4;i++)s.push(this.#o.getInt16(t,!0)),t+=2;return s}get fontMatrix(){let t=At.#i;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<6;i++)s.push(this.#o.getFloat64(t,!0)),t+=8;return s}get defaultVMetrics(){let t=At.#s;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<3;i++)s.push(this.#o.getInt16(t,!0)),t+=2;return s}#u(t){ot(t<At.strings.length,"Invalid string index");let e=At.#a+4;for(let n=0;n<t;n++)e+=this.#o.getUint32(e)+4;const s=this.#o.getUint32(e),i=new Uint8Array(s);return i.set(new Uint8Array(this.#r,e+4,s)),this.#n.decode(i)}get fallbackName(){return this.#u(0)}get loadedName(){return this.#u(1)}get mimetype(){return this.#u(2)}get name(){return this.#u(3)}get data(){let t=At.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);t+=4+i;const n=this.#o.getUint32(t);if(n!==0)return new Uint8Array(this.#r,t+4,n)}clearData(){let t=At.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);t+=4+i;const n=this.#o.getUint32(t);new Uint8Array(this.#r,t+4,n).fill(0),this.#o.setUint32(t,0)}get cssFontInfo(){let t=At.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);if(i===0)return null;const n=new Uint8Array(i);return n.set(new Uint8Array(this.#r,t+4,i)),new oi(n.buffer)}get systemFontInfo(){let t=At.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(this.#r,t+4,s)),new li(i.buffer)}static write(t){const e=t.systemFontInfo?li.write(t.systemFontInfo):null,s=t.cssFontInfo?oi.write(t.cssFontInfo):null,i=new TextEncoder,n={};let r=0;for(const g of At.strings)n[g]=i.encode(t[g]),r+=4+n[g].length;const a=At.#a+4+r+4+(e?e.byteLength:0)+4+(s?s.byteLength:0)+4+(t.data?t.data.length:0),l=new ArrayBuffer(a),h=new Uint8Array(l),c=new DataView(l);let d=0;const u=At.bools.length;let f=0,p=0;for(let g=0;g<u;g++){const b=t[At.bools[g]];f|=(b===void 0?0:b?2:1)<<p,p+=2,(p===8||g===u-1)&&(c.setUint8(d++,f),f=0,p=0)}ot(d===At.#t,"FontInfo.write: Boolean properties offset mismatch");for(const g of At.numbers)c.setFloat64(d,t[g]),d+=8;if(ot(d===At.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){c.setUint8(d++,4);for(const g of t.bbox)c.setInt16(d,g,!0),d+=2}else c.setUint8(d++,0),d+=8;if(ot(d===At.#i,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){c.setUint8(d++,6);for(const g of t.fontMatrix)c.setFloat64(d,g,!0),d+=8}else c.setUint8(d++,0),d+=48;if(ot(d===At.#s,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){c.setUint8(d++,1);for(const g of t.defaultVMetrics)c.setInt16(d,g,!0),d+=2}else c.setUint8(d++,0),d+=6;ot(d===At.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),c.setUint32(At.#a,0),d+=4;for(const g of At.strings){const b=n[g],v=b.length;c.setUint32(d,v),h.set(b,d+4),d+=4+v}if(c.setUint32(At.#a,d-At.#a-4),!e)c.setUint32(d,0),d+=4;else{const g=e.byteLength;c.setUint32(d,g),ot(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(e),d+4),d+=4+g}if(!s)c.setUint32(d,0),d+=4;else{const g=s.byteLength;c.setUint32(d,g),ot(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(s),d+4),d+=4+g}return t.data===void 0?(c.setUint32(d,0),d+=4):(c.setUint32(d,t.data.length),h.set(t.data,d+4),d+=4+t.data.length),ot(d<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(d)}}class Vt{static#t=0;static#e=1;static#i=2;static#s=3;static#a=4;static#r=8;static#n=12;static#o=16;constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,s=null,i=[],n=[],r=[],a=[],l=null,h=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,s=t[2],r=t[3],e===1?i.push(...t[4],...t[5]):i.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,l=t[1],i=t[2],n=t[3],a=t[4]||[],s=t[6],h=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const c=Math.floor(i.length/2),d=Math.floor(n.length/3),u=r.length,f=a.length;let p=0;for(const A of a)p+=1,p=Math.ceil(p/4)*4,p+=4+A.coords.length*4,p+=4+A.colors.length*4,A.verticesPerRow!==void 0&&(p+=4);const g=20+c*8+d*3+u*8+(s?16:0)+(h?3:0)+p,b=new ArrayBuffer(g),v=new DataView(b),w=new Uint8Array(b);v.setUint8(Vt.#t,e),v.setUint8(Vt.#e,s?1:0),v.setUint8(Vt.#i,h?1:0),v.setUint8(Vt.#s,l),v.setUint32(Vt.#a,c,!0),v.setUint32(Vt.#r,d,!0),v.setUint32(Vt.#n,u,!0),v.setUint32(Vt.#o,f,!0);let y=20;new Float32Array(b,y,c*2).set(i),y+=c*8,w.set(n,y),y+=d*3;for(const[A,S]of r)v.setFloat32(y,A,!0),y+=4,v.setUint32(y,parseInt(S.slice(1),16),!0),y+=4;if(s)for(const A of s)v.setFloat32(y,A,!0),y+=4;h&&(w.set(h,y),y+=3);for(let A=0;A<a.length;A++){const S=a[A];v.setUint8(y,S.type),y+=1,y=Math.ceil(y/4)*4,v.setUint32(y,S.coords.length,!0),y+=4,new Int32Array(b,y,S.coords.length).set(S.coords),y+=S.coords.length*4,v.setUint32(y,S.colors.length,!0),y+=4,new Int32Array(b,y,S.colors.length).set(S.colors),y+=S.colors.length*4,S.verticesPerRow!==void 0&&(v.setUint32(y,S.verticesPerRow,!0),y+=4)}return b}getIR(){const t=this.view,e=this.data[Vt.#t],s=!!this.data[Vt.#e],i=!!this.data[Vt.#i],n=t.getUint32(Vt.#a,!0),r=t.getUint32(Vt.#r,!0),a=t.getUint32(Vt.#n,!0),l=t.getUint32(Vt.#o,!0);let h=20;const c=new Float32Array(this.buffer,h,n*2);h+=n*8;const d=new Uint8Array(this.buffer,h,r*3);h+=r*3;const u=[];for(let b=0;b<a;++b){const v=t.getFloat32(h,!0);h+=4;const w=t.getUint32(h,!0);h+=4,u.push([v,`#${w.toString(16).padStart(6,"0")}`])}let f=null;if(s){f=[];for(let b=0;b<4;++b)f.push(t.getFloat32(h,!0)),h+=4}let p=null;i&&(p=new Uint8Array(this.buffer,h,3),h+=3);const g=[];for(let b=0;b<l;++b){const v=t.getUint8(h);h+=1,h=Math.ceil(h/4)*4;const w=t.getUint32(h,!0);h+=4;const y=new Int32Array(this.buffer,h,w);h+=w*4;const _=t.getUint32(h,!0);h+=4;const A=new Int32Array(this.buffer,h,_);h+=_*4;const S={type:v,coords:y,colors:A};v===gr.LATTICE&&(S.verticesPerRow=t.getUint32(h,!0),h+=4),g.push(S)}if(e===1)return["RadialAxial","axial",f,u,Array.from(c.slice(0,2)),Array.from(c.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",f,u,[c[0],c[1]],[c[3],c[4]],c[2],c[5]];if(e===3){const b=this.data[Vt.#s];let v=null;if(c.length>0){let w=c[0],y=c[0],_=c[1],A=c[1];for(let S=0;S<c.length;S+=2){const E=c[S],T=c[S+1];w=w>E?E:w,_=_>T?T:_,y=y<E?E:y,A=A<T?T:A}v=[w,_,y,A]}return["Mesh",b,c,d,g,v,f,p]}throw new Error(`Unsupported pattern kind: ${e}`)}}class id{static write(t){let e,s;return Ut.isFloat16ArraySupported?(s=new ArrayBuffer(t.length*2),e=new Float16Array(s)):(s=new ArrayBuffer(t.length*4),e=new Float32Array(s)),e.set(t),s}#t;constructor(t){this.#t=t}get path(){return Ut.isFloat16ArraySupported?new Float16Array(this.#t):new Float32Array(this.#t)}}function nd(o){if(o instanceof URL)return o.href;if(typeof o=="string"){if(oe)return o;const t=URL.parse(o,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function rd(o){if(oe&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return Ji(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function dn(o){if(typeof o!="string")return null;if(o.endsWith("/"))return o;throw new Error(`Invalid factory url: "${o}" must include trailing slash.`)}const br=o=>typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0,ad=o=>typeof o=="object"&&typeof o?.name=="string",vl=Gc.bind(null,br,ad);class od{#t=new Map;#e=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[i]of this.#t)i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if(s?.signal instanceof AbortSignal){const{signal:n}=s;if(n.aborted){K("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);i=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}this.#t.set(e,i)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const un={DATA:1,ERROR:2},Nt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function qa(){}function ve(o){if(o instanceof cs||o instanceof Tn||o instanceof Ua||o instanceof ji||o instanceof Qn)return o;switch(o instanceof Error||typeof o=="object"&&o!==null||xt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new cs(o.message);case"InvalidPDFException":return new Tn(o.message);case"PasswordException":return new Ua(o.message,o.code);case"ResponseException":return new ji(o.message,o.status,o.missing);case"UnknownErrorException":return new Qn(o.message,o.details)}return new Qn(o.message,o.toString())}class Ii{#t=new AbortController;constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#s(t);return}if(t.callback){const s=t.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===un.DATA)i.resolve(t.data);else if(t.callback===un.ERROR)i.reject(ve(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,i=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(r){n.postMessage({sourceName:s,targetName:i,callback:un.DATA,callbackId:t.callbackId,data:r})},function(r){n.postMessage({sourceName:s,targetName:i,callback:un.ERROR,callbackId:t.callbackId,reason:ve(r)})});return}if(t.streamId){this.#i(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(r){n.reject(r)}return n.promise}sendWithStream(t,e,s,i){const n=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const c=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:t,streamId:n,data:e,desiredSize:h.desiredSize},i),c.promise},pull:h=>{const c=Promise.withResolvers();return this.streamControllers[n].pullCall=c,l.postMessage({sourceName:r,targetName:a,stream:Nt.PULL,streamId:n,desiredSize:h.desiredSize}),c.promise},cancel:h=>{ot(h instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[n].cancelCall=c,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:Nt.CANCEL,streamId:n,reason:ve(h)}),c.promise}},s)}#i(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,r=this,a=this.actionHandler[t.action],l={enqueue(h,c=1,d){if(this.isCancelled)return;const u=this.desiredSize;this.desiredSize-=c,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:Nt.ENQUEUE,streamId:e,chunk:h},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Nt.CLOSE,streamId:e}),delete r.streamSinks[e])},error(h){ot(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Nt.ERROR,streamId:e,reason:ve(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(a,t.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Nt.START_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Nt.START_COMPLETE,streamId:e,reason:ve(h)})})}#s(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case Nt.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(ve(t.reason));break;case Nt.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(ve(t.reason));break;case Nt.PULL:if(!a){n.postMessage({sourceName:s,targetName:i,stream:Nt.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||qa).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Nt.PULL_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Nt.PULL_COMPLETE,streamId:e,reason:ve(h)})});break;case Nt.ENQUEUE:if(ot(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case Nt.CLOSE:if(ot(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#a(r,e);break;case Nt.ERROR:ot(r,"error should have stream controller"),r.controller.error(ve(t.reason)),this.#a(r,e);break;case Nt.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(ve(t.reason)),this.#a(r,e);break;case Nt.CANCEL:if(!a)break;const l=ve(t.reason);Promise.try(a.onCancel||qa,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Nt.CANCEL_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Nt.CANCEL_COMPLETE,streamId:e,reason:ve(h)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#a(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class bl{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){xt("Abstract method `_createCanvas` called.")}}class ld extends bl{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class yl{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){xt("Abstract method `_fetch` called.")}}class Xa extends yl{async _fetch(t){const e=await Ei(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Ji(e)}}class wl{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,n){return"none"}destroy(t=!1){}}class hd extends wl{#t;#e;#i;#s;#a;#r;#n=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#s=t,this.#a=e}get#o(){return this.#e||=new Map}get#h(){return this.#r||=new Map}get#l(){if(!this.#i){const t=this.#a.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const s=this.#a.createElementNS(is,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#i=this.#a.createElementNS(is,"defs"),t.append(s),s.append(this.#i),this.#a.body.append(t)}return this.#i}#u(t){if(t.length===1){const l=t[0],h=new Array(256);for(let d=0;d<256;d++)h[d]=l[d]/255;const c=h.join(",");return[c,c,c]}const[e,s,i]=t,n=new Array(256),r=new Array(256),a=new Array(256);for(let l=0;l<256;l++)n[l]=e[l]/255,r[l]=s[l]/255,a[l]=i[l]/255;return[n.join(","),r.join(","),a.join(",")]}#d(t){if(this.#t===void 0){this.#t="";const e=this.#a.URL;e!==this.#a.baseURI&&(Zi(e)?K('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Hr(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[s,i,n]=this.#u(t),r=t.length===1?s:`${s}${i}${n}`;if(e=this.#o.get(r),e)return this.#o.set(t,e),e;const a=`g_${this.#s}_transfer_map_${this.#n++}`,l=this.#d(a);this.#o.set(t,l),this.#o.set(r,l);const h=this.#p(a);return this.#g(s,i,n,h),l}addHCMFilter(t,e){const s=`${t}-${e}`,i="base";let n=this.#h.get(i);if(n?.key===s||(n?(n.filter?.remove(),n.key=s,n.url="none",n.filter=null):(n={key:s,url:"none",filter:null},this.#h.set(i,n)),!t||!e))return n.url;const r=this.#w(t);t=F.makeHexColor(...r);const a=this.#w(e);if(e=F.makeHexColor(...a),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return n.url;const l=new Array(256);for(let f=0;f<=255;f++){const p=f/255;l[f]=p<=.03928?p/12.92:((p+.055)/1.055)**2.4}const h=l.join(","),c=`g_${this.#s}_hcm_filter`,d=n.filter=this.#p(c);this.#g(h,h,h,d),this.#m(d);const u=(f,p)=>{const g=r[f]/255,b=a[f]/255,v=new Array(p+1);for(let w=0;w<=p;w++)v[w]=g+w/p*(b-g);return v.join(",")};return this.#g(u(0,5),u(1,5),u(2,5),d),n.url=this.#d(c),n.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[s]=this.#u([t]),i=`alpha_${s}`;if(e=this.#o.get(i),e)return this.#o.set(t,e),e;const n=`g_${this.#s}_alpha_map_${this.#n++}`,r=this.#d(n);this.#o.set(t,r),this.#o.set(i,r);const a=this.#p(n);return this.#b(s,a),r}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let s,i;if(t?([s]=this.#u([t]),i=`luminosity_${s}`):i="luminosity",e=this.#o.get(i),e)return this.#o.set(t,e),e;const n=`g_${this.#s}_luminosity_map_${this.#n++}`,r=this.#d(n);this.#o.set(t,r),this.#o.set(i,r);const a=this.#p(n);return this.#f(a),t&&this.#b(s,a),r}addHighlightHCMFilter(t,e,s,i,n){const r=`${e}-${s}-${i}-${n}`;let a=this.#h.get(t);if(a?.key===r||(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#h.set(t,a)),!e||!s))return a.url;const[l,h]=[e,s].map(this.#w.bind(this));let c=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),d=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[u,f]=[i,n].map(this.#w.bind(this));d<c&&([c,d,u,f]=[d,c,f,u]),this.#l.style.color="";const p=(v,w,y)=>{const _=new Array(256),A=(d-c)/y,S=v/255,E=(w-v)/(255*y);let T=0;for(let C=0;C<=y;C++){const D=Math.round(c+C*A),R=S+C*E;for(let I=T;I<=D;I++)_[I]=R;T=D+1}for(let C=T;C<256;C++)_[C]=_[T-1];return _.join(",")},g=`g_${this.#s}_hcm_${t}_filter`,b=a.filter=this.#p(g);return this.#m(b),this.#g(p(u[0],f[0],5),p(u[1],f[1],5),p(u[2],f[2],5),b),a.url=this.#d(g),a.url}destroy(t=!1){t&&this.#r?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#r?.clear(),this.#r=null,this.#n=0)}#f(t){const e=this.#a.createElementNS(is,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#m(t){const e=this.#a.createElementNS(is,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){const e=this.#a.createElementNS(is,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#c(t,e,s){const i=this.#a.createElementNS(is,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",s),t.append(i)}#g(t,e,s,i){const n=this.#a.createElementNS(is,"feComponentTransfer");i.append(n),this.#c(n,"feFuncR",t),this.#c(n,"feFuncG",e),this.#c(n,"feFuncB",s)}#b(t,e){const s=this.#a.createElementNS(is,"feComponentTransfer");e.append(s),this.#c(s,"feFuncA",t)}#w(t){return this.#l.style.color=t,xi(getComputedStyle(this.#l).getPropertyValue("color"))}}class _l{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){xt("Abstract method `_fetch` called.")}}class Ya extends _l{async _fetch(t){const e=await Ei(t,"arraybuffer");return new Uint8Array(e)}}class Al{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){xt("Abstract method `_fetch` called.")}}class Ka extends Al{async _fetch(t){const e=await Ei(t,"arraybuffer");return new Uint8Array(e)}}oe&&K("Please use the `legacy` build in Node.js environments.");async function qr(o){const e=await process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(e)}class cd extends wl{}class dd extends bl{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class ud extends yl{async _fetch(t){return qr(t)}}class fd extends _l{async _fetch(t){return qr(t)}}class pd extends Al{async _fetch(t){return qr(t)}}const Js="__forcedDependency",{floor:Ja,ceil:Qa}=Math;function fn(o,t,e,s,i,n){o[t*4+0]=Math.min(o[t*4+0],e),o[t*4+1]=Math.min(o[t*4+1],s),o[t*4+2]=Math.max(o[t*4+2],i),o[t*4+3]=Math.max(o[t*4+3],n)}const yr=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class gd{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===yr}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const pn=(o,t)=>{if(!o)return;let e=o.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},o.set(t,e)),e};class md{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Js]:[]};#i=new Map;#s=[];#a=[];#r=[[1,0,0,1,0,0]];#n=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#h=-1;#l=new Set;#u=new Map;#d=new Map;#f;#m;#p;#c;#g;constructor(t,e,s=!1){this.#f=t.width,this.#m=t.height,this.#b(e),s&&(this.#g=new Map)}growOperationsCount(t){t>=this.#c.length&&this.#b(t,this.#c)}#b(t,e){const s=new ArrayBuffer(t*4);this.#p=new Uint8ClampedArray(s),this.#c=new Uint32Array(s),e&&e.length>0?(this.#c.set(e),this.#c.fill(yr,e.length)):this.#c.fill(yr)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Js]:{__proto__:this.#e[Js]}},this.#n={__proto__:this.#n},this.#s.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#n=Object.getPrototypeOf(this.#n);const s=this.#s.pop();return s!==void 0&&(pn(this.#g,t)?.dependencies.add(s),this.#c[t]=this.#c[s]),this}recordOpenMarker(t){return this.#s.push(t),this}getOpenMarker(){return this.#s.length===0?null:this.#s.at(-1)}recordCloseMarker(t){const e=this.#s.pop();return e!==void 0&&(pn(this.#g,t)?.dependencies.add(e),this.#c[t]=this.#c[e]),this}beginMarkedContent(t){return this.#a.push(t),this}endMarkedContent(t){const e=this.#a.pop();return e!==void 0&&(pn(this.#g,t)?.dependencies.add(e),this.#c[t]=this.#c[e]),this}pushBaseTransform(t){return this.#r.push(F.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#i.set(t,e),this}recordSimpleDataFromNamed(t,e,s){this.#t[t]=this.#i.get(e)??s}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Js,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(Js,t);return this}resetBBox(t){return this.#h!==t&&(this.#h=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(t,e,s,i,n,r){const a=F.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform()),l=[1/0,1/0,-1/0,-1/0];F.axialAlignedBoundingBox([s,n,i,r],a,l);const h=F.intersect(this.#n,l);return h?(this.#n[0]=h[0],this.#n[1]=h[1],this.#n[2]=h[2],this.#n[3]=h[3]):(this.#n[0]=this.#n[1]=1/0,this.#n[2]=this.#n[3]=-1/0),this}recordBBox(t,e,s,i,n,r){const a=this.#n;if(a[0]===1/0)return this;const l=F.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform());if(a[0]===-1/0)return F.axialAlignedBoundingBox([s,n,i,r],l,this.#o),this;const h=[1/0,1/0,-1/0,-1/0];return F.axialAlignedBoundingBox([s,n,i,r],l,h),this.#o[0]=Math.min(this.#o[0],Math.max(h[0],a[0])),this.#o[1]=Math.min(this.#o[1],Math.max(h[1],a[1])),this.#o[2]=Math.max(this.#o[2],Math.min(h[2],a[2])),this.#o[3]=Math.max(this.#o[3],Math.min(h[3],a[3])),this}recordCharacterBBox(t,e,s,i=1,n=0,r=0,a){const l=s.bbox;let h,c;if(l&&(h=l[2]!==l[0]&&l[3]!==l[1]&&this.#d.get(s),h!==!1&&(c=[0,0,0,0],F.axialAlignedBoundingBox(l,s.fontMatrix,c),(i!==1||n!==0||r!==0)&&F.scaleMinMax([i,0,0,-i,n,r],c),h)))return this.recordBBox(t,e,c[0],c[2],c[1],c[3]);if(!a)return this.recordFullPageBBox(t);const d=a();return l&&c&&h===void 0&&(h=c[0]<=n-d.actualBoundingBoxLeft&&c[2]>=n+d.actualBoundingBoxRight&&c[1]<=r-d.actualBoundingBoxAscent&&c[3]>=r+d.actualBoundingBoxDescent,this.#d.set(s,h),h)?this.recordBBox(t,e,c[0],c[2],c[1],c[3]):this.recordBBox(t,e,n-d.actualBoundingBoxLeft,n+d.actualBoundingBoxRight,r-d.actualBoundingBoxAscent,r+d.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#n[0]),this.#o[1]=Math.max(0,this.#n[1]),this.#o[2]=Math.min(this.#f,this.#n[2]),this.#o[3]=Math.min(this.#m,this.#n[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const s=this.#l,i=this.#t,n=this.#e;for(const r of e)r in this.#t?s.add(i[r]):r in n&&n[r].forEach(s.add,s);return this}recordNamedDependency(t,e){return this.#i.has(e)&&this.#l.add(this.#i.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[Js]),this.#g){const s=pn(this.#g,t),{dependencies:i}=s;this.#l.forEach(i.add,i),this.#s.forEach(i.add,i),this.#a.forEach(i.add,i),i.delete(t),s.isRenderingOperation=!0}if(this.#h===t){const s=Ja(this.#o[0]*256/this.#f),i=Ja(this.#o[1]*256/this.#m),n=Qa(this.#o[2]*256/this.#f),r=Qa(this.#o[3]*256/this.#m);fn(this.#p,t,s,i,n,r);for(const a of this.#l)a!==t&&fn(this.#p,a,s,i,n,r);for(const a of this.#s)a!==t&&fn(this.#p,a,s,i,n,r);for(const a of this.#a)a!==t&&fn(this.#p,a,s,i,n,r);e||(this.#l.clear(),this.#h=-1)}return this}recordShowTextOperation(t,e=!1){const s=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#h===t&&(this.#h=-1,this.#n[0]=Math.max(this.#n[0],this.#o[0]),this.#n[1]=Math.max(this.#n[1],this.#o[1]),this.#n[2]=Math.min(this.#n[2],this.#o[2]),this.#n[3]=Math.min(this.#n[3],this.#o[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#u.get(t);return this.#u.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#d.clear(),new gd(this.#c,this.#p)}takeDebugMetadata(){return this.#g}}class Mn{#t;#e;#i;#s=0;#a=0;constructor(t,e,s){if(t instanceof Mn&&t.#i===!!s)return t;this.#t=t,this.#e=e,this.#i=!!s}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#a++,this.#t.save(this.#e),this}restore(t){return this.#a>0&&(this.#t.restore(this.#e),this.#a--),this}recordOpenMarker(t){return this.#s++,this}getOpenMarker(){return this.#s>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#s--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,s){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#i||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,s,i,n,r){return this.#i||this.#t.recordClipBox(this.#e,e,s,i,n,r),this}recordBBox(t,e,s,i,n,r){return this.#i||this.#t.recordBBox(this.#e,e,s,i,n,r),this}recordCharacterBBox(t,e,s,i,n,r,a){return this.#i||this.#t.recordCharacterBBox(this.#e,e,s,i,n,r,a),this}recordFullPageBBox(t){return this.#i||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#i||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const De={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Qt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function wr(o,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),o.clip(i)}class Xr{isModifyingCurrentTransform(){return!1}getPattern(){xt("Abstract method `getPattern` called.")}}class vd extends Xr{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(t,e=null){let s,i=this._p0,n=this._p1;if(e&&(i=i.slice(),n=n.slice(),F.applyTransform(i,e),F.applyTransform(n,e)),this._type==="axial")s=t.createLinearGradient(i[0],i[1],n[0],n[1]);else if(this._type==="radial"){let r=this._r0,a=this._r1;if(e){const l=new Float32Array(2);F.singularValueDecompose2dScale(e,l),r*=l[0],a*=l[0]}s=t.createRadialGradient(i[0],i[1],r,n[0],n[1],a)}for(const r of this._colorStops)s.addColorStop(r[0],r[1]);return s}getPattern(t,e,s,i){let n;if(i===Qt.STROKE||i===Qt.FILL){if(this.isOriginBased()){let u=F.transform(s,e.baseTransform);this.matrix&&(u=F.transform(u,this.matrix));const f=.001,p=Math.hypot(u[0],u[1]),g=Math.hypot(u[2],u[3]),b=(u[0]*u[2]+u[1]*u[3])/(p*g);if(Math.abs(b)<f)if(this.isRadial()){if(Math.abs(p-g)<f)return this._createGradient(t,u)}else return this._createGradient(t,u)}const r=e.current.getClippedPathBoundingBox(i,Dt(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,h=e.cachedCanvases.getCanvas("pattern",a,l),c=h.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),s=F.transform(s,[1,0,0,1,r[0],r[1]]),c.transform(...e.baseTransform),this.matrix&&c.transform(...this.matrix),wr(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),n=t.createPattern(h.canvas,"no-repeat");const d=new DOMMatrix(s);n.setTransform(d)}else wr(t,this._bbox),n=this._createGradient(t);return n}}function er(o,t,e,s,i,n,r,a){const l=t.coords,h=t.colors,c=o.data,d=o.width*4;let u;l[e+1]>l[s+1]&&(u=e,e=s,s=u,u=n,n=r,r=u),l[s+1]>l[i+1]&&(u=s,s=i,i=u,u=r,r=a,a=u),l[e+1]>l[s+1]&&(u=e,e=s,s=u,u=n,n=r,r=u);const f=(l[e]+t.offsetX)*t.scaleX,p=(l[e+1]+t.offsetY)*t.scaleY,g=(l[s]+t.offsetX)*t.scaleX,b=(l[s+1]+t.offsetY)*t.scaleY,v=(l[i]+t.offsetX)*t.scaleX,w=(l[i+1]+t.offsetY)*t.scaleY;if(p>=w)return;const y=h[n],_=h[n+1],A=h[n+2],S=h[r],E=h[r+1],T=h[r+2],C=h[a],D=h[a+1],R=h[a+2],I=Math.round(p),z=Math.round(w);let U,Q,L,O,j,ft,Rt,ct;for(let tt=I;tt<=z;tt++){if(tt<b){const dt=tt<p?0:(p-tt)/(p-b);U=f-(f-g)*dt,Q=y-(y-S)*dt,L=_-(_-E)*dt,O=A-(A-T)*dt}else{let dt;tt>w?dt=1:b===w?dt=0:dt=(b-tt)/(b-w),U=g-(g-v)*dt,Q=S-(S-C)*dt,L=E-(E-D)*dt,O=T-(T-R)*dt}let rt;tt<p?rt=0:tt>w?rt=1:rt=(p-tt)/(p-w),j=f-(f-v)*rt,ft=y-(y-C)*rt,Rt=_-(_-D)*rt,ct=A-(A-R)*rt;const ut=Math.round(Math.min(U,j)),Et=Math.round(Math.max(U,j));let it=d*tt+ut*4;for(let dt=ut;dt<=Et;dt++)rt=(U-dt)/(U-j),rt<0?rt=0:rt>1&&(rt=1),c[it++]=Q-(Q-ft)*rt|0,c[it++]=L-(L-Rt)*rt|0,c[it++]=O-(O-ct)*rt|0,c[it++]=255}}function bd(o,t,e){const s=t.coords,i=t.colors;let n,r;switch(t.type){case gr.LATTICE:const a=t.verticesPerRow,l=Math.floor(s.length/a)-1,h=a-1;for(n=0;n<l;n++){let c=n*a;for(let d=0;d<h;d++,c++)er(o,e,s[c],s[c+1],s[c+a],i[c],i[c+1],i[c+a]),er(o,e,s[c+a+1],s[c+1],s[c+a],i[c+a+1],i[c+1],i[c+a])}break;case gr.TRIANGLES:for(n=0,r=s.length;n<r;n+=3)er(o,e,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class yd extends Xr{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-a,c=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(h*t[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(c*t[1]*1.1)),3e3),f=h/d,p=c/u,g={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/f,scaleY:1/p},b=d+4,v=u+4,w=s.getCanvas("mesh",b,v),y=w.context,_=y.createImageData(d,u);if(e){const S=_.data;for(let E=0,T=S.length;E<T;E+=4)S[E]=e[0],S[E+1]=e[1],S[E+2]=e[2],S[E+3]=255}for(const S of this._figures)bd(_,S,g);return y.putImageData(_,2,2),{canvas:w.canvas,offsetX:a-2*f,offsetY:l-2*p,scaleX:f,scaleY:p}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,i){wr(t,this._bbox);const n=new Float32Array(2);if(i===Qt.SHADING)F.singularValueDecompose2dScale(Dt(t),n);else if(this.matrix){F.singularValueDecompose2dScale(this.matrix,n);const[a,l]=n;F.singularValueDecompose2dScale(e.baseTransform,n),n[0]*=a,n[1]*=l}else F.singularValueDecompose2dScale(e.baseTransform,n);const r=this._createMeshCanvas(n,i===Qt.SHADING?null:this._background,e.cachedCanvases);return i!==Qt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class wd extends Xr{getPattern(){return"hotpink"}}function _d(o){switch(o[0]){case"RadialAxial":return new vd(o);case"Mesh":return new yd(o);case"Dummy":return new wd}throw new Error(`Unknown IR type: ${o[0]}`)}const Za={COLORED:1,UNCOLORED:2};class Yr{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(t,e){const{bbox:s,operatorList:i,paintType:n,tilingType:r,color:a,canvasGraphicsFactory:l}=this;let{xstep:h,ystep:c}=this;h=Math.abs(h),c=Math.abs(c),Bn("TilingType: "+r);const d=s[0],u=s[1],f=s[2],p=s[3],g=f-d,b=p-u,v=new Float32Array(2);F.singularValueDecompose2dScale(this.matrix,v);const[w,y]=v;F.singularValueDecompose2dScale(this.baseTransform,v);const _=w*v[0],A=y*v[1];let S=g,E=b,T=!1,C=!1;const D=Math.ceil(h*_),R=Math.ceil(c*A),I=Math.ceil(g*_),z=Math.ceil(b*A);D>=I?S=h:T=!0,R>=z?E=c:C=!0;const U=this.getSizeAndScale(S,this.ctx.canvas.width,_),Q=this.getSizeAndScale(E,this.ctx.canvas.height,A),L=t.cachedCanvases.getCanvas("pattern",U.size,Q.size),O=L.context,j=l.createCanvasGraphics(O,e);if(j.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(j,n,a),O.translate(-U.scale*d,-Q.scale*u),j.transform(0,U.scale,0,0,Q.scale,0,0),O.save(),j.dependencyTracker?.save(),this.clipBbox(j,d,u,f,p),j.baseTransform=Dt(j.ctx),j.executeOperatorList(i),j.endDrawing(),j.dependencyTracker?.restore(),O.restore(),T||C){const ft=L.canvas;T&&(S=h),C&&(E=c);const Rt=this.getSizeAndScale(S,this.ctx.canvas.width,_),ct=this.getSizeAndScale(E,this.ctx.canvas.height,A),tt=Rt.size,rt=ct.size,ut=t.cachedCanvases.getCanvas("pattern-workaround",tt,rt),Et=ut.context,it=T?Math.floor(g/h):0,dt=C?Math.floor(b/c):0;for(let Xt=0;Xt<=it;Xt++)for(let vt=0;vt<=dt;vt++)Et.drawImage(ft,tt*Xt,rt*vt,tt,rt,0,0,tt,rt);return{canvas:ut.canvas,scaleX:Rt.scale,scaleY:ct.scale,offsetX:d,offsetY:u}}return{canvas:L.canvas,scaleX:U.scale,scaleY:Q.scale,offsetX:d,offsetY:u}}getSizeAndScale(t,e,s){const i=Math.max(Yr.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*s);return n>=i?n=i:s=n/t,{scale:s,size:n}}clipBbox(t,e,s,i,n){const r=i-e,a=n-s;t.ctx.rect(e,s,r,a),F.axialAlignedBoundingBox([e,s,i,n],Dt(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,n=t.current;switch(e){case Za.COLORED:const{fillStyle:r,strokeStyle:a}=this.ctx;i.fillStyle=n.fillColor=r,i.strokeStyle=n.strokeColor=a;break;case Za.UNCOLORED:i.fillStyle=i.strokeStyle=s,n.fillColor=n.strokeColor=s;break;default:throw new zc(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,i,n){let r=s;i!==Qt.SHADING&&(r=F.transform(r,e.baseTransform),this.matrix&&(r=F.transform(r,this.matrix)));const a=this.createPatternCanvas(e,n);let l=new DOMMatrix(r);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const h=t.createPattern(a.canvas,"repeat");return h.setTransform(l),h}}function Ad({src:o,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const a=Ut.isLittleEndian?4278190080:255,[l,h]=r?[n,a]:[a,n],c=s>>3,d=s&7,u=o.length;e=new Uint32Array(e.buffer);let f=0;for(let p=0;p<i;p++){for(const b=t+c;t<b;t++){const v=t<u?o[t]:255;e[f++]=v&128?h:l,e[f++]=v&64?h:l,e[f++]=v&32?h:l,e[f++]=v&16?h:l,e[f++]=v&8?h:l,e[f++]=v&4?h:l,e[f++]=v&2?h:l,e[f++]=v&1?h:l}if(d===0)continue;const g=t<u?o[t++]:255;for(let b=0;b<d;b++)e[f++]=g&1<<7-b?h:l}return{srcPos:t,destPos:f}}const to=16,eo=100,Sd=15,so=10,ye=16,sr=new DOMMatrix,Te=new Float32Array(2),ni=new Float32Array([1/0,1/0,-1/0,-1/0]);function Ed(o,t){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){t.save(),this.__originalSave()},o.restore=function(){t.restore(),this.__originalRestore()},o.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},o.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},o.transform=function(e,s,i,n,r,a){t.transform(e,s,i,n,r,a),this.__originalTransform(e,s,i,n,r,a)},o.setTransform=function(e,s,i,n,r,a){t.setTransform(e,s,i,n,r,a),this.__originalSetTransform(e,s,i,n,r,a)},o.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},o.rotate=function(e){t.rotate(e),this.__originalRotate(e)},o.clip=function(e){t.clip(e),this.__originalClip(e)},o.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},o.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},o.bezierCurveTo=function(e,s,i,n,r,a){t.bezierCurveTo(e,s,i,n,r,a),this.__originalBezierCurveTo(e,s,i,n,r,a)},o.rect=function(e,s,i,n){t.rect(e,s,i,n),this.__originalRect(e,s,i,n)},o.closePath=function(){t.closePath(),this.__originalClosePath()},o.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class xd{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function gn(o,t,e,s,i,n,r,a,l,h){const[c,d,u,f,p,g]=Dt(o);if(d===0&&u===0){const w=r*c+p,y=Math.round(w),_=a*f+g,A=Math.round(_),S=(r+l)*c+p,E=Math.abs(Math.round(S)-y)||1,T=(a+h)*f+g,C=Math.abs(Math.round(T)-A)||1;return o.setTransform(Math.sign(c),0,0,Math.sign(f),y,A),o.drawImage(t,e,s,i,n,0,0,E,C),o.setTransform(c,d,u,f,p,g),[E,C]}if(c===0&&f===0){const w=a*u+p,y=Math.round(w),_=r*d+g,A=Math.round(_),S=(a+h)*u+p,E=Math.abs(Math.round(S)-y)||1,T=(r+l)*d+g,C=Math.abs(Math.round(T)-A)||1;return o.setTransform(0,Math.sign(d),Math.sign(u),0,y,A),o.drawImage(t,e,s,i,n,0,0,C,E),o.setTransform(c,d,u,f,p,g),[C,E]}o.drawImage(t,e,s,i,n,r,a,l,h);const b=Math.hypot(c,d),v=Math.hypot(u,f);return[b*l,v*h]}class io{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=pr;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Ht.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,s){s?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=ni.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Qt.FILL,e=null){const s=this.minMax.slice();if(t===Qt.STROKE){e||xt("Stroke bounding box must include transform."),F.singularValueDecompose2dScale(e,Te);const i=Te[0]*this.lineWidth/2,n=Te[1]*this.lineWidth/2;s[0]-=i,s[1]-=n,s[2]+=i,s[3]+=n}return s}updateClipFromPath(){const t=F.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(ni,0)}getClippedPathBoundingBox(t=Qt.FILL,e=null){return F.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function no(o,t){if(t instanceof ImageData){o.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%ye,n=(e-i)/ye,r=i===0?n:n+1,a=o.createImageData(s,ye);let l=0,h;const c=t.data,d=a.data;let u,f,p,g;if(t.kind===Bi.GRAYSCALE_1BPP){const b=c.byteLength,v=new Uint32Array(d.buffer,0,d.byteLength>>2),w=v.length,y=s+7>>3,_=4294967295,A=Ut.isLittleEndian?4278190080:255;for(u=0;u<r;u++){for(p=u<n?ye:i,h=0,f=0;f<p;f++){const S=b-l;let E=0;const T=S>y?s:S*8-7,C=T&-8;let D=0,R=0;for(;E<C;E+=8)R=c[l++],v[h++]=R&128?_:A,v[h++]=R&64?_:A,v[h++]=R&32?_:A,v[h++]=R&16?_:A,v[h++]=R&8?_:A,v[h++]=R&4?_:A,v[h++]=R&2?_:A,v[h++]=R&1?_:A;for(;E<T;E++)D===0&&(R=c[l++],D=128),v[h++]=R&D?_:A,D>>=1}for(;h<w;)v[h++]=0;o.putImageData(a,0,u*ye)}}else if(t.kind===Bi.RGBA_32BPP){for(f=0,g=s*ye*4,u=0;u<n;u++)d.set(c.subarray(l,l+g)),l+=g,o.putImageData(a,0,f),f+=ye;u<r&&(g=s*i*4,d.set(c.subarray(l,l+g)),o.putImageData(a,0,f))}else if(t.kind===Bi.RGB_24BPP)for(p=ye,g=s*p,u=0;u<r;u++){for(u>=n&&(p=i,g=s*p),h=0,f=g;f--;)d[h++]=c[l++],d[h++]=c[l++],d[h++]=c[l++],d[h++]=255;o.putImageData(a,0,u*ye)}else throw new Error(`bad image kind: ${t.kind}`)}function ro(o,t){if(t.bitmap){o.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%ye,n=(e-i)/ye,r=i===0?n:n+1,a=o.createImageData(s,ye);let l=0;const h=t.data,c=a.data;for(let d=0;d<r;d++){const u=d<n?ye:i;({srcPos:l}=Ad({src:h,srcPos:l,dest:c,width:s,height:u,nonBlackColor:0})),o.putImageData(a,0,d*ye)}}function Ti(o,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)o[s]!==void 0&&(t[s]=o[s]);o.setLineDash!==void 0&&(t.setLineDash(o.getLineDash()),t.lineDashOffset=o.lineDashOffset)}function mn(o){o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0);const{filter:t}=o;t!=="none"&&t!==""&&(o.filter="none")}function ao(o,t){if(t)return!0;F.singularValueDecompose2dScale(o,Te);const e=Math.fround(ze.pixelRatio*Ws.PDF_TO_CSS_UNITS);return Te[0]<=e&&Te[1]<=e}const Cd=["butt","round","square"],Td=["miter","round","bevel"],Pd={},oo={};class hi{constructor(t,e,s,i,n,{optionalContentConfig:r,markedContentStack:a=null},l,h,c){this.ctx=t,this.current=new io(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new xd(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=c??null}getObject(t,e,s=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):s}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=a,s){const l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Dt(this.compositeCtx))}this.ctx.save(),mn(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Dt(this.ctx)}executeOperatorList(t,e,s,i,n){const r=t.argsArray,a=t.fnArray;let l=e||0;const h=r.length;if(h===l)return l;const c=h-l>so&&typeof s=="function",d=c?Date.now()+Sd:0;let u=0;const f=this.commonObjs,p=this.objs;let g,b;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,s),l;if(!n||n(l))if(g=a[l],b=r[l]??null,g!==vi.dependency)b===null?this[g](l):this[g](l,...b);else for(const v of b){this.dependencyTracker?.recordNamedData(v,l);const w=v.startsWith("g_")?f:p;if(!w.has(v))return w.get(v,s),l}if(l++,l===h)return l;if(c&&++u>so){if(Date.now()>d)return s(),l;u=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=s,l=i,h="prescale1",c,d;for(;n>2&&a>1||r>2&&l>1;){let u=a,f=l;n>2&&a>1&&(u=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),n/=a/u),r>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/f),c=this.cachedCanvases.getCanvas(h,u,f),d=c.context,d.clearRect(0,0,u,f),d.drawImage(t,0,0,a,l,0,0,u,f),t=c.canvas,a=u,l=f,h=h==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:l}}_createMaskCanvas(t,e){const s=this.ctx,{width:i,height:n}=e,r=this.current.fillColor,a=this.current.patternFill,l=Dt(s);let h,c,d,u;if((e.bitmap||e.data)&&e.count>1){const D=e.bitmap||e.data.buffer;c=JSON.stringify(a?l:[l.slice(0,4),r]),h=this._cachedBitmapsMap.get(D),h||(h=new Map,this._cachedBitmapsMap.set(D,h));const R=h.get(c);if(R&&!a){const I=Math.round(Math.min(l[0],l[2])+l[4]),z=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(t,De.transformAndFill),{canvas:R,offsetX:I,offsetY:z}}d=R}d||(u=this.cachedCanvases.getCanvas("maskCanvas",i,n),ro(u.context,e));let f=F.transform(l,[1/i,0,0,-1/n,0,0]);f=F.transform(f,[1,0,0,1,0,-n]);const p=ni.slice();F.axialAlignedBoundingBox([0,0,i,n],f,p);const[g,b,v,w]=p,y=Math.round(v-g)||1,_=Math.round(w-b)||1,A=this.cachedCanvases.getCanvas("fillCanvas",y,_),S=A.context,E=g,T=b;S.translate(-E,-T),S.transform(...f),d||(d=this._scaleImage(u.canvas,We(S)),d=d.img,h&&a&&h.set(c,d)),S.imageSmoothingEnabled=ao(Dt(S),e.interpolate),gn(S,d,0,0,d.width,d.height,0,0,i,n),S.globalCompositeOperation="source-in";const C=F.transform(We(S),[1,0,0,1,-E,-T]);return S.fillStyle=a?r.getPattern(s,this,C,Qt.FILL,t):r,S.fillRect(0,0,i,n),h&&!a&&(this.cachedCanvases.delete("fillCanvas"),h.set(c,A.canvas)),this.dependencyTracker?.recordDependencies(t,De.transformAndFill),{canvas:A.canvas,offsetX:Math.round(E),offsetY:Math.round(T)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=Cd[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=Td[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,s){this.dependencyTracker?.recordSimpleData("dash",t);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=s)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[s,i]of e)switch(s){case"LW":this.setLineWidth(t,i);break;case"LC":this.setLineCap(t,i);break;case"LJ":this.setLineJoin(t,i);break;case"ML":this.setMiterLimit(t,i);break;case"D":this.setDash(t,i[0],i[1]);break;case"RI":this.setRenderingIntent(t,i);break;case"FL":this.setFlatness(t,i);break;case"Font":this.setFont(t,i[0],i[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=i;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=i;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,e,s);this.suspendedCtx=this.ctx;const r=this.ctx=n.context;r.setTransform(this.suspendedCtx.getTransform()),Ti(this.suspendedCtx,r),Ed(r,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ti(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const n=i[0],r=i[1],a=i[2]-n,l=i[3]-r;a===0||l===0||(this.genericComposeSMask(e.context,s,a,l,e.subtype,e.backdrop,e.transferMap,n,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,n,r,a,l,h,c,d){let u=t.canvas,f=l-c,p=h-d;if(r)if(f<0||p<0||f+s>u.width||p+i>u.height){const b=this.cachedCanvases.getCanvas("maskExtension",s,i),v=b.context;v.drawImage(u,-f,-p),v.globalCompositeOperation="destination-atop",v.fillStyle=r,v.fillRect(0,0,s,i),v.globalCompositeOperation="source-over",u=b.canvas,f=p=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(f,p,s,i),t.clip(b),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(f,p,s,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const g=new Path2D;g.rect(l,h,s,i),e.clip(g),e.globalCompositeOperation="destination-in",e.drawImage(u,f,p,s,i,l,h,s,i),e.restore()}save(t){this.inSMaskMode&&Ti(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Ti(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,i,n,r,a){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,s,i,n,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s,i){let[n]=s;if(!i){n||=s[0]=new Path2D,this[e](t,n);return}if(this.dependencyTracker!==null){const r=e===vi.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,i[0]-r,i[2]+r,i[1]-r,i[3]+r).recordDependencies(t,["transform"])}n instanceof Path2D||(n=s[0]=fl(n)),F.axialAlignedBoundingBox(i,Dt(this.ctx),this.current.minMax),this[e](t,n),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,s=!0){const i=this.ctx,n=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof n=="object"&&n?.getPattern){const r=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=n.getPattern(i,this,We(i),Qt.STROKE,t),r){const a=new Path2D;a.addPath(e,i.getTransform().invertSelf().multiplySelf(r)),e=a}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,De.stroke),s&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(Qt.STROKE,Dt(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,s=!0){const i=this.ctx,n=this.current.fillColor,r=this.current.patternFill;let a=!1;if(r){const h=n.isModifyingCurrentTransform()?i.getTransform():null;if(this.dependencyTracker?.save(t),i.save(),i.fillStyle=n.getPattern(i,this,We(i),Qt.FILL,t),h){const c=new Path2D;c.addPath(e,i.getTransform().invertSelf().multiplySelf(h)),e=c}a=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),this.dependencyTracker?.recordDependencies(t,De.fill),a&&(i.restore(),this.dependencyTracker?.restore(t)),s&&this.consumePath(t,e,l)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,De.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=Pd}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=oo}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;e!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",t),i.recordCloseMarker(t)}if(e!==void 0){const i=new Path2D,n=s.getTransform().invertSelf();for(const{transform:r,x:a,y:l,fontSize:h,path:c}of e)c&&i.addPath(c,new DOMMatrix(r).preMultiplySelf(n).translate(a,l).scale(h,-h));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,s){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const i=this.commonObjs.get(e),n=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(n.fontMatrix=i.fontMatrix||pr,(n.fontMatrix[0]===0||n.fontMatrix[3]===0)&&K("Invalid font matrix for font "+e),s<0?(s=-s,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const r=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${r}", ${i.fallbackName}`;let l="normal";i.black?l="900":i.bold&&(l="bold");const h=i.italic?"italic":"normal";let c=s;s<to?c=to:s>eo&&(c=eo),this.current.fontSizeScale=s/c,this.ctx.font=`${h} ${l} ${c}px ${a}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,s){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=s}setLeadingMoveText(t,e,s){this.setLeading(t,-s),this.moveText(t,e,s)}setTextMatrix(t,e){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:s}=this;s.textMatrix=e,s.textMatrixScale=Math.hypot(e[0],e[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#i(t,e,s){const i=new Path2D;return i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),i}paintChar(t,e,s,i,n,r){const a=this.ctx,l=this.current,h=l.font,c=l.textRenderingMode,d=l.fontSize/l.fontSizeScale,u=c&Ht.FILL_STROKE_MASK,f=!!(c&Ht.ADD_TO_PATH_FLAG),p=l.patternFill&&!h.missingFile,g=l.patternStroke&&!h.missingFile;let b;if((h.disableFontFace||f||p||g)&&!h.missingFile&&(b=h.getPathGenerator(this.commonObjs,e)),b&&(h.disableFontFace||p||g)){a.save(),a.translate(s,i),a.scale(d,-d),this.dependencyTracker?.recordCharacterBBox(t,a,h);let v;if(u===Ht.FILL||u===Ht.FILL_STROKE)if(n){v=a.getTransform(),a.setTransform(...n);const w=this.#i(b,v,n);a.fill(w)}else a.fill(b);if(u===Ht.STROKE||u===Ht.FILL_STROKE)if(r){v||=a.getTransform(),a.setTransform(...r);const{a:w,b:y,c:_,d:A}=v,S=F.inverseTransform(r),E=F.transform([w,y,_,A,0,0],S);F.singularValueDecompose2dScale(E,Te),a.lineWidth*=Math.max(Te[0],Te[1])/d,a.stroke(this.#i(b,v,r))}else a.lineWidth/=d,a.stroke(b);a.restore()}else(u===Ht.FILL||u===Ht.FILL_STROKE)&&(a.fillText(e,s,i),this.dependencyTracker?.recordCharacterBBox(t,a,h,d,s,i,()=>a.measureText(e))),(u===Ht.STROKE||u===Ht.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,a,h,d,s,i,()=>a.measureText(e)).recordDependencies(t,De.stroke),a.strokeText(e,s,i));f&&((this.pendingTextPaths||=[]).push({transform:Dt(a),x:s,y:i,fontSize:d,path:b}),this.dependencyTracker?.recordCharacterBBox(t,a,h,d,s,i))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return X(this,"isFontSubpixelAAEnabled",s)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,De.showText).resetBBox(t),this.current.textRenderingMode&Ht.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const n=s.fontSize;if(n===0){this.dependencyTracker?.recordOperation(t);return}const r=this.ctx,a=s.fontSizeScale,l=s.charSpacing,h=s.wordSpacing,c=s.fontDirection,d=s.textHScale*c,u=e.length,f=i.vertical,p=f?1:-1,g=i.defaultVMetrics,b=n*s.fontMatrix[0],v=s.textRenderingMode===Ht.FILL&&!i.disableFontFace&&!s.patternFill;r.save(),s.textMatrix&&r.transform(...s.textMatrix),r.translate(s.x,s.y+s.textRise),c>0?r.scale(d,-1):r.scale(d,1);let w,y;const _=s.textRenderingMode&Ht.FILL_STROKE_MASK,A=_===Ht.FILL||_===Ht.FILL_STROKE,S=_===Ht.STROKE||_===Ht.FILL_STROKE;if(A&&s.patternFill){r.save();const R=s.fillColor.getPattern(r,this,We(r),Qt.FILL,t);w=Dt(r),r.restore(),r.fillStyle=R}if(S&&s.patternStroke){r.save();const R=s.strokeColor.getPattern(r,this,We(r),Qt.STROKE,t);y=Dt(r),r.restore(),r.strokeStyle=R}let E=s.lineWidth;const T=s.textMatrixScale;if(T===0||E===0?S&&(E=this.getSinglePixelWidth()):E/=T,a!==1&&(r.scale(a,a),E/=a),r.lineWidth=E,i.isInvalidPDFjsFont){const R=[];let I=0;for(const U of e)R.push(U.unicode),I+=U.width;const z=R.join("");if(r.fillText(z,0,0),this.dependencyTracker!==null){const U=r.measureText(z);this.dependencyTracker.recordBBox(t,this.ctx,-U.actualBoundingBoxLeft,U.actualBoundingBoxRight,-U.actualBoundingBoxAscent,U.actualBoundingBoxDescent).recordShowTextOperation(t)}s.x+=I*b*d,r.restore(),this.compose();return}let C=0,D;for(D=0;D<u;++D){const R=e[D];if(typeof R=="number"){C+=p*R*n/1e3;continue}let I=!1;const z=(R.isSpace?h:0)+l,U=R.fontChar,Q=R.accent;let L,O,j=R.width;if(f){const ct=R.vmetric||g,tt=-(R.vmetric?ct[1]:j*.5)*b,rt=ct[2]*b;j=ct?-ct[0]:j,L=tt/a,O=(C+rt)/a}else L=C/a,O=0;let ft;if(i.remeasure&&j>0){ft=r.measureText(U);const ct=ft.width*1e3/n*a;if(j<ct&&this.isFontSubpixelAAEnabled){const tt=j/ct;I=!0,r.save(),r.scale(tt,1),L/=tt}else j!==ct&&(L+=(j-ct)/2e3*n/a)}if(this.contentVisible&&(R.isInFont||i.missingFile)){if(v&&!Q)r.fillText(U,L,O),this.dependencyTracker?.recordCharacterBBox(t,r,ft?{bbox:null}:i,n/a,L,O,()=>ft??r.measureText(U));else if(this.paintChar(t,U,L,O,w,y),Q){const ct=L+n*Q.offset.x/a,tt=O-n*Q.offset.y/a;this.paintChar(t,Q.fontChar,ct,tt,w,y)}}const Rt=f?j*b-z*c:j*b+z*c;C+=Rt,I&&r.restore()}f?s.y-=C:s.x+=C*d,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const s=this.ctx,i=this.current,n=i.font,r=i.fontSize,a=i.fontDirection,l=n.vertical?1:-1,h=i.charSpacing,c=i.wordSpacing,d=i.textHScale*a,u=i.fontMatrix||pr,f=e.length,p=i.textRenderingMode===Ht.INVISIBLE;let g,b,v,w;if(p||r===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(d,a);const y=this.dependencyTracker;for(this.dependencyTracker=y?new Mn(y,t):null,g=0;g<f;++g){if(b=e[g],typeof b=="number"){w=l*b*r/1e3,this.ctx.translate(w,0),i.x+=w*d;continue}const _=(b.isSpace?c:0)+h,A=n.charProcOperatorList[b.operatorListId];A?this.contentVisible&&(this.save(),s.scale(r,r),s.transform(...u),this.executeOperatorList(A),this.restore()):K(`Type3 character "${b.operatorListId}" is not available.`);const S=[b.width,0];F.applyTransform(S,u),v=S[0]*r+_,s.translate(v,0),i.x+=v*d}s.restore(),y&&(this.dependencyTracker=y)}setCharWidth(t,e,s){}setCharWidthAndBounds(t,e,s,i,n,r,a){const l=new Path2D;l.rect(i,n,r-i,a-n),this.ctx.clip(l),this.dependencyTracker?.recordBBox(t,this.ctx,i,r,n,a).recordClipBox(t,this.ctx,i,r,n,a),this.endPath(t)}getColorN_Pattern(t,e){let s;if(e[0]==="TilingPattern"){const i=this.baseTransform||Dt(this.ctx),n={createCanvasGraphics:(r,a)=>new hi(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Mn(this.dependencyTracker,a,!0):null)};s=new Yr(e,this.ctx,n,i)}else s=this._getPattern(t,e[1],e[2]);return s}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,s=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=_d(this.getObject(t,e)),this.cachedPatterns.set(e,i)),s&&(i.matrix=s),i}shadingFill(t,e){if(!this.contentVisible)return;const s=this.ctx;this.save(t);const i=this._getPattern(t,e);s.fillStyle=i.getPattern(s,this,We(s),Qt.SHADING,t);const n=We(s);if(n){const{width:r,height:a}=s.canvas,l=ni.slice();F.axialAlignedBoundingBox([0,0,r,a],n,l);const[h,c,d,u]=l;this.ctx.fillRect(h,c,d-h,u-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,De.transform).recordDependencies(t,De.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){xt("Should not call beginInlineImage")}beginImageData(){xt("Should not call beginImageData")}paintFormXObjectBegin(t,e,s){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=Dt(this.ctx),s)){F.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[i,n,r,a]=s,l=new Path2D;l.rect(i,n,r-i,a-n),this.ctx.clip(l),this.dependencyTracker?.recordClipBox(t,this.ctx,i,r,n,a),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;e.isolated||Bn("TODO: Support non-isolated groups."),e.knockout&&K("Knockout groups not supported.");const i=Dt(s);if(e.matrix&&s.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let n=ni.slice();F.axialAlignedBoundingBox(e.bbox,Dt(s),n);const r=[0,0,s.canvas.width,s.canvas.height];n=F.intersect(n,r)||[0,0,0,0];const a=Math.floor(n[0]),l=Math.floor(n[1]),h=Math.max(Math.ceil(n[2])-a,1),c=Math.max(Math.ceil(n[3])-l,1);this.current.startNewPathAndClipBox([0,0,h,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,h,c),f=u.context;f.translate(-a,-l),f.transform(...i);let p=new Path2D;const[g,b,v,w]=e.bbox;if(p.rect(g,b,v-g,w-b),e.matrix){const y=new Path2D;y.addPath(p,new DOMMatrix(e.matrix)),p=y}f.clip(p),e.smask&&this.smaskStack.push({canvas:u.canvas,context:f,offsetX:a,offsetY:l,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(a,l),s.save()),Ti(s,f),this.ctx=f,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const n=Dt(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...n);const r=ni.slice();F.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],n,r),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,s,i,n,r){if(this.#t(),mn(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const a=s[2]-s[0],l=s[3]-s[1];if(r&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=a,s[3]=l,F.singularValueDecompose2dScale(Dt(this.ctx),Te);const{viewportScale:h}=this,c=Math.ceil(a*this.outputScaleX*h),d=Math.ceil(l*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(c,d);const{canvas:u,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(Te[0],0,0,-Te[1],0,l*Te[1]),mn(this.ctx)}else{mn(this.ctx),this.endPath(t);const h=new Path2D;h.rect(s[0],s[1],a,l),this.ctx.clip(h)}}this.current=new io(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...i),this.transform(t,...n)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const s=e.count;e=this.getObject(t,e.data,e),e.count=s;const i=this.ctx,n=this._createMaskCanvas(t,e),r=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,n.offsetX,n.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,n.offsetX,n.offsetX+r.width,n.offsetY,n.offsetY+r.height).recordOperation(t),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s,i=0,n=0,r,a){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const l=this.ctx;l.save();const h=Dt(l);l.transform(s,i,n,r,0,0);const c=this._createMaskCanvas(t,e);l.setTransform(1,0,0,1,c.offsetX-h[4],c.offsetY-h[5]),this.dependencyTracker?.resetBBox(t);for(let d=0,u=a.length;d<u;d+=2){const f=F.transform(h,[s,i,n,r,a[d],a[d+1]]);l.drawImage(c.canvas,f[4],f[5]),this.dependencyTracker?.recordBBox(t,this.ctx,f[4],f[4]+c.canvas.width,f[5],f[5]+c.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,De.transformAndFill);for(const r of e){const{data:a,width:l,height:h,transform:c}=r,d=this.cachedCanvases.getCanvas("maskCanvas",l,h),u=d.context;u.save();const f=this.getObject(t,a,r);ro(u,f),u.globalCompositeOperation="source-in",u.fillStyle=n?i.getPattern(u,this,We(s),Qt.FILL,t):i,u.fillRect(0,0,l,h),u.restore(),s.save(),s.transform(...c),s.scale(1,-1),gn(s,d.canvas,0,0,l,h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,l,0,h),s.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const s=this.getObject(t,e);if(!s){K("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,s)}paintImageXObjectRepeat(t,e,s,i,n){if(!this.contentVisible)return;const r=this.getObject(t,e);if(!r){K("Dependent image isn't ready yet");return}const a=r.width,l=r.height,h=[];for(let c=0,d=n.length;c<d;c+=2)h.push({transform:[s,0,0,i,n[c],n[c+1]],x:0,y:0,w:a,h:l});this.paintInlineImageXObjectGroup(t,r,h)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,n=this.cachedCanvases.getCanvas("inlineImage",s,i),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",n.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const s=e.width,i=e.height,n=this.ctx;this.save(t);const{filter:r}=n;r!=="none"&&r!==""&&(n.filter="none"),n.scale(1/s,-1/i);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const c=this.cachedCanvases.getCanvas("inlineImage",s,i).context;no(c,e),a=this.applyTransferMapsToCanvas(c)}const l=this._scaleImage(a,We(n));n.imageSmoothingEnabled=ao(Dt(n),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,n,0,s,-i,0).recordDependencies(t,De.imageXObject).recordOperation(t),gn(n,l.img,0,0,l.paintWidth,l.paintHeight,0,-i,s,i),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,s){if(!this.contentVisible)return;const i=this.ctx;let n;if(e.bitmap)n=e.bitmap;else{const r=e.width,a=e.height,h=this.cachedCanvases.getCanvas("inlineImage",r,a).context;no(h,e),n=this.applyTransferMapsToCanvas(h)}this.dependencyTracker?.resetBBox(t);for(const r of s)i.save(),i.transform(...r.transform),i.scale(1,-1),gn(i,n,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,1,-1,0),i.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,De.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,s){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,s){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,s){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const n=this.ctx;this.pendingClip?(i||(this.pendingClip===oo?n.clip(e,"evenodd"):n.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Dt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:n}=this.ctx.getTransform();let r,a;if(s===0&&i===0){const l=Math.abs(e),h=Math.abs(n);if(l===h)if(t===0)r=a=1/l;else{const c=l*t;r=a=c<1?1/c:1}else if(t===0)r=1/l,a=1/h;else{const c=l*t,d=h*t;r=c<1?1/c:1,a=d<1?1/d:1}}else{const l=Math.abs(e*n-s*i),h=Math.hypot(e,s),c=Math.hypot(i,n);if(t===0)r=c/l,a=h/l;else{const d=t*l;r=c>d?c/d:1,a=h>d?h/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:i}}=this,[n,r]=this.getScaleForStroking();if(n===r){s.lineWidth=(i||1)*n,s.stroke(t);return}const a=s.getLineDash();e&&s.save(),s.scale(n,r),sr.a=1/n,sr.d=1/r;const l=new Path2D;if(l.addPath(t,sr),a.length>0){const h=Math.max(n,r);s.setLineDash(a.map(c=>c/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(l),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const o in vi)hi.prototype[o]!==void 0&&(hi.prototype[vi[o]]=hi.prototype[o]);class zs{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class kd{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const Zs=Symbol("INTERNAL");class Md{#t=!1;#e=!1;#i=!1;#s=!0;constructor(t,{name:e,intent:s,usage:i,rbGroups:n}){this.#t=!!(t&xe.DISPLAY),this.#e=!!(t&xe.PRINT),this.name=e,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,s=!1){t!==Zs&&xt("Internal method `_setVisible` called."),this.#i=s,this.#s=e}}class Rd{#t=null;#e=new Map;#i=null;#s=null;constructor(t,e=xe.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#s=t.order;for(const s of t.groups)this.#e.set(s.id,new Md(e,s));if(t.baseState==="OFF")for(const s of this.#e.values())s._setVisible(Zs,!1);for(const s of t.on)this.#e.get(s)._setVisible(Zs,!0);for(const s of t.off)this.#e.get(s)._setVisible(Zs,!1);this.#i=this.getHash()}}#a(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const n=t[i];let r;if(Array.isArray(n))r=this.#a(n);else if(this.#e.has(n))r=this.#e.get(n).visible;else return K(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return s==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Bn("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(K(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#a(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return K(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return K(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return K(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return K(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return K(`Unknown optional content policy ${t.policy}.`),!0}return K(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){const i=this.#e.get(t);if(!i){K(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length)for(const n of i.rbGroups)for(const r of n)r!==t&&this.#e.get(r)?._setVisible(Zs,!1,!0);i._setVisible(Zs,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=this.#e.get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!n.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new gl;for(const[e,s]of this.#e)t.update(`${e}:${s.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class Dd{constructor(t,{disableRange:e=!1,disableStream:s=!1}){ot(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:r,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,n?.length>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),t.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(s),!0)});ot(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){ot(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new Ld(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Id(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class Ld{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=Hn(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Id{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Fd(o){let t=!0,e=s("filename\\*","i").exec(o);if(e){e=e[1];let c=a(e);return c=unescape(c),c=l(c),c=h(c),n(c)}if(e=r(o),e){const c=h(e);return n(c)}if(e=s("filename","i").exec(o),e){e=e[1];let c=a(e);return c=h(c),n(c)}function s(c,d){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(c,d){if(c){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const u=new TextDecoder(c,{fatal:!0}),f=Ji(d);d=u.decode(f),t=!1}catch{}}return d}function n(c){return t&&/[\x80-\xff]/.test(c)&&(c=i("utf-8",c),t&&(c=i("iso-8859-1",c))),c}function r(c){const d=[];let u;const f=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=f.exec(c))!==null;){let[,g,b,v]=u;if(g=parseInt(g,10),g in d){if(g===0)break;continue}d[g]=[b,v]}const p=[];for(let g=0;g<d.length&&g in d;++g){let[b,v]=d[g];v=a(v),b&&(v=unescape(v),g===0&&(v=l(v))),p.push(v)}return p.join("")}function a(c){if(c.startsWith('"')){const d=c.slice(1).split('\\"');for(let u=0;u<d.length;++u){const f=d[u].indexOf('"');f!==-1&&(d[u]=d[u].slice(0,f),d.length=u+1),d[u]=d[u].replaceAll(/\\(.)/g,"$1")}c=d.join('"')}return c}function l(c){const d=c.indexOf("'");if(d===-1)return c;const u=c.slice(0,d),p=c.slice(d+1).replace(/^[^']*'/,"");return i(u,p)}function h(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,u,f,p){if(f==="q"||f==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,b){return String.fromCharCode(parseInt(b,16))}),i(u,p);try{p=atob(p)}catch{}return i(u,p)})}return""}function Sl(o,t){const e=new Headers;if(!o||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function zn(o){return URL.parse(o)?.origin??null}function El({responseHeaders:o,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(o.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*e)||s||!t||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function xl(o){const t=o.get("Content-Disposition");if(t){let e=Fd(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Hn(e))return e}return null}function sn(o,t){return new ji(`Unexpected server response (${o}) while retrieving PDF "${t}".`,o,o===404||o===0&&t.startsWith("file:"))}function Cl(o){return o===200||o===206}function Tl(o,t,e){return{method:"GET",headers:o,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Pl(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(K(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class Od{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Sl(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ot(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Nd(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Bd(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Nd{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),i=e.url;fetch(i,Tl(s,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=zn(n.url),!Cl(n.status))throw sn(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:a,suggestedLength:l}=El({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=xl(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new cs("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Pl(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class Bd{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${s-1}`);const r=i.url;fetch(r,Tl(n,this._withCredentials,this._abortController)).then(a=>{const l=zn(a.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!Cl(a.status))throw sn(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Pl(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const ir=200,nr=206;function Ud(o){const t=o.response;return typeof t!="string"?t:Ji(t).buffer}class Hd{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:s}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Sl(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,r]of this.headers)e.setRequestHeader(n,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=nr):i.expectedStatus=ir,e.responseType="arraybuffer",ot(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){const s=this.pendingRequests[t];s&&s.onProgress?.(e)}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||ir;if(!(n===ir&&s.expectedStatus===nr)&&n!==s.expectedStatus){s.onError(i.status);return}const a=Ud(i);if(n===nr){const l=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?s.onDone({begin:parseInt(h[1],10),chunk:a}):(K('Missing or invalid "Content-Range" header.'),s.onError(0))}else a?s.onDone({begin:0,chunk:a}):s.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class zd{constructor(t){this._source=t,this._manager=new Hd(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return ot(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new jd(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new $d(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class jd{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=zn(e.responseURL);const s=e.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...h]=a.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=El({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=xl(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=sn(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class $d{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=zn(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=sn(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Wd=/^[a-z][a-z0-9\-+.]+:/i;function Vd(o){if(Wd.test(o))return new URL(o);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(o))}class Gd{constructor(t){this.source=t,this.url=Vd(t.url),ot(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ot(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new qd(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Xd(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class qd{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=sn(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new cs("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Xd{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Pi=Symbol("INITIAL_DATA");class kl{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:Pi}}get(t,e=null){if(e){const i=this.#e(t);return i.promise.then(()=>e(i.data)),null}const s=this.#t[t];if(!s||s.data===Pi)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=this.#t[t];return!!e&&e.data!==Pi}delete(t){const e=this.#t[t];return!e||e.data===Pi?!1:(delete this.#t[t],!0)}resolve(t,e=null){const s=this.#e(t);s.data=e,s.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==Pi&&(yield[t,e])}}}const Yd=1e5,lo=30;class we{#t=Promise.withResolvers();#e=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#a=null;#r=null;#n=0;#o=0;#h=null;#l=null;#u=0;#d=0;#f=Object.create(null);#m=[];#p=null;#c=[];#g=new WeakMap;#b=null;static#w=new Map;static#v=new Map;static#E=new WeakMap;static#S=null;static#y=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(l){l.enqueue(t),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#d=s.scale*ze.pixelRatio,this.#u=s.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:n,pageX:r,pageY:a}=s.rawDims;this.#b=[1,0,0,-1,-r,a+n],this.#o=i,this.#n=n,we.#k(),e.style.setProperty("--min-font-size",we.#S),Ss(e,s),this.#t.promise.finally(()=>{we.#y.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Ut.platform;return X(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#h.read().then(({value:e,done:s})=>{if(s){this.#t.resolve();return}this.#a??=e.lang,Object.assign(this.#f,e.styles),this.#T(e.items),t()},this.#t.reject)};return this.#h=this.#p.getReader(),we.#y.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*ze.pixelRatio,i=t.rotation;if(i!==this.#u&&(e?.(),this.#u=i,Ss(this.#l,{rotation:i})),s!==this.#d){e?.(),this.#d=s;const n={div:null,properties:null,ctx:we.#M(this.#a)};for(const r of this.#c)n.properties=this.#g.get(r),n.div=r,this.#x(n)}}cancel(){const t=new cs("TextLayer task cancelled.");this.#h?.cancel(t).catch(()=>{}),this.#h=null,this.#t.reject(t)}get textDivs(){return this.#c}get textContentItemsStr(){return this.#m}#T(t){if(this.#i)return;this.#r.ctx??=we.#M(this.#a);const e=this.#c,s=this.#m;for(const i of t){if(e.length>Yd){K("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),i.id&&this.#e.setAttribute("id",`${i.id}`),n.append(this.#e)}else i.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(i.str),this.#_(i)}}#_(t){const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#c.push(e);const i=F.transform(this.#b,t.transform);let n=Math.atan2(i[1],i[0]);const r=this.#f[t.fontName];r.vertical&&(n+=Math.PI/2);let a=this.#s&&r.fontSubstitution||r.fontFamily;a=we.fontFamilyMap.get(a)||a;const l=Math.hypot(i[2],i[3]),h=l*we.#N(a,r,this.#a);let c,d;n===0?(c=i[4],d=i[5]-h):(c=i[4]+h*Math.sin(n),d=i[5]-h*Math.cos(n));const u=e.style;u.left=`${(100*c/this.#o).toFixed(2)}%`,u.top=`${(100*d/this.#n).toFixed(2)}%`,u.setProperty("--font-height",`${l.toFixed(2)}px`),u.fontFamily=a,s.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#s&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),n!==0&&(s.angle=n*(180/Math.PI));let f=!1;if(t.str.length>1)f=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const p=Math.abs(t.transform[0]),g=Math.abs(t.transform[3]);p!==g&&Math.max(p,g)/Math.min(p,g)>1.5&&(f=!0)}if(f&&(s.canvasWidth=r.vertical?t.height:t.width),this.#g.set(e,s),this.#r.div=e,this.#r.properties=s,this.#x(this.#r),s.hasText&&this.#e.append(e),s.hasEOL){const p=document.createElement("br");p.setAttribute("role","presentation"),this.#e.append(p)}}#x(t){const{div:e,properties:s,ctx:i}=t,{style:n}=e;if(s.canvasWidth!==0&&s.hasText){const{fontFamily:r}=n,{canvasWidth:a,fontSize:l}=s;we.#P(i,l*this.#d,r);const{width:h}=i.measureText(e.textContent);h>0&&n.setProperty("--scale-x",a*this.#d/h)}s.angle!==0&&n.setProperty("--rotate",`${s.angle}deg`)}static cleanup(){if(!(this.#y.size>0)){this.#w.clear();for(const{canvas:t}of this.#v.values())t.remove();this.#v.clear()}}static#M(t=null){let e=this.#v.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#v.set(t,e),this.#E.set(e,{size:0,family:""})}return e}static#P(t,e,s){const i=this.#E.get(t);e===i.size&&s===i.family||(t.font=`${e}px ${s}`,i.size=e,i.family=s)}static#k(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#N(t,e,s){const i=this.#w.get(t);if(i)return i;const n=this.#M(s);n.canvas.width=n.canvas.height=lo,this.#P(n,lo,t);const r=n.measureText(""),a=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let h=.8;return a?h=a/(a+l):(Ut.platform.isFirefox&&K("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?h=e.ascent:e.descent&&(h=1+e.descent)),this.#w.set(t,h),h}}const Kd=100;function Kr(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});const t=new Jr,{docId:e}=t,s=o.url?nd(o.url):null,i=o.data?rd(o.data):null,n=o.httpHeaders||null,r=o.withCredentials===!0,a=o.password??null,l=o.range instanceof Qr?o.range:null,h=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:2**16;let c=o.worker instanceof bi?o.worker:null;const d=o.verbosity,u=typeof o.docBaseUrl=="string"&&!Zi(o.docBaseUrl)?o.docBaseUrl:null,f=dn(o.cMapUrl),p=o.cMapPacked!==!1,g=o.CMapReaderFactory||(oe?ud:Xa),b=dn(o.iccUrl),v=dn(o.standardFontDataUrl),w=o.StandardFontDataFactory||(oe?fd:Ya),y=dn(o.wasmUrl),_=o.WasmFactory||(oe?pd:Ka),A=o.stopAtErrors!==!0,S=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,E=o.isEvalSupported!==!1,T=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!oe,C=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!oe&&(Ut.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,R=typeof o.disableFontFace=="boolean"?o.disableFontFace:oe,I=o.fontExtraProperties===!0,z=o.enableXfa===!0,U=o.ownerDocument||globalThis.document,Q=o.disableRange===!0,L=o.disableStream===!0,O=o.disableAutoFetch===!0,j=o.pdfBug===!0,ft=o.CanvasFactory||(oe?dd:ld),Rt=o.FilterFactory||(oe?cd:hd),ct=o.enableHWA===!0,tt=o.useWasm!==!1,rt=l?l.length:o.length??NaN,ut=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!oe&&!R,Et=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:!!(g===Xa&&w===Ya&&_===Ka&&f&&v&&y&&Li(f,document.baseURI)&&Li(v,document.baseURI)&&Li(y,document.baseURI)),it=null;Bc(d);const dt={canvasFactory:new ft({ownerDocument:U,enableHWA:ct}),filterFactory:new Rt({docId:e,ownerDocument:U}),cMapReaderFactory:Et?null:new g({baseUrl:f,isCompressed:p}),standardFontDataFactory:Et?null:new w({baseUrl:v}),wasmFactory:Et?null:new _({baseUrl:y})};c||(c=bi.create({verbosity:d,port:zs.workerPort}),t._worker=c);const Xt={docId:e,apiVersion:"5.4.530",data:i,password:a,disableAutoFetch:O,rangeChunkSize:h,length:rt,docBaseUrl:u,enableXfa:z,evaluatorOptions:{maxImageSize:S,disableFontFace:R,ignoreErrors:A,isEvalSupported:E,isOffscreenCanvasSupported:T,isImageDecoderSupported:C,canvasMaxAreaInBytes:D,fontExtraProperties:I,useSystemFonts:ut,useWasm:tt,useWorkerFetch:Et,cMapUrl:f,iccUrl:b,standardFontDataUrl:v,wasmUrl:y}},vt={ownerDocument:U,pdfBug:j,styleElement:it,loadingParams:{disableAutoFetch:O,enableXfa:z}};return c.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const at=c.messageHandler.sendWithPromise("GetDocRequest",Xt,i?[i.buffer]:null);let _t;if(l)_t=new Dd(l,{disableRange:Q,disableStream:L});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const bt=Li(s)?Od:oe?Gd:zd;_t=new bt({url:s,length:rt,httpHeaders:n,withCredentials:r,rangeChunkSize:h,disableRange:Q,disableStream:L})}return at.then(bt=>{if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const yt=new Ii(e,bt,c.port),ee=new Zd(yt,t,_t,vt,dt,ct);t._transport=ee,yt.send("Ready",null)})}).catch(t._capability.reject),t}class Jr{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Jr.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Qr{#t=Promise.withResolvers();#e=[];#i=[];#s=[];#a=[];constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(t){this.#a.push(t)}addProgressListener(t){this.#s.push(t)}addProgressiveReadListener(t){this.#i.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const s of this.#a)s(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const s of this.#s)s(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#i)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){xt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Jd{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return X(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Qd{#t=!1;constructor(t,e,s,i=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new za:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new kl,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new Qi({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return X(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:s,intent:i="display",annotationMode:n=as.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:h=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:u=!1,recordOperations:f=!1,operationsFilter:p=null}){this._stats?.time("Overall");const g=this._transport.getRenderingIntent(i,n,d,u),{renderingIntent:b,cacheKey:v}=g;this.#t=!1,l||=this._transport.getOptionalContentConfig(b);let w=this._intentStates.get(v);w||(w=Object.create(null),this._intentStates.set(v,w)),w.streamReaderCancelTimeout&&(clearTimeout(w.streamReaderCancelTimeout),w.streamReaderCancelTimeout=null);const y=!!(b&xe.PRINT);w.displayReadyCapability||(w.displayReadyCapability=Promise.withResolvers(),w.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(g));const _=!!(this._pdfBug&&globalThis.StepperManager?.enabled),A=!this.recordedBBoxes&&(f||_),S=C=>{if(w.renderTasks.delete(E),A){const D=E.gfx?.dependencyTracker.take();D&&(E.stepper&&E.stepper.setOperatorBBoxes(D,E.gfx.dependencyTracker.takeDebugMetadata()),f&&(this.recordedBBoxes=D))}y&&(this.#t=!0),this.#e(),C?(E.capability.reject(C),this._abortOperatorList({intentState:w,reason:C instanceof Error?C:new Error(C)})):E.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},E=new ri({callback:S,params:{canvas:e,canvasContext:t,dependencyTracker:A?new md(e,w.operatorList.length,_):null,viewport:s,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:w.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!y,pdfBug:this._pdfBug,pageColors:c,enableHWA:this._transport.enableHWA,operationsFilter:p});(w.renderTasks||=new Set).add(E);const T=E.task;return Promise.all([w.displayReadyCapability.promise,l]).then(([C,D])=>{if(this.destroyed){S();return}if(this._stats?.time("Rendering"),!(D.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");E.initializeGraphics({transparency:C,optionalContentConfig:D}),E.operatorListChanged()}).catch(S),T}getOperatorList({intent:t="display",annotationMode:e=as.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){function n(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(t,e,s,i,!0);let a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>$i.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function n(){r.read().then(function({value:l,done:h}){if(h){s(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),n()},i)}const r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new za),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const s=this._intentStates.get(e);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:r}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:i},r).getReader(),h=this._intentStates.get(e);h.streamReader=l;const c=()=>{l.read().then(({value:d,done:u})=>{if(u){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,h),c())},d=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const u of h.renderTasks)u.operatorListChanged();this.#e()}if(h.displayReadyCapability)h.displayReadyCapability.reject(d);else if(h.opListReadCapability)h.opListReadCapability.reject(d);else throw d}})};c()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof Un){let i=Kd;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new cs(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}var vs,Be,rs,Is,Rn,Fs,Os,he,wn,Ml,Rl,Fi,ci,_n;const Mt=class Mt{constructor({name:t=null,port:e=null,verbosity:s=Uc()}={}){je(this,he);je(this,vs,Promise.withResolvers());je(this,Be,null);je(this,rs,null);je(this,Is,null);if(this.name=t,this.destroyed=!1,this.verbosity=s,e){if(kt(Mt,Os).has(e))throw new Error("Cannot use more than one PDFWorker per port.");kt(Mt,Os).set(e,this),$e(this,he,Ml).call(this,e)}else $e(this,he,Rl).call(this)}get promise(){return kt(this,vs).promise}get port(){return kt(this,rs)}get messageHandler(){return kt(this,Be)}destroy(){this.destroyed=!0,kt(this,Is)?.terminate(),me(this,Is,null),kt(Mt,Os).delete(kt(this,rs)),me(this,rs,null),kt(this,Be)?.destroy(),me(this,Be,null)}static create(t){const e=kt(this,Os).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Mt(t)}static get workerSrc(){if(zs.workerSrc)return zs.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return X(this,"_setupFakeWorkerGlobal",(async()=>kt(this,ci,_n)?kt(this,ci,_n):(await import(this.workerSrc)).WorkerMessageHandler)())}};vs=new WeakMap,Be=new WeakMap,rs=new WeakMap,Is=new WeakMap,Rn=new WeakMap,Fs=new WeakMap,Os=new WeakMap,he=new WeakSet,wn=function(){kt(this,vs).resolve(),kt(this,Be).send("configure",{verbosity:this.verbosity})},Ml=function(t){me(this,rs,t),me(this,Be,new Ii("main","worker",t)),kt(this,Be).on("ready",()=>{}),$e(this,he,wn).call(this)},Rl=function(){if(kt(Mt,Fs)||kt(Mt,ci,_n)){$e(this,he,Fi).call(this);return}let{workerSrc:t}=Mt;try{Mt._isSameOrigin(window.location,t)||(t=Mt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new Ii("main","worker",e),i=()=>{n.abort(),s.destroy(),e.terminate(),this.destroyed?kt(this,vs).reject(new Error("Worker was destroyed")):$e(this,he,Fi).call(this)},n=new AbortController;e.addEventListener("error",()=>{kt(this,Is)||i()},{signal:n.signal}),s.on("test",a=>{if(n.abort(),this.destroyed||!a){i();return}me(this,Be,s),me(this,rs,e),me(this,Is,e),$e(this,he,wn).call(this)}),s.on("ready",a=>{if(n.abort(),this.destroyed){i();return}try{r()}catch{$e(this,he,Fi).call(this)}});const r=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};r();return}catch{Bn("The worker has been disabled.")}$e(this,he,Fi).call(this)},Fi=function(){kt(Mt,Fs)||(K("Setting up fake worker."),me(Mt,Fs,!0)),Mt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){kt(this,vs).reject(new Error("Worker was destroyed"));return}const e=new od;me(this,rs,e);const s=`fake${ba(Mt,Rn)._++}`,i=new Ii(s+"_worker",s,e);t.setup(i,e),me(this,Be,new Ii(s,s+"_worker",e)),$e(this,he,wn).call(this)}).catch(t=>{kt(this,vs).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},ci=new WeakSet,_n=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},je(Mt,ci),je(Mt,Rn,0),je(Mt,Fs,!1),je(Mt,Os,new WeakMap),oe&&(me(Mt,Fs,!0),zs.workerSrc||="./pdf.worker.mjs"),Mt._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!s?.origin||s.origin==="null")return!1;const i=new URL(e,s);return s.origin===i.origin},Mt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Mt.fromPort=t=>{if(Xc("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Mt.create(t)};let bi=Mt;class Zd{#t=new Map;#e=new Map;#i=new Map;#s=new Map;#a=null;constructor(t,e,s,i,n,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new kl,this.fontLoader=new ed({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#r(t,e=null){const s=this.#t.get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,i),i}get annotationStorage(){return X(this,"annotationStorage",new Gr)}getRenderingIntent(t,e=as.ENABLE,s=null,i=!1,n=!1){let r=xe.DISPLAY,a=vr;switch(t){case"any":r=xe.ANY;break;case"display":break;case"print":r=xe.PRINT;break;default:K(`getRenderingIntent - invalid intent: ${t}`)}const l=r&xe.PRINT&&s instanceof ml?s:this.annotationStorage;switch(e){case as.DISABLE:r+=xe.ANNOTATIONS_DISABLE;break;case as.ENABLE:break;case as.ENABLE_FORMS:r+=xe.ANNOTATIONS_FORMS;break;case as.ENABLE_STORAGE:r+=xe.ANNOTATIONS_STORAGE,a=l.serializable;break;default:K(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(r+=xe.IS_EDITING),n&&(r+=xe.OPLIST);const{ids:h,hash:c}=l.modifiedIds,d=[r,a.hash,c];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:a,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#e.values())t.push(s._destroy());this.#e.clear(),this.#i.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),we.cleanup(),this._networkStream?.cancelAllRequests(new cs("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{ot(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){i.close();return}ot(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async s=>{await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:r}=this._fullReader;return(!i||!n)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{e.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:r}}),t.on("GetRangeReader",(s,i)=>{ot(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:r,done:a}){if(a){i.close();return}ot(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{n.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new Jd(s,this))}),t.on("DocException",s=>{e._capability.reject(ve(s))}),t.on("PasswordRequest",s=>{this.#a=Promise.withResolvers();try{if(!e.onPassword)throw ve(s);const i=n=>{n instanceof Error?this.#a.reject(n):this.#a.resolve({password:n})};e.onPassword(i,s.code)}catch(i){this.#a.reject(i)}return this.#a.promise}),t.on("DataLoaded",s=>{e.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;this.#e.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,n])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const d=n.error;K(`Error during font loading: ${d}`),this.commonObjs.resolve(s,d);break}const r=new At(n),a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(d,u)=>globalThis.FontInspector.fontAdded(d,u):null,l=new sd(r,a,n.extra,n.charProcOperatorList);this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l.fontExtraProperties&&l.data&&l.clearData(),this.commonObjs.resolve(s,l)});break;case"CopyLocalImage":const{imageRef:h}=n;ot(h,"The imageRef must be defined.");for(const d of this.#e.values())for(const[,u]of d.objs)if(u?.ref===h)return u.dataLen?(this.commonObjs.resolve(s,structuredClone(u)),u.dataLen):null;break;case"FontPath":this.commonObjs.resolve(s,new id(n));break;case"Image":this.commonObjs.resolve(s,n);break;case"Pattern":const c=new Vt(n);this.commonObjs.resolve(s,c.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,n,r])=>{if(this.destroyed)return;const a=this.#e.get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){r?.bitmap?.close();return}switch(n){case"Image":case"Pattern":a.objs.resolve(s,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",s=>{this.destroyed||e.onProgress?.({loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&K("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=this.#i.get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#s.set(n.refStr,t);const r=new Qd(e,n,this,this._params.pdfBug);return this.#e.set(e,r),r});return this.#i.set(e,i),i}getPageIndex(t){return br(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#r("GetFieldObjects")}hasJSActions(){return this.#r("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#r("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#r("GetOptionalContentConfig").then(e=>new Rd(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>({info:i[0],metadata:i[1]?new kd(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:i[2]}));return this.#t.set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),we.cleanup()}}cachedPageNumber(t){if(!br(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#s.get(e)??null}}class tu{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class ri{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:c=!1,pdfBug:d=!1,pageColors:u=null,enableHWA:f=!1,operationsFilter:p=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=d,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new tu(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=f,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=p}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(ri.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");ri.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:n,dependencyTracker:r}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new hi(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:i,viewport:s,transparency:t,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),ri.#e.delete(this._canvas),t||=new Un(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),ri.#e.delete(this._canvas),this.callback())))}}const Zr="5.4.530",Dl="50cc4adac";class Ce{#t=null;#e=null;#i;#s=null;#a=!1;#r=!1;#n=null;#o;#h=null;#l=null;static#u=null;static get _keyboardManager(){return X(this,"_keyboardManager",new tn([[["Escape","mac+Escape"],Ce.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ce.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ce.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ce.prototype._moveToPrevious],[["Home","mac+Home"],Ce.prototype._moveToBeginning],[["End","mac+End"],Ce.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#r=!1,this.#n=t):this.#r=!0,this.#l=t?._uiManager||e,this.#o=this.#l._eventBus,this.#i=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",Ce.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#n&&(t.ariaControls=`${this.#n.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#p.bind(this),{signal:e}),t.addEventListener("keydown",this.#m.bind(this),{signal:e});const s=this.#e=document.createElement("span");return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=this.#i,t.append(s),t}renderMainDropdown(){const t=this.#s=this.#d();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#d(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",ke,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#n&&(t.id=`${this.#n.id}_colorpicker_dropdown`);for(const[s,i]of this.#l.highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",Ce.#u[s]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=i,n.ariaSelected=i===this.#i,n.addEventListener("click",this.#f.bind(this,i),{signal:e}),t.append(n)}return t.addEventListener("keydown",this.#m.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:nt.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#p(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#g){this.#p(t);return}if(t.target===this.#t){this.#s.firstElementChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#s?.firstElementChild||t.target===this.#t){this.#g&&this._hideDropdownFromKeyboard();return}this.#g||this.#p(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#g){this.#p(t);return}this.#s.firstElementChild?.focus()}_moveToEnd(t){if(!this.#g){this.#p(t);return}this.#s.lastElementChild?.focus()}#m(t){Ce._keyboardManager.exec(this,t)}#p(t){if(this.#g){this.hideDropdown();return}if(this.#a=t.detail===0,this.#h||(this.#h=new AbortController,window.addEventListener("pointerdown",this.#c.bind(this),{signal:this.#l.combinedSignal(this.#h)})),this.#t.ariaExpanded="true",this.#s){this.#s.classList.remove("hidden");return}const e=this.#s=this.#d();this.#t.append(e)}#c(t){this.#s?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#h?.abort(),this.#h=null}get#g(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#g){this.#n?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#s)return;const e=this.#l.highlightColors.values();for(const s of this.#s.children)s.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}}class Wi{#t=null;#e=null;#i=null;static#s=null;constructor(t){this.#e=t,this.#i=t._uiManager,Wi.#s||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,color:s}=this.#e,i=this.#t=document.createElement("input");return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",Wi.#s[t]),i.addEventListener("input",()=>{this.#i.updateParams(e,i.value)},{signal:this.#i._signal}),i}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function ho(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function ki(o){return Math.max(0,Math.min(255,255*o))}class co{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=ki(t),[t,t,t]}static G_HTML([t]){const e=ho(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(ki)}static RGB_HTML(t){return`#${t.map(ho).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[ki(1-Math.min(1,t+i)),ki(1-Math.min(1,s+i)),ki(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,n=1-e,r=1-s,a=Math.min(i,n,r);return["CMYK",i,n,r,a]}}class eu{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){xt("Abstract method `_createSVG` called.")}}class Vi extends eu{_createSVG(t){return document.createElementNS(is,t)}}const su=9,Vs=new WeakSet,iu=new Date().getTimezoneOffset()*60*1e3;class rr{static create(t){switch(t.data.annotationType){case Ft.LINK:return new ta(t);case Ft.TEXT:return new ru(t);case Ft.WIDGET:switch(t.data.fieldType){case"Tx":return new au(t);case"Btn":return t.data.radioButton?new Ll(t):t.data.checkBox?new lu(t):new hu(t);case"Ch":return new cu(t);case"Sig":return new ou(t)}return new Ys(t);case Ft.POPUP:return new _r(t);case Ft.FREETEXT:return new Il(t);case Ft.LINE:return new uu(t);case Ft.SQUARE:return new fu(t);case Ft.CIRCLE:return new pu(t);case Ft.POLYLINE:return new Fl(t);case Ft.CARET:return new mu(t);case Ft.INK:return new ea(t);case Ft.POLYGON:return new gu(t);case Ft.HIGHLIGHT:return new Ol(t);case Ft.UNDERLINE:return new vu(t);case Ft.SQUIGGLY:return new bu(t);case Ft.STRIKEOUT:return new yu(t);case Ft.STAMP:return new Nl(t);case Ft.FILEATTACHMENT:return new wu(t);default:return new It(t)}}}class It{#t=null;#e=!1;#i=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return It._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:s,rect:i}=this.data;let n=-1/0,r=-1/0;if(e?.length>=8){for(let a=0;a<e.length;a+=8)e[a+1]>r?(r=e[a+1],n=e[a+2]):e[a+1]===r&&(n=Math.max(n,e[a+2]));return[n,r]}if(s?.length>=1){for(const a of s)for(let l=0,h=a.length;l<h;l+=2)a[l+1]>r?(r=a[l+1],n=a[l]):a[l+1]===r&&(n=Math.max(n,a[l]));if(n!==1/0)return[n,r]}return i?[i[2],i[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-n)/s,t[1]=100*(t[1]-r)/i,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${zi}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,s={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:s})||this.annotationStorage.setValue(`${zi}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#i?.popup||this.popup)?.remove(),this.#i=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:s}=t;e&&this.#s(e);let i=this.#i?.popup||this.popup;!i&&s?.text&&(this._createPopup(s),i=this.#i.popup),i&&(i.updateEdited(t),s?.deleted&&(i.remove(),this.#i=null,this.popup=null))}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#s(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:l}}}}=this;s?.splice(0,4,...t),e.left=`${100*(t[0]-a)/n}%`,e.top=`${100*(r-t[3]+l)/r}%`,i===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(i)}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),!(this instanceof Ys)&&!(this instanceof ta)&&(n.tabIndex=0);const{style:r}=n;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof _r){const{rotation:g}=e;return!e.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}const{width:a,height:l}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const g=e.borderStyle.horizontalCornerRadius,b=e.borderStyle.verticalCornerRadius;if(g>0||b>0){const w=`calc(${g}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;r.borderRadius=w}else if(this instanceof Ll){const w=`calc(${a}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=w}switch(e.borderStyle.style){case Qs.SOLID:r.borderStyle="solid";break;case Qs.DASHED:r.borderStyle="dashed";break;case Qs.BEVELED:K("Unimplemented border style: beveled");break;case Qs.INSET:K("Unimplemented border style: inset");break;case Qs.UNDERLINE:r.borderBottomStyle="solid";break}const v=e.borderColor||null;v?(this.#e=!0,r.borderColor=F.makeHexColor(v[0]|0,v[1]|0,v[2]|0)):r.borderWidth=0}const h=F.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:c,pageHeight:d,pageX:u,pageY:f}=i.rawDims;r.left=`${100*(h[0]-u)/c}%`,r.top=`${100*(h[1]-f)/d}%`;const{rotation:p}=e;return e.hasOwnCanvas||p===0?(r.width=`${100*a/c}%`,r.height=`${100*l/d}%`):this.setRotation(p,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:r}=this;t%180!==0&&([n,r]=[r,n]),e.style.width=`${100*n/s}%`,e.style.height=`${100*r/i}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const n=i.detail[e],r=n[0],a=n.slice(1);i.target.style[s]=co[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:co[`${r}_rgb`](a)})};return X(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail))(t[i]||s[i])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,n]of Object.entries(e)){const r=s[i];if(r){const a={detail:{[i]:n},target:t};r(a),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,n]=this.data.rect.map(g=>Math.fround(g));if(t.length===8){const[g,b,v,w]=t.subarray(2,6);if(i===g&&n===b&&e===v&&s===w)return}const{style:r}=this.container;let a;if(this.#e){const{borderColor:g,borderWidth:b}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const l=i-e,h=n-s,{svgFactory:c}=this,d=c.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const u=c.createElement("defs");d.append(u);const f=c.createElement("clipPath"),p=`clippath_${this.data.id}`;f.setAttribute("id",p),f.setAttribute("clipPathUnits","objectBoundingBox"),u.append(f);for(let g=2,b=t.length;g<b;g+=8){const v=t[g],w=t[g+1],y=t[g+2],_=t[g+3],A=c.createElement("rect"),S=(y-e)/l,E=(n-w)/h,T=(v-y)/l,C=(w-_)/h;A.setAttribute("x",S),A.setAttribute("y",E),A.setAttribute("width",T),A.setAttribute("height",C),f.append(A),a?.push(`<rect vector-effect="non-scaling-stroke" x="${S}" y="${E}" width="${T}" height="${C}"/>`)}this.#e&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${p})`}_createPopup(t=null){const{data:e}=this;let s,i;t?(s={str:t.text},i=t.date):(s=e.contentsObj,i=e.modificationDate),this.#i=new _r({data:{color:e.color,titleObj:e.titleObj,modificationDate:i,contentsObj:s,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#i||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#i}render(){xt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:n,id:r,exportValues:a}of i){if(n===-1||r===e)continue;const l=typeof a=="string"?a:null,h=document.querySelector(`[data-element-id="${r}"]`);if(h&&!Vs.has(h)){K(`_getElementsByName - element not allowed: ${r}`);continue}s.push({id:r,exportValue:l,domElement:h})}return s}for(const i of document.getElementsByName(t)){const{exportValue:n}=i,r=i.getAttribute("data-element-id");r!==e&&Vs.has(i)&&s.push({id:r,exportValue:n,domElement:i})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class nu extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class ta extends It{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action,t.overlaidText),i=!0):t.attachment?(this.#e(s,t.attachment,t.overlaidText,t.attachmentDest),i=!0):t.setOCGState?(this.#i(s,t.setOCGState,t.overlaidText),i=!0):t.dest?(this._bindLink(s,t.dest,t.overlaidText),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&(this.contentElement=s,this.container.append(s)),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,s=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),s&&(t.title=s)}_bindNamedAction(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),s&&(t.title=s),this.#t()}#e(t,e,s="",i=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:s&&(t.title=s),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#t()}#i(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),s&&(t.title=s),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const n=s.get(i);n&&(t[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){K('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();const{fields:i,refs:n,include:r}=e,a=[];if(i.length!==0||n.length!==0){const c=new Set(n);for(const d of i){const u=this._fieldObjects[d]||[];for(const{id:f}of u)c.add(f)}for(const d of Object.values(this._fieldObjects))for(const u of d)c.has(u.id)===r&&a.push(u)}else for(const c of Object.values(this._fieldObjects))a.push(...c);const l=this.annotationStorage,h=[];for(const c of a){const{id:d}=c;switch(h.push(d),c.type){case"text":{const f=c.defaultValue||"";l.setValue(d,{value:f});break}case"checkbox":case"radiobutton":{const f=c.defaultValue===c.exportValues;l.setValue(d,{value:f});break}case"combobox":case"listbox":{const f=c.defaultValue||"";l.setValue(d,{value:f});break}default:continue}const u=document.querySelector(`[data-element-id="${d}"]`);if(u){if(!Vs.has(u)){K(`_bindResetFormAction - element not allowed: ${d}`);continue}}else continue;u.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}}}class ru extends It{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class Ys extends It{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Ut.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,n){s.includes("mouse")?t.addEventListener(s,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(s,r=>{if(s==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r)}})})}_setEventListeners(t,e,s,i){for(const[n,r]of s)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,n,r,i),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":F.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||su,n=t.style;let r;const a=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-a),c=Math.round(h/(Jn*i))||1,d=h/c;r=Math.min(i,l(d/Jn))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,l(h/Jn))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=F.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class au extends Ys{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=s),n.setValue(r.id,{[i]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let n=i.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&n.length>r&&(n=n.slice(0,r));let a=i.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const l={userValue:n,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=a??n,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",a??n),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Vs.add(s),this.contentElement=s,s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:h,datetimeType:c,timeStep:d}=this.data,u=!!c&&this.enableScripting;h&&(s.title=h),this._setRequired(s,this.data.required),r&&(s.maxLength=r),s.addEventListener("input",p=>{t.setValue(e,{value:p.target.value}),this.setPropertyOnSiblings(s,"value",p.target.value,"value"),l.formattedValue=null}),s.addEventListener("resetform",p=>{const g=this.data.defaultFieldValue??"";s.value=l.userValue=g,l.formattedValue=null});let f=p=>{const{formattedValue:g}=l;g!=null&&(p.target.value=g),p.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",g=>{if(l.focused)return;const{target:b}=g;if(u&&(b.type=c,d&&(b.step=d)),l.userValue){const v=l.userValue;if(u)if(c==="time"){const w=new Date(v),y=[w.getHours(),w.getMinutes(),w.getSeconds()];b.value=y.map(_=>_.toString().padStart(2,"0")).join(":")}else b.value=new Date(v-iu).toISOString().split(c==="date"?"T":".",1)[0];else b.value=v}l.lastCommittedValue=b.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),s.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const b={value(v){l.userValue=v.detail.value??"",u||t.setValue(e,{value:l.userValue.toString()}),v.target.value=l.userValue},formattedValue(v){const{formattedValue:w}=v.detail;l.formattedValue=w,w!=null&&v.target!==document.activeElement&&(v.target.value=w);const y={formattedValue:w};u&&(y.value=w),t.setValue(e,y)},selRange(v){v.target.setSelectionRange(...v.detail.selRange)},charLimit:v=>{const{charLimit:w}=v.detail,{target:y}=v;if(w===0){y.removeAttribute("maxLength");return}y.setAttribute("maxLength",w);let _=l.userValue;!_||_.length<=w||(_=_.slice(0,w),y.value=l.userValue=_,t.setValue(e,{value:_}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:_,willCommit:!0,commitKey:1,selStart:y.selectionStart,selEnd:y.selectionEnd}}))}};this._dispatchEventFromSandbox(b,g)}),s.addEventListener("keydown",g=>{l.commitKey=1;let b=-1;if(g.key==="Escape"?b=0:g.key==="Enter"&&!this.data.multiLine?b=2:g.key==="Tab"&&(l.commitKey=3),b===-1)return;const{value:v}=g.target;l.lastCommittedValue!==v&&(l.lastCommittedValue=v,l.userValue=v,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:v,willCommit:!0,commitKey:b,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const p=f;f=null,s.addEventListener("blur",g=>{if(!l.focused||!g.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{target:b}=g;let{value:v}=b;if(u){if(v&&c==="time"){const w=v.split(":").map(y=>parseInt(y,10));v=new Date(2e3,0,1,w[0],w[1],w[2]||0).valueOf(),b.step=""}else v.includes("T")||(v=`${v}T00:00`),v=new Date(v).valueOf();b.type="text"}l.userValue=v,l.lastCommittedValue!==v&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:v,willCommit:!0,commitKey:l.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}),p(g)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",g=>{l.lastCommittedValue=null;const{data:b,target:v}=g,{value:w,selectionStart:y,selectionEnd:_}=v;let A=y,S=_;switch(g.inputType){case"deleteWordBackward":{const E=w.substring(0,y).match(/\w*[^\w]*$/);E&&(A-=E[0].length);break}case"deleteWordForward":{const E=w.substring(y).match(/^[^\w]*\w*/);E&&(S+=E[0].length);break}case"deleteContentBackward":y===_&&(A-=1);break;case"deleteContentForward":y===_&&(S+=1);break}g.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,change:b||"",willCommit:!1,selStart:A,selEnd:S}})}),this._setEventListeners(s,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(f&&s.addEventListener("blur",f),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/r;s.classList.add("comb"),s.style.letterSpacing=`calc(${g}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ou extends Ys{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class lu extends Ys{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Vs.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const h of this._getElementsByName(a,s)){const c=l&&h.exportValue===e.exportValue;h.domElement&&(h.domElement.checked=c),t.setValue(h.id,{value:c})}t.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const a={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Ll extends Ys{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const r of this._getElementsByName(e.fieldName,s))t.setValue(r.id,{value:!1});const n=document.createElement("input");if(Vs.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const h of this._getElementsByName(a,s))t.setValue(h.id,{value:!1});t.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;n.addEventListener("updatefromsandbox",a=>{const l={value:h=>{const c=r===h.detail.value;for(const d of this._getElementsByName(h.target.name)){const u=c&&d.id===s;d.domElement&&(d.domElement.checked=u),t.setValue(d.id,{value:u})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class hu extends ta{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class cu extends Ys{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Vs.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",c=>{const d=this.data.defaultFieldValue;for(const u of i.options)u.selected=u.value===d});for(const c of this.data.options){const d=document.createElement("option");d.textContent=c.displayValue,d.value=c.exportValue,s.value.includes(c.exportValue)&&(d.setAttribute("selected",!0),n=!1),i.append(d)}let r=null;if(n){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),i.prepend(c),r=()=>{c.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const a=c=>{const d=c?"value":"textContent",{options:u,multiple:f}=i;return f?Array.prototype.filter.call(u,p=>p.selected).map(p=>p[d]):u.selectedIndex===-1?null:u[u.selectedIndex][d]};let l=a(!1);const h=c=>{const d=c.target.options;return Array.prototype.map.call(d,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",c=>{const d={value(u){r?.();const f=u.detail.value,p=new Set(Array.isArray(f)?f:[f]);for(const g of i.options)g.selected=p.has(g.value);t.setValue(e,{value:a(!0)}),l=a(!1)},multipleSelection(u){i.multiple=!0},remove(u){const f=i.options,p=u.detail.remove;f[p].selected=!1,i.remove(p),f.length>0&&Array.prototype.findIndex.call(f,b=>b.selected)===-1&&(f[0].selected=!0),t.setValue(e,{value:a(!0),items:h(u)}),l=a(!1)},clear(u){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=a(!1)},insert(u){const{index:f,displayValue:p,exportValue:g}=u.detail.insert,b=i.children[f],v=document.createElement("option");v.textContent=p,v.value=g,b?b.before(v):i.append(v),t.setValue(e,{value:a(!0),items:h(u)}),l=a(!1)},items(u){const{items:f}=u.detail;for(;i.length!==0;)i.remove(0);for(const p of f){const{displayValue:g,exportValue:b}=p,v=document.createElement("option");v.textContent=g,v.value=b,i.append(v)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:a(!0),items:h(u)}),l=a(!1)},indices(u){const f=new Set(u.detail.indices);for(const p of u.target.options)p.selected=f.has(p.index);t.setValue(e,{value:a(!0)}),l=a(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(d,c)}),i.addEventListener("input",c=>{const d=a(!0),u=a(!1);t.setValue(e,{value:d}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:u,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):i.addEventListener("input",function(c){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class _r extends It{constructor(t){const{data:e,elements:s,parent:i}=t,n=!!i._commentManager;if(super(t,{isRenderable:!n&&It._hasPopupData(e)}),this.elements=s,n&&It._hasPopupData(e)){const r=this.popup=this.#t();for(const a of s)a.popup=r}else this.popup=null}#t(){return new du({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),s=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",s.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(i=>`${ii}${i}`).join(",")),this.container}}class du{#t=null;#e=this.#W.bind(this);#i=this.#U.bind(this);#s=this.#L.bind(this);#a=this.#A.bind(this);#r=null;#n=null;#o=null;#h=null;#l=null;#u=null;#d=null;#f=!1;#m=null;#p=null;#c=null;#g=null;#b=null;#w=null;#v=null;#E=null;#S=null;#y=null;#T=!1;#_=null;#x=null;constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:n,contentsObj:r,richText:a,parent:l,rect:h,parentRect:c,open:d,commentManager:u=null}){this.#n=t,this.#S=i,this.#o=r,this.#E=a,this.#u=l,this.#r=e,this.#v=h,this.#d=c,this.#l=s,this.#t=u,this.#_=s[0],this.#h=Pn.toDateObject(n),this.trigger=s.flatMap(f=>f.getElementsToTriggerPopup()),u||(this.#M(),this.#n.hidden=!0,d&&this.#A())}#M(){if(this.#p)return;this.#p=new AbortController;const{signal:t}=this.#p;for(const e of this.trigger)e.addEventListener("click",this.#a,{signal:t}),e.addEventListener("pointerenter",this.#s,{signal:t}),e.addEventListener("pointerleave",this.#i,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#P(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#g){this.#g.parentNode||this.#_.container.after(this.#g);return}if(this.#b||this.#P(),!this.#b)return;const{signal:t}=this.#p=new AbortController,e=this.#_.hasOwnCommentButton,s=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},i=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},n=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#g=this.#_.container;for(const r of this.trigger)r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",s,{signal:t}),r.addEventListener("pointerenter",i,{signal:t}),r.addEventListener("pointerleave",n,{signal:t}),r.classList.add("popupTriggerArea")}else{const r=this.#g=document.createElement("button");r.className="annotationCommentButton";const a=this.#_.container;r.style.zIndex=a.style.zIndex+1,r.tabIndex=0,r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#N(),this.#k(),r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",s,{signal:t}),r.addEventListener("pointerenter",i,{signal:t}),r.addEventListener("pointerleave",n,{signal:t}),a.after(r)}}#k(){if(this.#_.extraPopupElement&&!this.#_.editor)return;this.#g||this.renderCommentButton();const[t,e]=this.#b,{style:s}=this.#g;s.left=`calc(${t}%)`,s.top=`calc(${e}% - var(--comment-button-dim))`}#N(){this.#_.extraPopupElement||(this.#g||this.renderCommentButton(),this.#g.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#_.commentData;return t?this.#u._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#g?.focus()},0)}getData(){const{richText:t,color:e,opacity:s,creationDate:i,modificationDate:n}=this.#_.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:s,creationDate:i,modificationDate:n}}get elementBeforePopup(){return this.#g}get comment(){return this.#x||=this.#_.commentText,this.#x}set comment(t){t!==this.comment&&(this.#_.commentText=this.#x=t)}focus(){this.#_.container?.focus()}get parentBoundingClientRect(){return this.#_.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#g&&(this.#g.classList.toggle("selected",t),this.#g.ariaExpanded=e)}setSelectedCommentButton(t){this.#g.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#w)return this.#w;const{x:t,y:e,height:s}=this.#g.getBoundingClientRect(),{x:i,y:n,width:r,height:a}=this.#_.layer.getBoundingClientRect();return[(t-i)/r,(e+s-n)/a]}set commentPopupPosition(t){this.#w=t}hasDefaultPopupPosition(){return this.#w===null}get commentButtonPosition(){return this.#b}get commentButtonWidth(){return this.#g.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,s]=this.#w||this.commentButtonPosition.map(h=>h/100),i=this.parentBoundingClientRect,{x:n,y:r,width:a,height:l}=i;this.#t.showDialog(null,this,n+e*a,r+s*l,{...t,parentDimensions:i})}render(){if(this.#m)return;const t=this.#m=document.createElement("div");if(t.className="popup",this.#r){const s=t.style.outlineColor=F.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const s=document.createElement("span");s.className="title",e.append(s),{dir:s.dir,str:s.textContent}=this.#S}if(t.append(e),this.#h){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#h.valueOf()})),s.dateTime=this.#h.toISOString(),e.append(s)}$r({html:this.#D||this.#o.str,dir:this.#o?.dir,className:"popupContent"},t),this.#n.append(t)}get#D(){const t=this.#E,e=this.#o;return t?.str&&(!e?.str||e.str===t.str)&&this.#E.html||null}get#I(){return this.#D?.attributes?.style?.fontSize||0}get#B(){return this.#D?.attributes?.style?.color||null}#F(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#B,fontSize:this.#I?`calc(${this.#I}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:i});return s}#W(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#A()}updateEdited({rect:t,popup:e,deleted:s}){if(this.#t){s?(this.remove(),this.#x=null):e&&(e.deleted?this.remove():(this.#N(),this.#x=e.text)),t&&(this.#b=null,this.#P(),this.#k());return}if(s||e?.deleted){this.remove();return}this.#M(),this.#y||={contentsObj:this.#o,richText:this.#E},t&&(this.#c=null),e&&e.text&&(this.#E=this.#F(e.text),this.#h=Pn.toDateObject(e.date),this.#o=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#y&&({contentsObj:this.#o,richText:this.#E}=this.#y,this.#y=null,this.#m?.remove(),this.#m=null,this.#c=null)}remove(){if(this.#p?.abort(),this.#p=null,this.#m?.remove(),this.#m=null,this.#T=!1,this.#f=!1,this.#g?.remove(),this.#g=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#C(){if(this.#c!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:n}}}=this.#u;let r=!!this.#d,a=r?this.#d:this.#v;for(const p of this.#l)if(!a||F.intersect(p.data.rect,a)!==null){a=p.data.rect,r=!0;break}const l=F.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),c=r?a[2]-a[0]+5:0,d=l[0]+c,u=l[1];this.#c=[100*(d-i)/e,100*(u-n)/s];const{style:f}=this.#n;f.left=`${this.#c[0]}%`,f.top=`${this.#c[1]}%`}#A(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#L(),this.#n.addEventListener("click",this.#a),this.#n.addEventListener("keydown",this.#e)):(this.#U(),this.#n.removeEventListener("click",this.#a),this.#n.removeEventListener("keydown",this.#e))}#L(){this.#m||this.render(),this.isVisible?this.#f&&this.#n.classList.add("focused"):(this.#C(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#U(){this.#n.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#T=this.isVisible,this.#T&&(this.#n.hidden=!0)}maybeShow(){this.#t||(this.#M(),this.#T&&(this.#m||this.#L(),this.#T=!1,this.#n.hidden=!1))}get isVisible(){return this.#t?!1:this.#n.hidden===!1}}class Il extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=Y.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class uu extends It{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),n.setAttribute("stroke-width",t.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),i.append(n),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class fu extends It{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",n/2),r.setAttribute("y",n/2),r.setAttribute("width",e-n),r.setAttribute("height",s-n),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class pu extends It{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",s/2),r.setAttribute("rx",e/2-n/2),r.setAttribute("ry",s/2-n/2),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Fl extends It{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:i},width:n,height:r}=this;if(!e)return this.container;const a=this.svgFactory.create(n,r,!0);let l=[];for(let c=0,d=e.length;c<d;c+=2){const u=e[c]-t[0],f=t[3]-e[c+1];l.push(`${u},${f}`)}l=l.join(" ");const h=this.#t=this.svgFactory.createElement(this.svgElementName);return h.setAttribute("points",l),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),a.append(h),this.container.append(a),!i&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class gu extends Fl{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class mu extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class ea extends It{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Y.HIGHLIGHT:Y.INK}#i(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:i,popupRef:n}}=this,{transform:r,width:a,height:l}=this.#i(e,t),h=this.svgFactory.create(a,l,!0),c=this.#t=this.svgFactory.createElement("svg:g");h.append(c),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",r);for(let d=0,u=s.length;d<u;d++){const f=this.svgFactory.createElement(this.svgElementName);this.#e.push(f),f.setAttribute("points",s[d].join(",")),c.append(f)}return!n&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:i}=t,n=this.#t;if(e>=0&&n.setAttribute("stroke-width",e||1),s)for(let r=0,a=this.#e.length;r<a;r++)this.#e[r].setAttribute("points",s[r].join(","));if(i){const{transform:r,width:a,height:l}=this.#i(this.data.rotation,i);n.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),n.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ol extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Y.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class vu extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class bu extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class yu extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Nl extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Y.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class wu extends It{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:i}=Ut.platform;return t.addEventListener("keydown",n=>{n.key==="Enter"&&(i?n.metaKey:n.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class jn{#t=null;#e=null;#i=null;#s=new Map;#a=null;#r=null;#n=[];#o=!1;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:a,commentManager:l,linkService:h,annotationStorage:c}){this.div=t,this.#t=e,this.#e=s,this.#a=a||null,this.#r=h||null,this.#i=c||new Gr,this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=l||null}hasEditableAnnotations(){return this.#s.size>0}async render(t){const{annotations:e}=t,s=this.div;Ss(s,this.viewport);const i=new Map,n=[],r={data:null,layer:s,linkService:this.#r,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Vi,annotationStorage:this.#i,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const l=a.annotationType===Ft.POPUP;if(l){const d=i.get(a.id);if(!d)continue;if(!this._commentManager){n.push(a);continue}r.elements=d}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;r.data=a;const h=rr.create(r);if(!h.isRenderable)continue;if(!l&&(this.#n.push(h),a.popupRef)){const d=i.get(a.popupRef);d?d.push(h):i.set(a.popupRef,[h])}const c=h.render();a.hidden&&(c.style.visibility="hidden"),h._isEditable&&(this.#s.set(h.data.id,h),this._annotationEditorUIManager?.renderAnnotationElement(h))}await this.#h();for(const a of n){const l=r.elements=i.get(a.id);r.data=a;const h=rr.create(r);if(!h.isRenderable)continue;const c=h.render();h.contentElement.id=`${ii}${a.id}`,a.hidden&&(c.style.visibility="hidden"),l.at(-1).container.after(c)}this.#l()}async#h(){if(this.#n.length===0)return;this.div.replaceChildren();const t=[];if(!this.#o){this.#o=!0;for(const{contentElement:s,data:{id:i}}of this.#n){const n=s.id=`${ii}${i}`;t.push(this.#a?.getAriaAttributes(n).then(r=>{if(r)for(const[a,l]of r)s.setAttribute(a,l)}))}}this.#n.sort(({data:{rect:[s,i,n,r]}},{data:{rect:[a,l,h,c]}})=>{if(s===n&&i===r)return 1;if(a===h&&l===c)return-1;const d=r,u=i,f=(i+r)/2,p=c,g=l,b=(l+c)/2;if(f>=p&&b<=u)return-1;if(b>=d&&f<=g)return 1;const v=(s+n)/2,w=(a+h)/2;return v-w});const e=document.createDocumentFragment();for(const s of this.#n)e.append(s.container),this._commentManager?(s.extraPopupElement?.popup||s.popup)?.renderCommentButton():s.extraPopupElement&&e.append(s.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),this.#t)for(const s of this.#n)this.#t.addPointerInTextLayer(s.contentElement,!1)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#r,svgFactory:new Vi,parent:this};for(const s of t){s.borderStyle||=jn._defaultBorderStyle,e.data=s;const i=rr.create(e);i.isRenderable&&(i.render(),i.contentElement.id=`${ii}${s.id}`,this.#n.push(i))}await this.#h()}update({viewport:t}){const e=this.div;this.viewport=t,Ss(e,{rotation:t.rotation}),this.#l(),e.hidden=!1}#l(){if(!this.#e)return;const t=this.div;for(const[e,s]of this.#e){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:n}=i;n?n.nodeName==="CANVAS"?n.replaceWith(s):n.classList.contains("annotationContent")?n.after(s):n.before(s):i.append(s);const r=this.#s.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,i.id,s),r._hasNoCanvas=!1):r.canvas=s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(t){return this.#s.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:s,rotation:i}=t,n=new nu({data:{id:s,rect:t.getPDFRect(),rotation:i},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#i});return n.render(),n.contentElement.id=`${ii}${s}`,n.createOrUpdatePopup(),this.#n.push(n),n}removeAnnotation(t){const e=this.#n.findIndex(i=>i.data.id===t);if(e<0)return;const[s]=this.#n.splice(e,1);this.#t?.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);this.#h()}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return X(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Qs.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const vn=/\r\n?|\n/g;class Gt extends W{#t="";#e=`${this.id}-editor`;#i=null;#s;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=Gt.prototype,e=n=>n.isEmpty(),s=ds.TRANSLATE_SMALL,i=ds.TRANSLATE_BIG;return X(this,"_keyboardManager",new tn([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=Y.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||Gt._defaultColor||W._defaultLineColor,this.#s=t.fontSize||Gt._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(t,e){W.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case nt.FREETEXT_SIZE:Gt._defaultFontSize=e;break;case nt.FREETEXT_COLOR:Gt._defaultColor=e;break}}updateParams(t,e){switch(t){case nt.FREETEXT_SIZE:this.#a(e);break;case nt.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[nt.FREETEXT_SIZE,Gt._defaultFontSize],[nt.FREETEXT_COLOR,Gt._defaultColor||W._defaultLineColor]]}get propertiesToUpdate(){return[[nt.FREETEXT_SIZE,this.#s],[nt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Wi(this),[["colorPicker",this._colorPicker]]}get colorType(){return nt.FREETEXT_COLOR}#a(t){const e=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-this.#s)*this.parentScale),this.#s=i,this.#o()},s=this.#s;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(t){const e=i=>{this.color=i,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-Gt._internalPadding*t,-(Gt._internalPadding+this.#s)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#n(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(Gt.#h(s)),e=s);return t.join(`
`)}#o(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:i,div:n}=this,r=n.style.display,a=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",i.div.append(this.div),s=n.getBoundingClientRect(),n.remove(),n.style.display=r,n.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/e):(this.width=s.height/t,this.height=s.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#n().trimEnd();if(t===e)return;const s=i=>{if(this.#t=i,!i){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Gt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,n]=this.parentDimensions;if(this.annotationElementId){const{position:r}=this._initialData;let[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);const[h,c]=this.pageDimensions,[d,u]=this.pageTranslation;let f,p;switch(this.rotation){case 0:f=t+(r[0]-d)/h,p=e+this.height-(r[1]-u)/c;break;case 90:f=t+(r[0]-d)/h,p=e-(r[1]-u)/c,[a,l]=[l,-a];break;case 180:f=t-this.width+(r[0]-d)/h,p=e-(r[1]-u)/c,[a,l]=[-a,-l];break;case 270:f=t+(r[0]-d-this.height*c)/h,p=e+(r[1]-u-this.width*h)/c,[a,l]=[-l,a];break}this.setAt(f*i,p*n,a,l)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#h(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(vn,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:s}=e;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const i=Gt.#d(e.getData("text")||"").replaceAll(vn,`
`);if(!i)return;const n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();const r=n.getRangeAt(0);if(!i.includes(`
`)){r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),n.collapseToStart();return}const{startContainer:a,startOffset:l}=r,h=[],c=[];if(a.nodeType===Node.TEXT_NODE){const f=a.parentElement;if(c.push(a.nodeValue.slice(l).replaceAll(vn,"")),f!==this.editorDiv){let p=h;for(const g of this.editorDiv.childNodes){if(g===f){p=c;continue}p.push(Gt.#h(g))}}h.push(a.nodeValue.slice(0,l).replaceAll(vn,""))}else if(a===this.editorDiv){let f=h,p=0;for(const g of this.editorDiv.childNodes)p++===l&&(f=c),f.push(Gt.#h(g))}this.#t=`${h.join(`
`)}${i}${c.join(`
`)}`,this.#l();const d=new Range;let u=Math.sumPrecise(h.map(f=>f.length));for(const{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){const p=f.nodeValue.length;if(u<=p){d.setStart(f,u),d.setEnd(f,u);break}u-=p}n.removeAllRanges(),n.addRange(d)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#t.replaceAll(" "," ")}static#d(t){return t.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Gt._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,s){let i=null;if(t instanceof Il){const{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:l,rotation:h,id:c,popupRef:d,richText:u,contentsObj:f,creationDate:p,modificationDate:g},textContent:b,textPosition:v,parent:{page:{pageNumber:w}}}=t;if(!b||b.length===0)return null;i=t={annotationType:Y.FREETEXT,color:Array.from(a),fontSize:r,value:b.join(`
`),position:v,pageIndex:w-1,rect:l.slice(0),rotation:h,annotationElementId:c,id:c,deleted:!1,popupRef:d,comment:f?.str||null,richText:u,creationDate:p,modificationDate:g}}const n=await super.deserialize(t,e,s);return n.#s=t.fontSize,n.color=F.makeHexColor(...t.color),n.#t=Gt.#d(t.value),n._initialData=i,t.comment&&n.setCommentData(t),n}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=W._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(t),{color:e,fontSize:this.#s,value:this.#u()});return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!this.#f(s)?null:(s.id=this.annotationElementId,s)}#f(t){const{value:e,fontSize:s,color:i,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((r,a)=>r!==i[a])||t.pageIndex!==n}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:s}=e;s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,e.replaceChildren();for(const i of this.#t.split(`
`)){const n=document.createElement("div");n.append(i?document.createTextNode(i):document.createElement("br")),e.append(n)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class H{static PRECISION=1e-4;toSVGPath(){xt("Abstract method `toSVGPath` must be implemented.")}get box(){xt("Abstract getter `box` must be implemented.")}serialize(t,e){xt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a]*i,r[a+1]=s+t[a+1]*n;return r}static _rescaleAndSwap(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a+1]*i,r[a+1]=s+t[a]*n;return r}static _translate(t,e,s,i){i||=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n+=2)i[n]=e+t[n],i[n+1]=s+t[n+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,n){switch(n){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,n,r){return[(t+5*s)/6,(e+5*i)/6,(5*s+n)/6,(5*i+r)/6,(s+n)/2,(i+r)/2]}}class Ls{#t;#e=[];#i;#s;#a=[];#r=new Float32Array(18);#n;#o;#h;#l;#u;#d;#f=[];static#m=8;static#p=2;static#c=Ls.#m+Ls.#p;constructor({x:t,y:e},s,i,n,r,a=0){this.#t=s,this.#d=n*i,this.#s=r,this.#r.set([NaN,NaN,NaN,NaN,t,e],6),this.#i=a,this.#l=Ls.#m*i,this.#h=Ls.#c*i,this.#u=i,this.#f.push(t,e)}isEmpty(){return isNaN(this.#r[8])}#g(){const t=this.#r.subarray(4,6),e=this.#r.subarray(16,18),[s,i,n,r]=this.#t;return[(this.#n+(t[0]-e[0])/2-s)/n,(this.#o+(t[1]-e[1])/2-i)/r,(this.#n+(e[0]-t[0])/2-s)/n,(this.#o+(e[1]-t[1])/2-i)/r]}add({x:t,y:e}){this.#n=t,this.#o=e;const[s,i,n,r]=this.#t;let[a,l,h,c]=this.#r.subarray(8,12);const d=t-h,u=e-c,f=Math.hypot(d,u);if(f<this.#h)return!1;const p=f-this.#l,g=p/f,b=g*d,v=g*u;let w=a,y=l;a=h,l=c,h+=b,c+=v,this.#f?.push(t,e);const _=-v/p,A=b/p,S=_*this.#d,E=A*this.#d;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([h+S,c+E],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([h-S,c-E],16),isNaN(this.#r[6])?(this.#a.length===0&&(this.#r.set([a+S,l+E],2),this.#a.push(NaN,NaN,NaN,NaN,(a+S-s)/n,(l+E-i)/r),this.#r.set([a-S,l-E],14),this.#e.push(NaN,NaN,NaN,NaN,(a-S-s)/n,(l-E-i)/r)),this.#r.set([w,y,a,l,h,c],6),!this.isEmpty()):(this.#r.set([w,y,a,l,h,c],6),Math.abs(Math.atan2(y-l,w-a)-Math.atan2(v,b))<Math.PI/2?([a,l,h,c]=this.#r.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((a+h)/2-s)/n,((l+c)/2-i)/r),[a,l,w,y]=this.#r.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((w+a)/2-s)/n,((y+l)/2-i)/r),!0):([w,y,a,l,h,c]=this.#r.subarray(0,6),this.#a.push(((w+5*a)/6-s)/n,((y+5*l)/6-i)/r,((5*a+h)/6-s)/n,((5*l+c)/6-i)/r,((a+h)/2-s)/n,((l+c)/2-i)/r),[h,c,a,l,w,y]=this.#r.subarray(12,18),this.#e.push(((w+5*a)/6-s)/n,((y+5*l)/6-i)/r,((5*a+h)/6-s)/n,((5*l+c)/6-i)/r,((a+h)/2-s)/n,((l+c)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#a,e=this.#e;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#b();const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);this.#v(s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return this.#w(s),s.join(" ")}#b(){const[t,e,s,i]=this.#t,[n,r,a,l]=this.#g();return`M${(this.#r[2]-t)/s} ${(this.#r[3]-e)/i} L${(this.#r[4]-t)/s} ${(this.#r[5]-e)/i} L${n} ${r} L${a} ${l} L${(this.#r[16]-t)/s} ${(this.#r[17]-e)/i} L${(this.#r[14]-t)/s} ${(this.#r[15]-e)/i} Z`}#w(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#v(t){const[e,s,i,n]=this.#t,r=this.#r.subarray(4,6),a=this.#r.subarray(16,18),[l,h,c,d]=this.#g();t.push(`L${(r[0]-e)/i} ${(r[1]-s)/n} L${l} ${h} L${c} ${d} L${(a[0]-e)/i} ${(a[1]-s)/n}`)}newFreeDrawOutline(t,e,s,i,n,r){return new Bl(t,e,s,i,n,r)}getOutlines(){const t=this.#a,e=this.#e,s=this.#r,[i,n,r,a]=this.#t,l=new Float32Array((this.#f?.length??0)+2);for(let d=0,u=l.length-2;d<u;d+=2)l[d]=(this.#f[d]-i)/r,l[d+1]=(this.#f[d+1]-n)/a;if(l[l.length-2]=(this.#n-i)/r,l[l.length-1]=(this.#o-n)/a,isNaN(s[6])&&!this.isEmpty())return this.#E(l);const h=new Float32Array(this.#a.length+24+this.#e.length);let c=t.length;for(let d=0;d<c;d+=2){if(isNaN(t[d])){h[d]=h[d+1]=NaN;continue}h[d]=t[d],h[d+1]=t[d+1]}c=this.#y(h,c);for(let d=e.length-6;d>=6;d-=6)for(let u=0;u<6;u+=2){if(isNaN(e[d+u])){h[c]=h[c+1]=NaN,c+=2;continue}h[c]=e[d+u],h[c+1]=e[d+u+1],c+=2}return this.#S(h,c),this.newFreeDrawOutline(h,l,this.#t,this.#u,this.#i,this.#s)}#E(t){const e=this.#r,[s,i,n,r]=this.#t,[a,l,h,c]=this.#g(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-s)/n,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-s)/n,(e[5]-i)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(e[16]-s)/n,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-s)/n,(e[15]-i)/r],0),this.newFreeDrawOutline(d,t,this.#t,this.#u,this.#i,this.#s)}#S(t,e){const s=this.#e;return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6}#y(t,e){const s=this.#r.subarray(4,6),i=this.#r.subarray(16,18),[n,r,a,l]=this.#t,[h,c,d,u]=this.#g();return t.set([NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/l],e),e+=24}}class Bl extends H{#t;#e=new Float32Array(4);#i;#s;#a;#r;#n;constructor(t,e,s,i,n,r){super(),this.#n=t,this.#a=e,this.#t=s,this.#r=i,this.#i=n,this.#s=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(r);const[a,l,h,c]=this.#e;for(let d=0,u=t.length;d<u;d+=2)t[d]=(t[d]-a)/h,t[d+1]=(t[d+1]-l)/c;for(let d=0,u=e.length;d<u;d+=2)e[d]=(e[d]-a)/h,e[d+1]=(e[d+1]-l)/c}toSVGPath(){const t=[`M${this.#n[4]} ${this.#n[5]}`];for(let e=6,s=this.#n.length;e<s;e+=6){if(isNaN(this.#n[e])){t.push(`L${this.#n[e+4]} ${this.#n[e+5]}`);continue}t.push(`C${this.#n[e]} ${this.#n[e+1]} ${this.#n[e+2]} ${this.#n[e+3]} ${this.#n[e+4]} ${this.#n[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,i],n){const r=s-t,a=i-e;let l,h;switch(n){case 0:l=H._rescale(this.#n,t,i,r,-a),h=H._rescale(this.#a,t,i,r,-a);break;case 90:l=H._rescaleAndSwap(this.#n,t,e,r,a),h=H._rescaleAndSwap(this.#a,t,e,r,a);break;case 180:l=H._rescale(this.#n,s,e,-r,a),h=H._rescale(this.#a,s,e,-r,a);break;case 270:l=H._rescaleAndSwap(this.#n,s,i,-r,-a),h=H._rescaleAndSwap(this.#a,s,i,-r,-a);break}return{outline:Array.from(l),points:[Array.from(h)]}}#o(t){const e=this.#n;let s=e[4],i=e[5];const n=[s,i,s,i];let r=s,a=i,l=s,h=i;const c=t?Math.max:Math.min,d=new Float32Array(4);for(let f=6,p=e.length;f<p;f+=6){const g=e[f+4],b=e[f+5];isNaN(e[f])?(F.pointBoundingBox(g,b,n),a>b?(r=g,a=b):a===b&&(r=c(r,g)),h<b?(l=g,h=b):h===b&&(l=c(l,g))):(d[0]=d[1]=1/0,d[2]=d[3]=-1/0,F.bezierBoundingBox(s,i,...e.slice(f,f+6),d),F.rectBoundingBox(d[0],d[1],d[2],d[3],n),a>d[1]?(r=d[0],a=d[1]):a===d[1]&&(r=c(r,d[0])),h<d[3]?(l=d[2],h=d[3]):h===d[3]&&(l=c(l,d[2]))),s=g,i=b}const u=this.#e;u[0]=n[0]-this.#i,u[1]=n[1]-this.#i,u[2]=n[2]-n[0]+2*this.#i,u[3]=n[3]-n[1]+2*this.#i,this.firstPoint=[r,a],this.lastPoint=[l,h]}get box(){return this.#e}newOutliner(t,e,s,i,n,r=0){return new Ls(t,e,s,i,n,r)}getNewOutline(t,e){const[s,i,n,r]=this.#e,[a,l,h,c]=this.#t,d=n*h,u=r*c,f=s*h+a,p=i*c+l,g=this.newOutliner({x:this.#a[0]*d+f,y:this.#a[1]*u+p},this.#t,this.#r,t,this.#s,e??this.#i);for(let b=2;b<this.#a.length;b+=2)g.add({x:this.#a[b]*d+f,y:this.#a[b+1]*u+p});return g.getOutlines()}}class Ar{#t;#e;#i;#s=[];#a=[];constructor(t,e=0,s=0,i=!0){const n=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:g,y:b,width:v,height:w}of t){const y=Math.floor((g-e)/r)*r,_=Math.ceil((g+v+e)/r)*r,A=Math.floor((b-e)/r)*r,S=Math.ceil((b+w+e)/r)*r,E=[y,A,S,!0],T=[_,A,S,!1];this.#s.push(E,T),F.rectBoundingBox(y,A,_,S,n)}const a=n[2]-n[0]+2*s,l=n[3]-n[1]+2*s,h=n[0]-s,c=n[1]-s;let d=i?-1/0:1/0,u=1/0;const f=this.#s.at(i?-1:-2),p=[f[0],f[2]];for(const g of this.#s){const[b,v,w,y]=g;!y&&i?v<u?(u=v,d=b):v===u&&(d=Math.max(d,b)):y&&!i&&(v<u?(u=v,d=b):v===u&&(d=Math.min(d,b))),g[0]=(b-h)/a,g[1]=(v-c)/l,g[2]=(w-c)/l}this.#t=new Float32Array([h,c,a,l]),this.#e=[d,u],this.#i=p}getOutlines(){this.#s.sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of this.#s)e[3]?(t.push(...this.#l(e)),this.#o(e)):(this.#h(e),t.push(...this.#l(e)));return this.#r(t)}#r(t){const e=[],s=new Set;for(const r of t){const[a,l,h]=r;e.push([a,l,r],[a,h,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){const l=e[r][2],h=e[r+1][2];l.push(h),h.push(l),s.add(l),s.add(h)}const i=[];let n;for(;s.size>0;){const r=s.values().next().value;let[a,l,h,c,d]=r;s.delete(r);let u=a,f=l;for(n=[a,h],i.push(n);;){let p;if(s.has(c))p=c;else if(s.has(d))p=d;else break;s.delete(p),[a,l,h,c,d]=p,u!==a&&(n.push(u,f,a,f===l?l:h),u=a),f=f===l?h:l}n.push(u,f)}return new _u(i,this.#t,this.#e,this.#i)}#n(t){const e=this.#a;let s=0,i=e.length-1;for(;s<=i;){const n=s+i>>1,r=e[n][0];if(r===t)return n;r<t?s=n+1:i=n-1}return i+1}#o([,t,e]){const s=this.#n(t);this.#a.splice(s,0,[t,e])}#h([,t,e]){const s=this.#n(t);for(let i=s;i<this.#a.length;i++){const[n,r]=this.#a[i];if(n!==t)break;if(n===t&&r===e){this.#a.splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,r]=this.#a[i];if(n!==t)break;if(n===t&&r===e){this.#a.splice(i,1);return}}}#l(t){const[e,s,i]=t,n=[[e,s,i]],r=this.#n(i);for(let a=0;a<r;a++){const[l,h]=this.#a[a];for(let c=0,d=n.length;c<d;c++){const[,u,f]=n[c];if(!(h<=u||f<=l)){if(u>=l){if(f>h)n[c][1]=h;else{if(d===1)return[];n.splice(c,1),c--,d--}continue}n[c][2]=l,f>h&&n.push([e,h,f])}}}return n}}class _u extends H{#t;#e;constructor(t,e,s,i){super(),this.#e=t,this.#t=e,this.firstPoint=s,this.lastPoint=i}toSVGPath(){const t=[];for(const e of this.#e){let[s,i]=e;t.push(`M${s} ${i}`);for(let n=2;n<e.length;n+=2){const r=e[n],a=e[n+1];r===s?(t.push(`V${a}`),i=a):a===i&&(t.push(`H${r}`),s=r)}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],n){const r=[],a=s-t,l=i-e;for(const h of this.#e){const c=new Array(h.length);for(let d=0;d<h.length;d+=2)c[d]=t+h[d]*a,c[d+1]=i-h[d+1]*l;r.push(c)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class Sr extends Ls{newFreeDrawOutline(t,e,s,i,n,r){return new Au(t,e,s,i,n,r)}}class Au extends Bl{newOutliner(t,e,s,i,n,r=0){return new Sr(t,e,s,i,n,r)}}class Ot extends W{#t=null;#e=0;#i;#s=null;#a=null;#r=null;#n=null;#o=0;#h=null;#l=null;#u=null;#d=!1;#f=null;#m=null;#p=null;#c="";#g;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=Y.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=Ot.prototype;return X(this,"_keyboardManager",new tn([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||Ot._defaultColor,this.#g=t.thickness||Ot._defaultThickness,this.opacity=t.opacity||Ot._defaultOpacity,this.#i=t.boxes||null,this.#b=t.methodOfCreation||"",this.#c=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#d=!0,this.#v(t),this.#_()):this.#i&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#n=t.focusNode,this.#o=t.focusOffset,this.#w(),this.#_(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#g,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#w(){const t=new Ar(this.#i,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new Ar(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#r=e.getOutlines();const{firstPoint:s}=this.#l;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height];const{lastPoint:i}=this.#r;this.#m=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#v({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#l=t;const i=1.5;if(this.#r=t.getNewOutline(this.#g/2+i,.0025),e>=0)this.#u=e,this.#s=s,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:Ot.#x(this.#l.box,(d-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:Ot.#x(this.#r.box,d),path:{d:this.#r.toSVGPath()}})}const[n,r,a,l]=t.box;switch(this.rotation){case 0:this.x=n,this.y=r,this.width=a,this.height=l;break;case 90:{const[d,u]=this.parentDimensions;this.x=r,this.y=1-n,this.width=a*u/d,this.height=l*d/u;break}case 180:this.x=1-n,this.y=1-r,this.width=a,this.height=l;break;case 270:{const[d,u]=this.parentDimensions;this.x=1-r,this.y=n,this.width=a*u/d,this.height=l*d/u;break}}const{firstPoint:h}=t;this.#f=[(h[0]-n)/a,(h[1]-r)/l];const{lastPoint:c}=this.#r;this.#m=[(c[0]-n)/a,(c[1]-r)/l]}static initialize(t,e){W.initialize(t,e),Ot._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case nt.HIGHLIGHT_COLOR:Ot._defaultColor=e;break;case nt.HIGHLIGHT_THICKNESS:Ot._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case nt.HIGHLIGHT_COLOR:this.#E(e);break;case nt.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[nt.HIGHLIGHT_COLOR,Ot._defaultColor],[nt.HIGHLIGHT_THICKNESS,Ot._defaultThickness]]}get propertiesToUpdate(){return[[nt.HIGHLIGHT_COLOR,this.color||Ot._defaultColor],[nt.HIGHLIGHT_THICKNESS,this.#g||Ot._defaultThickness],[nt.HIGHLIGHT_FREE,this.#d]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#E(t){const e=(n,r)=>{this.color=n,this.opacity=r,this.onUpdatedColor()},s=this.color,i=this.opacity;this.addCommands({cmd:e.bind(this,t,Ot._defaultOpacity),undo:e.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#g,s=i=>{this.#g=i,this.#y(i)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new Ce({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#k())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#k())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#T(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#_(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#T():t&&(this.#_(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#y(t){this.#d&&(this.#v({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())}#T(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#_(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#s}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#d},path:{d:this.#l.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#d),this.#h&&(this.#h.style.clipPath=this.#s))}static#x([t,e,s,i],n){switch(n){case 90:return[1-e-i,t,i,s];case 180:return[1-t-s,1-e-i,s,i];case 270:return[e,1-t-s,i,s]}return[t,e,s,i]}rotate(t){const{drawLayer:e}=this.parent;let s;this.#d?(t=(t-this.rotation+360)%360,s=Ot.#x(this.#l.box,t)):s=Ot.#x([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#u,{bbox:s,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:Ot.#x(this.#r.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#c&&(t.setAttribute("aria-label",this.#c),t.setAttribute("role","mark")),this.#d?t.classList.add("free"):this.div.addEventListener("keydown",this.#M.bind(this),{signal:this._uiManager._signal});const e=this.#h=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#s,this.setDims(),pl(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#M(t){Ot._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#P(!0);break;case 1:case 3:this.#P(!1);break}}#P(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#n,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#d||this.#P(!1))}get _mustFixPosition(){return!this.#d}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#k(){return this.#d?this.rotation:0}#N(){if(this.#d)return null;const[t,e]=this.pageDimensions,[s,i]=this.pageTranslation,n=this.#i,r=new Float32Array(n.length*8);let a=0;for(const{x:l,y:h,width:c,height:d}of n){const u=l*t+s,f=(1-h)*e+i;r[a]=r[a+4]=u,r[a+1]=r[a+3]=f,r[a+2]=r[a+6]=u+c*t,r[a+5]=r[a+7]=f-d*e,a+=8}return r}#D(t){return this.#l.serialize(t,this.#k())}static startHighlighting(t,e,{target:s,x:i,y:n}){const{x:r,y:a,width:l,height:h}=s.getBoundingClientRect(),c=new AbortController,d=t.combinedSignal(c),u=f=>{c.abort(),this.#B(t,f)};window.addEventListener("blur",u,{signal:d}),window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("pointerdown",Lt,{capture:!0,passive:!1,signal:d}),window.addEventListener("contextmenu",ke,{signal:d}),s.addEventListener("pointermove",this.#I.bind(this,t),{signal:d}),this._freeHighlight=new Sr({x:i,y:n},[r,a,l,h],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#I(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#B(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,s){let i=null;if(t instanceof Ol){const{data:{quadPoints:p,rect:g,rotation:b,id:v,color:w,opacity:y,popupRef:_,richText:A,contentsObj:S,creationDate:E,modificationDate:T},parent:{page:{pageNumber:C}}}=t;i=t={annotationType:Y.HIGHLIGHT,color:Array.from(w),opacity:y,quadPoints:p,boxes:null,pageIndex:C-1,rect:g.slice(0),rotation:b,annotationElementId:v,id:v,deleted:!1,popupRef:_,richText:A,comment:S?.str||null,creationDate:E,modificationDate:T}}else if(t instanceof ea){const{data:{inkLists:p,rect:g,rotation:b,id:v,color:w,borderStyle:{rawWidth:y},popupRef:_,richText:A,contentsObj:S,creationDate:E,modificationDate:T},parent:{page:{pageNumber:C}}}=t;i=t={annotationType:Y.HIGHLIGHT,color:Array.from(w),thickness:y,inkLists:p,boxes:null,pageIndex:C-1,rect:g.slice(0),rotation:b,annotationElementId:v,id:v,deleted:!1,popupRef:_,richText:A,comment:S?.str||null,creationDate:E,modificationDate:T}}const{color:n,quadPoints:r,inkLists:a,opacity:l}=t,h=await super.deserialize(t,e,s);h.color=F.makeHexColor(...n),h.opacity=l||1,a&&(h.#g=t.thickness),h._initialData=i,t.comment&&h.setCommentData(t);const[c,d]=h.pageDimensions,[u,f]=h.pageTranslation;if(r){const p=h.#i=[];for(let g=0;g<r.length;g+=8)p.push({x:(r[g]-u)/c,y:1-(r[g+1]-f)/d,width:(r[g+2]-r[g])/c,height:(r[g+1]-r[g+5])/d});h.#w(),h.#_(),h.rotate(h.rotation)}else if(a){h.#d=!0;const p=a[0],g={x:p[0]-u,y:d-(p[1]-f)},b=new Sr(g,[0,0,c,d],1,h.#g/2,!0,.001);for(let y=0,_=p.length;y<_;y+=2)g.x=p[y]-u,g.y=d-(p[y+1]-f),b.add(g);const{id:v,clipPathId:w}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:b.toSVGPath()}},!0,!0);h.#v({highlightOutlines:b.getOutlines(),highlightId:v,clipPathId:w}),h.#_(),h.rotate(h.parentRotation)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=W._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(t);return Object.assign(s,{color:e,opacity:this.opacity,thickness:this.#g,quadPoints:this.#N(),outlines:this.#D(s.rect)}),this.addComment(s),this.annotationElementId&&!this.#F(s)?null:(s.id=this.annotationElementId,s)}#F(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((s,i)=>s!==e[i])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class Ul{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){xt("Not implemented")}}class gt extends W{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#s=null;static#a=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#r(t),this.#h())}#r({drawOutlines:t,drawId:e,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#n(t,this.parent),this.#d(t.box)}#n(t,e){const{id:s}=e.drawLayer.draw(gt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[i,n]of Object.entries(e))s.has(i)?Object.assign(t[i],n):t[i]=n;return t}static getDefaultDrawingOptions(t){xt("Not implemented")}static get typesMap(){xt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(gt.#i.updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,i]of this.typesMap)t.push([s,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,i]of this.constructor.typesMap)t.push([s,e[i]]);return t}_updateProperty(t,e,s){const i=this._drawingOptions,n=i[e],r=a=>{i.updateProperty(e,a);const l=this.#t.updateProperty(e,a);l&&this.#d(l),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,s),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,gt._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#u()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,gt._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#u()),{bbox:this.#f()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,gt._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#u(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#o(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#h(),this.#d(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#o()):t&&(this._uiManager.addShouldRescale(this),this.#h(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#o(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#h(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#n(this.#t,t)}}#l([t,e,s,i]){const{parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[e,1-t,s*(r/n),i*(n/r)];case 180:return[1-t,1-e,s,i];case 270:return[1-e,t,s*(r/n),i*(n/r)];default:return[t,e,s,i]}}#u(){const{x:t,y:e,width:s,height:i,parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[1-e,t,s*(n/r),i*(r/n)];case 180:return[1-t,1-e,s,i];case 270:return[e,1-t,s*(n/r),i*(r/n)];default:return[t,e,s,i]}}#d(t){[this.x,this.y,this.width,this.height]=this.#l(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:t,y:e,width:s,height:i,rotation:n,parentRotation:r,parentDimensions:[a,l]}=this;switch((n*4+r)/90){case 1:return[1-e-i,t,i,s];case 2:return[1-t-s,1-e-i,s,i];case 3:return[e,1-t-s,i,s];case 4:return[t,e-s*(a/l),i*(l/a),s*(a/l)];case 5:return[1-e,t,s*(a/l),i*(l/a)];case 6:return[1-t-i*(l/a),1-e,i*(l/a),s*(a/l)];case 7:return[e-s*(a/l),1-t-i*(l/a),s*(a/l),i*(l/a)];case 8:return[t-s,e-i,s,i];case 9:return[1-e,t-s,i,s];case 10:return[1-t,1-e,s,i];case 11:return[e-i,1-t,i,s];case 12:return[t-i*(l/a),e,i*(l/a),s*(a/l)];case 13:return[1-e-s*(a/l),t-i*(l/a),s*(a/l),i*(l/a)];case 14:return[1-t,1-e-s*(a/l),i*(l/a),s*(a/l)];case 15:return[e,1-t,s*(a/l),i*(l/a)];default:return[t,e,s,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,gt._mergeSVGProperties({bbox:this.#f()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#d(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const s=super.render();s.classList.add("draw");const i=document.createElement("div");return s.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),s}static createDrawerInstance(t,e,s,i,n){xt("Not implemented")}static startDrawing(t,e,s,i){const{target:n,offsetX:r,offsetY:a,pointerId:l,pointerType:h}=i;if(mt.isInitializedAndDifferentPointerType(h))return;const{viewport:{rotation:c}}=t,{width:d,height:u}=n.getBoundingClientRect(),f=gt.#s=new AbortController,p=t.combinedSignal(f);if(mt.setPointer(h,l),window.addEventListener("pointerup",g=>{mt.isSamePointerIdOrRemove(g.pointerId)&&this._endDraw(g)},{signal:p}),window.addEventListener("pointercancel",g=>{mt.isSamePointerIdOrRemove(g.pointerId)&&this._currentParent.endDrawingSession()},{signal:p}),window.addEventListener("pointerdown",g=>{mt.isSamePointerType(g.pointerType)&&(mt.initializeAndAddPointerId(g.pointerId),gt.#i.isCancellable()&&(gt.#i.removeLastElement(),gt.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",ke,{signal:p}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:p}),n.addEventListener("touchmove",g=>{mt.isSameTimeStamp(g.timeStamp)&&Lt(g)},{signal:p}),t.toggleDrawing(),e._editorUndoBar?.hide(),gt.#i){t.drawLayer.updateProperties(this._currentDrawId,gt.#i.startNew(r,a,d,u,c));return}e.updateUIForDefaultProperties(this),gt.#i=this.createDrawerInstance(r,a,d,u,c),gt.#a=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(gt.#a.toSVGProperties(),gt.#i.defaultSVGProperties),!0,!1)}static _drawMove(t){if(mt.isSameTimeStamp(t.timeStamp),!gt.#i)return;const{offsetX:e,offsetY:s,pointerId:i}=t;if(mt.isSamePointerId(i)){if(mt.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,gt.#i.add(e,s)),mt.setTimeStamp(t.timeStamp),Lt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,gt.#i=null,gt.#a=null,mt.clearTimeStamp()),gt.#s&&(gt.#s.abort(),gt.#s=null,mt.clearPointerIds())}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,gt.#i.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=gt.#i,i=this._currentDrawId,n=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(i,s.setLastElement(n))},undo:()=>{e.drawLayer.updateProperties(i,s.removeLastElement())},mustExec:!1,type:nt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(nt.DRAW_STEP),!gt.#i.isEmpty()){const{pageDimensions:[s,i],scale:n}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:gt.#i.getOutlines(s*n,i*n,n,this._INNER_MARGIN),drawingOptions:gt.#a,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,i,n,r){xt("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:i,pageHeight:n,pageX:r,pageY:a}}=e.viewport,l=this.deserializeDraw(r,a,i,n,this._INNER_MARGIN,t),h=await super.deserialize(t,e,s);return h.createDrawingOptions(t),h.#r({drawOutlines:l}),h.#h(),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[e,s]=this.pageTranslation,[i,n]=this.pageDimensions;return this.#t.serialize([e,s,i,n],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class Su{#t=new Float64Array(6);#e;#i;#s;#a;#r;#n="";#o=0;#h=new nn;#l;#u;constructor(t,e,s,i,n,r){this.#l=s,this.#u=i,this.#s=n,this.#a=r,[t,e]=this.#d(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e],this.#i=[{line:a,points:this.#r}],this.#t.set(a,0)}updateProperty(t,e){t==="stroke-width"&&(this.#a=e)}#d(t,e){return H._normalizePoint(t,e,this.#l,this.#u,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#r.length<=10}add(t,e){[t,e]=this.#d(t,e);const[s,i,n,r]=this.#t.subarray(2,6),a=t-n,l=e-r;return Math.hypot(this.#l*a,this.#u*l)<=2?null:(this.#r.push(t,e),isNaN(s)?(this.#t.set([n,r,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,i,n,r,t,e],0),this.#e.push(...H.createBezierPoints(s,i,n,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,n){this.#l=s,this.#u=i,this.#s=n,[t,e]=this.#d(t,e);const r=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e];const a=this.#i.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#i.push({line:r,points:this.#r}),this.#t.set(r,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(t){return this.#i?(this.#i.push(t),this.#e=t.line,this.#r=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#h.setLastElement(t)}removeLastElement(){if(!this.#i)return this.#h.removeLastElement();this.#i.pop(),this.#n="";for(let t=0,e=this.#i.length;t<e;t++){const{line:s,points:i}=this.#i[t];this.#e=s,this.#r=i,this.#o=0,this.toSVGPath()}return{path:{d:this.#n}}}toSVGPath(){const t=H.svgRound(this.#e[4]),e=H.svgRound(this.#e[5]);if(this.#r.length===2)return this.#n=`${this.#n} M ${t} ${e} Z`,this.#n;if(this.#r.length<=6){const i=this.#n.lastIndexOf("M");this.#n=`${this.#n.slice(0,i)} M ${t} ${e}`,this.#o=6}if(this.#r.length===4){const i=H.svgRound(this.#e[10]),n=H.svgRound(this.#e[11]);return this.#n=`${this.#n} L ${i} ${n}`,this.#o=12,this.#n}const s=[];this.#o===0&&(s.push(`M ${t} ${e}`),this.#o=6);for(let i=this.#o,n=this.#e.length;i<n;i+=6){const[r,a,l,h,c,d]=this.#e.slice(i,i+6).map(H.svgRound);s.push(`C${r} ${a} ${l} ${h} ${c} ${d}`)}return this.#n+=s.join(" "),this.#o=this.#e.length,this.#n}getOutlines(t,e,s,i){const n=this.#i.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#h.build(this.#i,t,e,s,this.#s,this.#a,i),this.#t=null,this.#e=null,this.#i=null,this.#n=null,this.#h}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class nn extends H{#t;#e=0;#i;#s;#a;#r;#n;#o;#h;build(t,e,s,i,n,r,a){this.#a=e,this.#r=s,this.#n=i,this.#o=n,this.#h=r,this.#i=a??0,this.#s=t,this.#d()}get thickness(){return this.#h}setLastElement(t){return this.#s.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#s){if(t.push(`M${H.svgRound(e[4])} ${H.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${H.svgRound(e[10])} ${H.svgRound(e[11])}`);continue}for(let s=6,i=e.length;s<i;s+=6){const[n,r,a,l,h,c]=e.subarray(s,s+6).map(H.svgRound);t.push(`C${n} ${r} ${a} ${l} ${h} ${c}`)}}return t.join("")}serialize([t,e,s,i],n){const r=[],a=[],[l,h,c,d]=this.#u();let u,f,p,g,b,v,w,y,_;switch(this.#o){case 0:_=H._rescale,u=t,f=e+i,p=s,g=-i,b=t+l*s,v=e+(1-h-d)*i,w=t+(l+c)*s,y=e+(1-h)*i;break;case 90:_=H._rescaleAndSwap,u=t,f=e,p=s,g=i,b=t+h*s,v=e+l*i,w=t+(h+d)*s,y=e+(l+c)*i;break;case 180:_=H._rescale,u=t+s,f=e,p=-s,g=i,b=t+(1-l-c)*s,v=e+h*i,w=t+(1-l)*s,y=e+(h+d)*i;break;case 270:_=H._rescaleAndSwap,u=t+s,f=e+i,p=-s,g=-i,b=t+(1-h-d)*s,v=e+(1-l-c)*i,w=t+(1-h)*s,y=e+(1-l)*i;break}for(const{line:A,points:S}of this.#s)r.push(_(A,u,f,p,g,n?new Array(A.length):null)),a.push(_(S,u,f,p,g,n?new Array(S.length):null));return{lines:r,points:a,rect:[b,v,w,y]}}static deserialize(t,e,s,i,n,{paths:{lines:r,points:a},rotation:l,thickness:h}){const c=[];let d,u,f,p,g;switch(l){case 0:g=H._rescale,d=-t/s,u=e/i+1,f=1/s,p=-1/i;break;case 90:g=H._rescaleAndSwap,d=-e/i,u=-t/s,f=1/i,p=1/s;break;case 180:g=H._rescale,d=t/s+1,u=-e/i,f=-1/s,p=1/i;break;case 270:g=H._rescaleAndSwap,d=e/i+1,u=t/s+1,f=-1/i,p=-1/s;break}if(!r){r=[];for(const v of a){const w=v.length;if(w===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,v[0],v[1]]));continue}if(w===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,v[0],v[1],NaN,NaN,NaN,NaN,v[2],v[3]]));continue}const y=new Float32Array(3*(w-2));r.push(y);let[_,A,S,E]=v.subarray(0,4);y.set([NaN,NaN,NaN,NaN,_,A],0);for(let T=4;T<w;T+=2){const C=v[T],D=v[T+1];y.set(H.createBezierPoints(_,A,S,E,C,D),(T-2)*3),[_,A,S,E]=[S,E,C,D]}}}for(let v=0,w=r.length;v<w;v++)c.push({line:g(r[v].map(y=>y??NaN),d,u,f,p),points:g(a[v].map(y=>y??NaN),d,u,f,p)});const b=new this.prototype.constructor;return b.build(c,s,i,1,l,h,n),b}#l(t=this.#h){const e=this.#i+t/2*this.#n;return this.#o%180===0?[e/this.#a,e/this.#r]:[e/this.#r,e/this.#a]}#u(){const[t,e,s,i]=this.#t,[n,r]=this.#l(0);return[t+n,e+r,s-2*n,i-2*r]}#d(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#s){if(i.length<=12){for(let a=4,l=i.length;a<l;a+=6)F.pointBoundingBox(i[a],i[a+1],t);continue}let n=i[4],r=i[5];for(let a=6,l=i.length;a<l;a+=6){const[h,c,d,u,f,p]=i.subarray(a,a+6);F.bezierBoundingBox(n,r,h,c,d,u,f,p,t),n=f,r=p}}const[e,s]=this.#l();t[0]=ie(t[0]-e,0,1),t[1]=ie(t[1]-s,0,1),t[2]=ie(t[2]+e,0,1),t[3]=ie(t[3]+s,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,s]=this.#l();this.#h=t;const[i,n]=this.#l(),[r,a]=[i-e,n-s],l=this.#t;return l[0]-=r,l[1]-=a,l[2]+=2*r,l[3]+=2*a,l}updateParentDimensions([t,e],s){const[i,n]=this.#l();this.#a=t,this.#r=e,this.#n=s;const[r,a]=this.#l(),l=r-i,h=a-n,c=this.#t;return c[0]-=l,c[1]-=h,c[2]+=2*l,c[3]+=2*h,c}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(H.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let s=0,i=0,n=0,r=0,a=0,l=0;switch(this.#e){case 90:i=e/t,n=-t/e,a=t;break;case 180:s=-1,r=-1,a=t,l=e;break;case 270:i=-e/t,n=t/e,l=e;break;default:return""}return`matrix(${s} ${i} ${n} ${r} ${H.svgRound(a)} ${H.svgRound(l)})`}getPathResizingSVGProperties([t,e,s,i]){const[n,r]=this.#l(),[a,l,h,c]=this.#t;if(Math.abs(h-n)<=H.PRECISION||Math.abs(c-r)<=H.PRECISION){const g=t+s/2-(a+h/2),b=e+i/2-(l+c/2);return{path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(e)}`,transform:`${this.rotationTransform} translate(${g} ${b})`}}}const d=(s-2*n)/(h-2*n),u=(i-2*r)/(c-2*r),f=h/s,p=c/i;return{path:{"transform-origin":`${H.svgRound(a)} ${H.svgRound(l)}`,transform:`${this.rotationTransform} scale(${f} ${p}) translate(${H.svgRound(n)} ${H.svgRound(r)}) scale(${d} ${u}) translate(${H.svgRound(-n)} ${H.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,s,i]){const[n,r]=this.#l(),a=this.#t,[l,h,c,d]=a;if(a[0]=t,a[1]=e,a[2]=s,a[3]=i,Math.abs(c-n)<=H.PRECISION||Math.abs(d-r)<=H.PRECISION){const b=t+s/2-(l+c/2),v=e+i/2-(h+d/2);for(const{line:w,points:y}of this.#s)H._translate(w,b,v,w),H._translate(y,b,v,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const u=(s-2*n)/(c-2*n),f=(i-2*r)/(d-2*r),p=-u*(l+n)+t+n,g=-f*(h+r)+e+r;if(u!==1||f!==1||p!==0||g!==0)for(const{line:b,points:v}of this.#s)H._rescale(b,p,g,u,f,b),H._rescale(v,p,g,u,f,v);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[i,n]=s,r=this.#t,a=t-r[0],l=e-r[1];if(this.#a===i&&this.#r===n)for(const{line:h,points:c}of this.#s)H._translate(h,a,l,h),H._translate(c,a,l,c);else{const h=this.#a/i,c=this.#r/n;this.#a=i,this.#r=n;for(const{line:d,points:u}of this.#s)H._rescale(d,a,l,h,c,d),H._rescale(u,a,l,h,c,u);r[2]*=h,r[3]*=c}return r[0]=t,r[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t)} ${H.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t[0])} ${H.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class $n extends Ul{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:W._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new $n(this._viewParameters);return t.updateAll(this),t}}class sa extends gt{static _type="ink";static _editorType=Y.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){W.initialize(t,e),this._defaultDrawingOptions=new $n(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return X(this,"typesMap",new Map([[nt.INK_THICKNESS,"stroke-width"],[nt.INK_COLOR,"stroke"],[nt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,i,n){return new Su(t,e,s,i,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,i,n,r){return nn.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){let i=null;if(t instanceof ea){const{data:{inkLists:r,rect:a,rotation:l,id:h,color:c,opacity:d,borderStyle:{rawWidth:u},popupRef:f,richText:p,contentsObj:g,creationDate:b,modificationDate:v},parent:{page:{pageNumber:w}}}=t;i=t={annotationType:Y.INK,color:Array.from(c),thickness:u,opacity:d,paths:{points:r},boxes:null,pageIndex:w-1,rect:a.slice(0),rotation:l,annotationElementId:h,id:h,deleted:!1,popupRef:f,richText:p,comment:g?.str||null,creationDate:b,modificationDate:v}}const n=await super.deserialize(t,e,s);return n._initialData=i,t.comment&&n.setCommentData(t),n}get toolbarButtons(){return this._colorPicker||=new Wi(this),[["colorPicker",this._colorPicker]]}get colorType(){return nt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=sa.getDefaultDrawingOptions({stroke:F.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{stroke:i,"stroke-opacity":n,"stroke-width":r}}=this,a=Object.assign(super.serialize(t),{color:W._colorManager.convert(i),opacity:n,thickness:r,paths:{lines:e,points:s}});return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#t(a)?null:(a.id=this.annotationElementId,a)}#t(t){const{color:e,thickness:s,opacity:i,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((r,a)=>r!==e[a])||t.thickness!==s||t.opacity!==i||t.pageIndex!==n}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class Er extends nn{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const bn=8,Mi=3;class Ms{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,s,i){return s-=t,i-=e,s===0?i>0?0:4:s===1?i+6:2-i}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#s(t,e,s,i,n,r,a){const l=this.#e(s,i,n,r);for(let h=0;h<8;h++){const c=(-h+l-a+16)%8,d=this.#i[2*c],u=this.#i[2*c+1];if(t[(s+d)*e+(i+u)]!==0)return c}return-1}static#a(t,e,s,i,n,r,a){const l=this.#e(s,i,n,r);for(let h=0;h<8;h++){const c=(h+l+a+16)%8,d=this.#i[2*c],u=this.#i[2*c+1];if(t[(s+d)*e+(i+u)]!==0)return c}return-1}static#r(t,e,s,i){const n=t.length,r=new Int32Array(n);for(let c=0;c<n;c++)r[c]=t[c]<=i?1:0;for(let c=1;c<s-1;c++)r[c*e]=r[c*e+e-1]=0;for(let c=0;c<e;c++)r[c]=r[e*s-1-c]=0;let a=1,l;const h=[];for(let c=1;c<s-1;c++){l=1;for(let d=1;d<e-1;d++){const u=c*e+d,f=r[u];if(f===0)continue;let p=c,g=d;if(f===1&&r[u-1]===0)a+=1,g-=1;else if(f>=1&&r[u+1]===0)a+=1,g+=1,f>1&&(l=f);else{f!==1&&(l=Math.abs(f));continue}const b=[d,c],v=g===d+1,w={isHole:v,points:b,id:a,parent:0};h.push(w);let y;for(const R of h)if(R.id===l){y=R;break}y?y.isHole?w.parent=v?y.parent:l:w.parent=v?l:y.parent:w.parent=v?l:0;const _=this.#s(r,e,c,d,p,g,0);if(_===-1){r[u]=-a,r[u]!==1&&(l=Math.abs(r[u]));continue}let A=this.#i[2*_],S=this.#i[2*_+1];const E=c+A,T=d+S;p=E,g=T;let C=c,D=d;for(;;){const R=this.#a(r,e,C,D,p,g,1);A=this.#i[2*R],S=this.#i[2*R+1];const I=C+A,z=D+S;b.push(z,I);const U=C*e+D;if(r[U+1]===0?r[U]=-a:r[U]===1&&(r[U]=a),I===c&&z===d&&C===E&&D===T){r[u]!==1&&(l=Math.abs(r[u]));break}else p=C,g=D,C=I,D=z}}}return h}static#n(t,e,s,i){if(s-e<=4){for(let E=e;E<s-2;E+=2)i.push(t[E],t[E+1]);return}const n=t[e],r=t[e+1],a=t[s-4]-n,l=t[s-3]-r,h=Math.hypot(a,l),c=a/h,d=l/h,u=c*r-d*n,f=l/a,p=1/h,g=Math.atan(f),b=Math.cos(g),v=Math.sin(g),w=p*(Math.abs(b)+Math.abs(v)),y=p*(1-w+w**2),_=Math.max(Math.atan(Math.abs(v+b)*y),Math.atan(Math.abs(v-b)*y));let A=0,S=e;for(let E=e+2;E<s-2;E+=2){const T=Math.abs(u-c*t[E+1]+d*t[E]);T>A&&(S=E,A=T)}A>(h*_)**2?(this.#n(t,e,S+2,i),this.#n(t,S,s,i)):i.push(n,r)}static#o(t){const e=[],s=t.length;return this.#n(t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e}static#h(t,e,s,i,n,r){const a=new Float32Array(r**2),l=-2*i**2,h=r>>1;for(let g=0;g<r;g++){const b=(g-h)**2;for(let v=0;v<r;v++)a[g*r+v]=Math.exp((b+(v-h)**2)/l)}const c=new Float32Array(256),d=-2*n**2;for(let g=0;g<256;g++)c[g]=Math.exp(g**2/d);const u=t.length,f=new Uint8Array(u),p=new Uint32Array(256);for(let g=0;g<s;g++)for(let b=0;b<e;b++){const v=g*e+b,w=t[v];let y=0,_=0;for(let S=0;S<r;S++){const E=g+S-h;if(!(E<0||E>=s))for(let T=0;T<r;T++){const C=b+T-h;if(C<0||C>=e)continue;const D=t[E*e+C],R=a[S*r+T]*c[Math.abs(D-w)];y+=D*R,_+=R}}const A=f[v]=Math.round(y/_);p[A]++}return[f,p]}static#l(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e}static#u(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let i=-1/0,n=1/0;for(let a=0,l=s.length;a<l;a++){const h=s[a]=t[a<<2];i=Math.max(i,h),n=Math.min(n,h)}const r=255/(i-n);for(let a=0,l=s.length;a<l;a++)s[a]=(s[a]-n)*r;return s}static#d(t){let e,s=-1/0,i=-1/0;const n=t.findIndex(l=>l!==0);let r=n,a=n;for(e=n;e<256;e++){const l=t[e];l>s&&(e-r>i&&(i=e-r,a=e-1),s=l,r=e)}for(e=a-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:s,height:i}=t,{maxDim:n}=this.#t;let r=s,a=i;if(s>n||i>n){let u=s,f=i,p=Math.log2(Math.max(s,i)/n);const g=Math.floor(p);p=p===g?g-1:g;for(let v=0;v<p;v++){r=Math.ceil(u/2),a=Math.ceil(f/2);const w=new OffscreenCanvas(r,a);w.getContext("2d").drawImage(t,0,0,u,f,0,0,r,a),u=r,f=a,t!==e&&t.close(),t=w.transferToImageBitmap()}const b=Math.min(n/r,n/a);r=Math.round(r*b),a=Math.round(a*b)}const h=new OffscreenCanvas(r,a).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,r,a),h.filter="grayscale(1)",h.drawImage(t,0,0,t.width,t.height,0,0,r,a);const c=h.getImageData(0,0,r,a).data;return[this.#u(c),r,a]}static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:i},n,r,a,l){let h=new OffscreenCanvas(1,1),c=h.getContext("2d",{alpha:!1});const d=200,u=c.font=`${s} ${i} ${d}px ${e}`,{actualBoundingBoxLeft:f,actualBoundingBoxRight:p,actualBoundingBoxAscent:g,actualBoundingBoxDescent:b,fontBoundingBoxAscent:v,fontBoundingBoxDescent:w,width:y}=c.measureText(t),_=1.5,A=Math.ceil(Math.max(Math.abs(f)+Math.abs(p)||0,y)*_),S=Math.ceil(Math.max(Math.abs(g)+Math.abs(b)||d,Math.abs(v)+Math.abs(w)||d)*_);h=new OffscreenCanvas(A,S),c=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=u,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,A,S),c.fillStyle="black",c.fillText(t,A*(_-1)/2,S*(3-_)/2);const E=this.#u(c.getImageData(0,0,A,S).data),T=this.#l(E),C=this.#d(T),D=this.#r(E,A,S,C);return this.processDrawnLines({lines:{curves:D,width:A,height:S},pageWidth:n,pageHeight:r,rotation:a,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(t,e,s,i,n){const[r,a,l]=this.#f(t),[h,c]=this.#h(r,a,l,Math.hypot(a,l)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),d=this.#d(c),u=this.#r(h,a,l,d);return this.processDrawnLines({lines:{curves:u,width:a,height:l},pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:r,areContours:a}){i%180!==0&&([e,s]=[s,e]);const{curves:l,width:h,height:c}=t,d=t.thickness??0,u=[],f=Math.min(e/h,s/c),p=f/e,g=f/s,b=[];for(const{points:w}of l){const y=r?this.#o(w):w;if(!y)continue;b.push(y);const _=y.length,A=new Float32Array(_),S=new Float32Array(3*(_===2?2:_-2));if(u.push({line:S,points:A}),_===2){A[0]=y[0]*p,A[1]=y[1]*g,S.set([NaN,NaN,NaN,NaN,A[0],A[1]],0);continue}let[E,T,C,D]=y;E*=p,T*=g,C*=p,D*=g,A.set([E,T,C,D],0),S.set([NaN,NaN,NaN,NaN,E,T],0);for(let R=4;R<_;R+=2){const I=A[R]=y[R]*p,z=A[R+1]=y[R+1]*g;S.set(H.createBezierPoints(E,T,C,D,I,z),(R-2)*3),[E,T,C,D]=[C,D,I,z]}}if(u.length===0)return null;const v=a?new Er:new nn;return v.build(u,e,s,1,i,a?0:d,n),{outline:v,newCurves:b,areContours:a,thickness:d,width:h,height:c}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:i,height:n}){let r=1/0,a=-1/0,l=0;for(const y of t){l+=y.length;for(let _=2,A=y.length;_<A;_++){const S=y[_]-y[_-2];r=Math.min(r,S),a=Math.max(a,S)}}let h;r>=-128&&a<=127?h=Int8Array:r>=-32768&&a<=32767?h=Int16Array:h=Int32Array;const c=t.length,d=bn+Mi*c,u=new Uint32Array(d);let f=0;u[f++]=d*Uint32Array.BYTES_PER_ELEMENT+(l-2*c)*h.BYTES_PER_ELEMENT,u[f++]=0,u[f++]=i,u[f++]=n,u[f++]=e?0:1,u[f++]=Math.max(0,Math.floor(s??0)),u[f++]=c,u[f++]=h.BYTES_PER_ELEMENT;for(const y of t)u[f++]=y.length-2,u[f++]=y[0],u[f++]=y[1];const p=new CompressionStream("deflate-raw"),g=p.writable.getWriter();await g.ready,g.write(u);const b=h.prototype.constructor;for(const y of t){const _=new b(y.length-2);for(let A=2,S=y.length;A<S;A++)_[A-2]=y[A]-y[A-2];g.write(_)}g.close();const v=await new Response(p.readable).arrayBuffer(),w=new Uint8Array(v);return al(w)}static async decompressSignature(t){try{const e=qc(t),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,a=0;for await(const y of s)r||=new Uint8Array(new Uint32Array(y.buffer,0,4)[0]),r.set(y,a),a+=y.length;const l=new Uint32Array(r.buffer,0,r.length>>2),h=l[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const c=l[2],d=l[3],u=l[4]===0,f=l[5],p=l[6],g=l[7],b=[],v=(bn+Mi*p)*Uint32Array.BYTES_PER_ELEMENT;let w;switch(g){case Int8Array.BYTES_PER_ELEMENT:w=new Int8Array(r.buffer,v);break;case Int16Array.BYTES_PER_ELEMENT:w=new Int16Array(r.buffer,v);break;case Int32Array.BYTES_PER_ELEMENT:w=new Int32Array(r.buffer,v);break}a=0;for(let y=0;y<p;y++){const _=l[Mi*y+bn],A=new Float32Array(_+2);b.push(A);for(let S=0;S<Mi-1;S++)A[S]=l[Mi*y+bn+S+1];for(let S=0;S<_;S++)A[S+2]=A[S]+w[a++]}return{areContours:u,thickness:f,outlines:b,width:c,height:d}}catch(e){return K(`decompressSignature: ${e}`),null}}}class ia extends Ul{constructor(){super(),super.updateProperties({fill:W._defaultLineColor,"stroke-width":0})}clone(){const t=new ia;return t.updateAll(this),t}}class na extends $n{constructor(t){super(t),super.updateProperties({stroke:W._defaultLineColor,"stroke-width":1})}clone(){const t=new na(this._viewParameters);return t.updateAll(this),t}}class Ge extends gt{#t=!1;#e=null;#i=null;#s=null;static _type="signature";static _editorType=Y.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){W.initialize(t,e),this._defaultDrawingOptions=new ia,this._defaultDrawnSignatureOptions=new na(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return X(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:i,mustSmooth:n,areContours:r,description:a,uuid:l,heightInPage:h}=this.#i,{rawDims:{pageWidth:c,pageHeight:d},rotation:u}=this.parent.viewport,f=Ms.processDrawnLines({lines:i,pageWidth:c,pageHeight:d,rotation:u,innerMargin:Ge._INNER_MARGIN,mustSmooth:n,areContours:r});this.addSignature(f,h,a,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#s=t,this.addEditToolbar()}getUuid(){return this.#s}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:s,width:i,height:n}=this.#i,r=Math.max(i,n),a=Ms.processDrawnLines({lines:{curves:t.map(l=>({points:l})),thickness:s,width:i,height:n},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,s,i){const{x:n,y:r}=this,{outline:a}=this.#i=t;this.#t=a instanceof Er,this.description=s;let l;this.#t?l=Ge.getDefaultDrawingOptions():(l=Ge._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:l});const[,h]=this.pageDimensions;let c=e/h;c=c>=1?.5:c,this.width*=c/this.height,this.width>=1&&(c*=.9/this.width,this.width=.9),this.height=c,this.setDims(),this.x=n,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return Ms.process(t,e,s,i,Ge._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return Ms.extractContoursFromText(t,e,s,i,n,Ge._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return Ms.processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:Ge._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Ge.getDefaultDrawingOptions():(this._drawingOptions=Ge._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":i}}=this,n=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:i});return this.addComment(n),t?(n.paths={lines:e,points:s},n.uuid=this.#s,n.isCopy=!0):n.lines=e,this.#e&&(n.accessibilityData={type:"Figure",alt:this.#e}),n}static deserializeDraw(t,e,s,i,n,r){return r.areContours?Er.deserialize(t,e,s,i,n,r):nn.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){const i=await super.deserialize(t,e,s);return i.#t=t.areContours,i.description=t.accessibilityData?.alt||"",i.#s=t.uuid,i}}class Eu extends W{#t=null;#e=null;#i=null;#s=null;#a=null;#r="";#n=null;#o=!1;#h=null;#l=!1;#u=!1;static _type="stamp";static _editorType=Y.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#s=t.bitmapUrl,this.#a=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){W.initialize(t,e)}static isHandlingMimeForPasting(t){return kn.includes(t)}static paste(t,e){e.pasteEditor({mode:Y.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#d(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#r=t.file.name),this.#p()}#f(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#n){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:n,height:r}=t||this.copyCanvas(null,null,!0).imageData,a=await s.guess({name:"altText",request:{data:i,width:n,height:r,channels:i.length/(n*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const l=a.output;return await this.setGuessedAltText(l),e&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#d(s,!0)).finally(()=>this.#f());return}if(this.#s){const s=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(s).then(i=>this.#d(i)).finally(()=>this.#f());return}if(this.#a){const s=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(s).then(i=>this.#d(i)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=kn.join(",");const e=this._uiManager._signal;this.#i=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(i)}s()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#n?.remove(),this.#n=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#n===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#a||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#p():this.#m()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:s,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(this.#e=s,i&&(this.#t=i),this.#o=!1,this.#p())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#h!==null&&clearTimeout(this.#h);const t=200;this.#h=setTimeout(()=>{this.#h=null,this.#g()},t)}#p(){const{div:t}=this;let{width:e,height:s}=this.#t;const[i,n]=this.pageDimensions,r=.75;if(this.width)e=this.width*i,s=this.height*n;else if(e>r*i||s>r*n){const l=Math.min(r*i/e,r*n/s);e*=l,s*=l}this._uiManager.enableWaiting(!1);const a=this.#n=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=e/i,this.height=s/n,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#g(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,s=!1){t||(t=224);const{width:i,height:n}=this.#t,r=new ze;let a=this.#t,l=i,h=n,c=null;if(e){if(i>e||n>e){const S=Math.min(e/i,e/n);l=Math.floor(i*S),h=Math.floor(n*S)}c=document.createElement("canvas");const u=c.width=Math.ceil(l*r.sx),f=c.height=Math.ceil(h*r.sy);this.#l||(a=this.#c(u,f));const p=c.getContext("2d");p.filter=this._uiManager.hcmFilter;let g="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":Kc.isDarkMode&&(g="#8f8f9d",b="#42414d");const v=15,w=v*r.sx,y=v*r.sy,_=new OffscreenCanvas(w*2,y*2),A=_.getContext("2d");A.fillStyle=g,A.fillRect(0,0,w*2,y*2),A.fillStyle=b,A.fillRect(0,0,w,y),A.fillRect(w,y,w,y),p.fillStyle=p.createPattern(_,"repeat"),p.fillRect(0,0,u,f),p.drawImage(a,0,0,a.width,a.height,0,0,u,f)}let d=null;if(s){let u,f;if(r.symmetric&&a.width<t&&a.height<t)u=a.width,f=a.height;else if(a=this.#t,i>t||n>t){const b=Math.min(t/i,t/n);u=Math.floor(i*b),f=Math.floor(n*b),this.#l||(a=this.#c(u,f))}const g=new OffscreenCanvas(u,f).getContext("2d",{willReadFrequently:!0});g.drawImage(a,0,0,a.width,a.height,0,0,u,f),d={width:u,height:f,data:g.getImageData(0,0,u,f).data}}return{canvas:c,width:l,height:h,imageData:d}}#c(t,e){const{width:s,height:i}=this.#t;let n=s,r=i,a=this.#t;for(;n>2*t||r>2*e;){const l=n,h=r;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const c=new OffscreenCanvas(n,r);c.getContext("2d").drawImage(a,0,0,l,h,0,0,n,r),a=c.transferToImageBitmap()}return a}#g(){const[t,e]=this.parentDimensions,{width:s,height:i}=this,n=new ze,r=Math.ceil(s*t*n.sx),a=Math.ceil(i*e*n.sy),l=this.#n;if(!l||l.width===r&&l.height===a)return;l.width=r,l.height=a;const h=this.#l?this.#t:this.#c(r,a),c=l.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(h,0,0,h.width,h.height,0,0,r,a)}#b(t){if(t){if(this.#l){const i=this._uiManager.imageManager.getSvgUrl(this.#e);if(i)return i}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,s]=this.pageDimensions,i=Math.round(this.width*e*Ws.PDF_TO_CSS_UNITS),n=Math.round(this.height*s*Ws.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(i,n);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,i,n),r.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,s){let i=null,n=!1;if(t instanceof Nl){const{data:{rect:g,rotation:b,id:v,structParent:w,popupRef:y,richText:_,contentsObj:A,creationDate:S,modificationDate:E},container:T,parent:{page:{pageNumber:C}},canvas:D}=t;let R,I;D?(delete t.canvas,{id:R,bitmap:I}=s.imageManager.getFromCanvas(T.id,D),D.remove()):(n=!0,t._hasNoCanvas=!0);const z=(await e._structTree.getAriaAttributes(`${ii}${v}`))?.get("aria-label")||"";i=t={annotationType:Y.STAMP,bitmapId:R,bitmap:I,pageIndex:C-1,rect:g.slice(0),rotation:b,annotationElementId:v,id:v,deleted:!1,accessibilityData:{decorative:!1,altText:z},isSvg:!1,structParent:w,popupRef:y,richText:_,comment:A?.str||null,creationDate:S,modificationDate:E}}const r=await super.deserialize(t,e,s),{rect:a,bitmap:l,bitmapUrl:h,bitmapId:c,isSvg:d,accessibilityData:u}=t;n?(s.addMissingCanvas(t.id,r),r.#o=!0):c&&s.imageManager.isValidId(c)?(r.#e=c,l&&(r.#t=l)):r.#s=h,r.#l=d;const[f,p]=r.pageDimensions;return r.width=(a[2]-a[0])/f,r.height=(a[3]-a[1])/p,u&&(r.altTextData=u),r._initialData=i,t.comment&&r.setCommentData(t),r.#u=!!i,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(s),t)return s.bitmapUrl=this.#b(!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:i,altText:n}=this.serializeAltText(!1);if(!i&&n&&(s.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){const a=this.#w(s);return a.isSame?null:(a.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(e===null)return s;e.stamps||=new Map;const r=this.#l?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:r,serialized:s}),s.bitmap=this.#b(!1);else if(this.#l){const a=e.stamps.get(this.#e);r>a.area&&(a.area=r,a.serialized.bitmap.close(),a.serialized.bitmap=this.#b(!1))}return s}#w(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,i=t.pageIndex===e,n=(t.accessibilityData?.alt||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&n,isSameAltText:n}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Xe{#t;#e=!1;#i=null;#s=null;#a=null;#r=new Map;#n=!1;#o=!1;#h=!1;#l=null;#u=null;#d=null;#f=null;#m=null;#p=-1;#c;static _initialized=!1;static#g=new Map([Gt,sa,Eu,Ot,Ge].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:r,drawLayer:a,textLayer:l,viewport:h,l10n:c}){const d=[...Xe.#g.values()];if(!Xe._initialized){Xe._initialized=!0;for(const u of d)u.initialize(c,t)}t.registerEditorTypes(d),this.#c=t,this.pageIndex=e,this.div=s,this.#t=n,this.#i=r,this.viewport=h,this.#d=l,this.drawLayer=a,this._structTree=i,this.#c.addLayer(this)}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#c.getMode()===Y.NONE}updateToolbar(t){this.#c.updateToolbar(t)}updateMode(t=this.#c.getMode()){switch(this.#y(),t){case Y.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Y.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Y.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===Y.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const s of Xe.#g.values())e.toggle(`${s._type}Editing`,t===s._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#d?.div}setEditingState(t){this.#c.setEditingState(t)}addCommands(t){this.#c.addCommands(t)}cleanUndoStack(t){this.#c.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.togglePointerEvents(t)}get#b(){return this.#r.size!==0?this.#r.values():this.#c.getEditors(this.pageIndex)}async enable(){this.#h=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const t=new Set;for(const s of this.#b)s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#c.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));const e=this.#i;if(e)for(const s of e.getEditableAnnotations()){if(s.hide(),this.#c.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}this.#h=!1,this.#c._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#d&&!this.#m){this.#m=new AbortController;const i=this.#c.combinedSignal(this.#m);this.#d.div.addEventListener("pointerdown",n=>{const{clientX:a,clientY:l,timeStamp:h}=n,c=this.#p;if(h-c>500){this.#p=h;return}this.#p=-1;const{classList:d}=this.div;d.toggle("getElements",!0);const u=document.elementsFromPoint(a,l);if(d.toggle("getElements",!1),!this.div.contains(u[0]))return;let f;const p=new RegExp(`^${zi}[0-9]+$`);for(const b of u)if(p.test(b.id)){f=b.id;break}if(!f)return;const g=this.#r.get(f);g?.annotationElementId===null&&(n.stopPropagation(),n.preventDefault(),g.dblclick(n))},{signal:i,capture:!0})}const t=this.#i,e=[];if(t){const i=new Map,n=new Map;for(const a of this.#b){if(a.disableEditing(),!a.annotationElementId){e.push(a);continue}if(a.serialize()!==null){i.set(a.annotationElementId,a);continue}else n.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}const r=t.getEditableAnnotations();for(const a of r){const{id:l}=a.data;if(this.#c.isDeletedAnnotationElement(l)){a.updateEdited({deleted:!0});continue}let h=n.get(l);if(h){h.resetAnnotationElement(a),h.show(!1),a.show();continue}h=i.get(l),h&&(this.#c.addChangedExistingAnnotation(h),h.renderAnnotationElement(a)&&h.show(!1)),a.show()}}this.#y(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of Xe.#g.values())s.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t?.updateFakeAnnotations(e),this.#o=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#c.getActive()!==t&&this.#c.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;const t=this.#c.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#w.bind(this),{signal:t}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#w(t){this.#c.unselectAll();const{target:e}=t;if(e===this.#d.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#d.div.contains(e)){const{isMac:s}=Ut.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#c.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),Ot.startHighlighting(this,this.#c.direction==="ltr",{target:this.#d.div,x:t.x,y:t.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#c._signal}),t.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;const t=this.#c.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#s?.abort(),this.#s=null}attach(t){this.#r.set(t.id,t);const{annotationElementId:e}=t;e&&this.#c.isDeletedAnnotationElement(e)&&this.#c.removeDeletedAnnotationElement(t)}detach(t){this.#r.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#c.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#c.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#c.addDeletedAnnotationElement(t),W.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#c.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#h),this.#c.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#c._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getEditorByUID(t){for(const e of this.#r.values())if(e.uid===t)return e;return null}getNextId(){return this.#c.getId()}get#v(){return Xe.#g.get(this.#c.getMode())}combinedSignal(t){return this.#c.combinedSignal(t)}#E(t){const e=this.#v;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#v?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#c.updateMode(t.mode);const{offsetX:s,offsetY:i}=this.#S(),n=this.getNextId(),r=this.#E({parent:this,id:n,x:s,y:i,uiManager:this.#c,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await Xe.#g.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#c)||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),n=this.#E({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#c,isCentered:e,...s});return n&&this.add(n),n}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:s,height:i}=this.boundingClientRect,n=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+s),l=Math.min(window.innerHeight,e+i),h=(n+a)/2-t,c=(r+l)/2-e,[d,u]=this.viewport.rotation%180===0?[h,c]:[c,h];return{offsetX:d,offsetY:u}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#c.setSelected(t)}toggleSelected(t){this.#c.toggleSelected(t)}unselect(t){this.#c.unselect(t)}pointerup(t){const{isMac:e}=Ut.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#n||(this.#n=!1,this.#v?.isDrawer&&this.#v.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const s=this.#c.getMode();if(s===Y.STAMP||s===Y.SIGNATURE){this.#c.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#c.getMode()===Y.HIGHLIGHT&&this.enableTextSelection(),this.#n){this.#n=!1;return}const{isMac:e}=Ut.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#n=!0,this.#v?.isDrawer){this.startDrawingSession(t);return}const s=this.#c.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#v.startDrawing(this,this.#c,!1,t);return}this.#c.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#c.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#u=null,this.commitOrRemove())},{signal:e}),this.#v.startDrawing(this,this.#c,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#u=e);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#l?(this.#c.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#u=null,this.#v.endDrawing(t)):null}findNewParent(t,e,s){const i=this.#c.findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#v.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#c.getActive()?.parent===this&&(this.#c.commitOrRemove(),this.#c.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#r.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#r.clear(),this.#c.removeLayer(this)}#y(){for(const t of this.#r.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Ss(this.div,t);for(const e of this.#c.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#c.commitOrRemove(),this.#y();const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,Ss(this.div,{rotation:s}),e!==s)for(const i of this.#r.values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#c.viewParameters.realScale}}class qt{#t=null;#e=new Map;#i=new Map;static#s=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return X(this,"_svgFactory",new Vi)}static#a(t,[e,s,i,n]){const{style:r}=t;r.top=`${100*s}%`,r.left=`${100*e}%`,r.width=`${100*i}%`,r.height=`${100*n}%`}#r(){const t=qt._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#n(t,e){const s=qt._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=qt._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),i}#o(t,e){for(const[s,i]of Object.entries(e))i===null?t.removeAttribute(s):t.setAttribute(s,i)}draw(t,e=!1,s=!1){const i=qt.#s++,n=this.#r(),r=qt._svgFactory.createElement("defs");n.append(r);const a=qt._svgFactory.createElement("path");r.append(a);const l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#i.set(i,a);const h=s?this.#n(r,l):null,c=qt._svgFactory.createElement("use");return n.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(n,t),this.#e.set(i,n),{id:i,clipPathId:`url(#${h})`}}drawOutline(t,e){const s=qt.#s++,i=this.#r(),n=qt._svgFactory.createElement("defs");i.append(n);const r=qt._svgFactory.createElement("path");n.append(r);const a=`path_p${this.pageIndex}_${s}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const d=qt._svgFactory.createElement("mask");n.append(d),l=`mask_p${this.pageIndex}_${s}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const u=qt._svgFactory.createElement("rect");d.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");const f=qt._svgFactory.createElement("use");d.append(f),f.setAttribute("href",`#${a}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const h=qt._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${a}`),l&&h.setAttribute("mask",`url(#${l})`);const c=h.cloneNode();return i.append(c),h.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,t),this.#e.set(s,i),s}finalizeDraw(t,e){this.#i.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:s,bbox:i,rootClass:n,path:r}=e,a=typeof t=="number"?this.#e.get(t):t;if(a){if(s&&this.#o(a,s),i&&qt.#a(a,i),n){const{classList:l}=a;for(const[h,c]of Object.entries(n))l.toggle(h,c)}if(r){const h=a.firstElementChild.firstElementChild;this.#o(h,r)}}}updateParent(t,e){if(e===this)return;const s=this.#e.get(t);s&&(e.#t.append(s),this.#e.delete(t),e.#e.set(t,s))}remove(t){this.#i.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Ar};globalThis.pdfjsLib={AbortException:cs,AnnotationEditorLayer:Xe,AnnotationEditorParamsType:nt,AnnotationEditorType:Y,AnnotationEditorUIManager:ds,AnnotationLayer:jn,AnnotationMode:as,AnnotationType:Ft,applyOpacity:dl,build:Dl,ColorPicker:Ce,createValidAbsoluteUrl:Ur,CSSConstants:cl,DOMSVGFactory:Vi,DrawLayer:qt,FeatureTest:Ut,fetchData:Ei,findContrastColor:ul,getDocument:Kr,getFilenameFromUrl:ol,getPdfFilenameFromUrl:ll,getRGB:xi,getUuid:zr,getXfaPageViewport:hl,GlobalWorkerOptions:zs,ImageKind:Bi,InvalidPDFException:Tn,isDataScheme:Zi,isPdfFile:Hn,isValidExplicitDest:vl,MathClamp:ie,noContextMenu:ke,normalizeUnicode:rl,OPS:vi,OutputScale:ze,PasswordResponses:il,PDFDataRangeTransport:Qr,PDFDateString:Pn,PDFWorker:bi,PermissionFlag:sl,PixelsPerInch:Ws,RenderingCancelledException:Un,renderRichText:$r,ResponseException:ji,setLayerDimensions:Ss,shadow:X,SignatureExtractor:Ms,stopEvent:Lt,SupportedImageMimeTypes:kn,TextLayer:we,TouchManager:en,updateUrlHash:Hr,Util:F,VerbosityLevel:Ki,version:Zr,XfaLayer:jr};const xu=Object.freeze(Object.defineProperty({__proto__:null,AbortException:cs,AnnotationEditorLayer:Xe,AnnotationEditorParamsType:nt,AnnotationEditorType:Y,AnnotationEditorUIManager:ds,AnnotationLayer:jn,AnnotationMode:as,AnnotationType:Ft,CSSConstants:cl,ColorPicker:Ce,DOMSVGFactory:Vi,DrawLayer:qt,FeatureTest:Ut,GlobalWorkerOptions:zs,ImageKind:Bi,InvalidPDFException:Tn,MathClamp:ie,OPS:vi,OutputScale:ze,PDFDataRangeTransport:Qr,PDFDateString:Pn,PDFWorker:bi,PasswordResponses:il,PermissionFlag:sl,PixelsPerInch:Ws,RenderingCancelledException:Un,ResponseException:ji,SignatureExtractor:Ms,SupportedImageMimeTypes:kn,TextLayer:we,TouchManager:en,Util:F,VerbosityLevel:Ki,XfaLayer:jr,applyOpacity:dl,build:Dl,createValidAbsoluteUrl:Ur,fetchData:Ei,findContrastColor:ul,getDocument:Kr,getFilenameFromUrl:ol,getPdfFilenameFromUrl:ll,getRGB:xi,getUuid:zr,getXfaPageViewport:hl,isDataScheme:Zi,isPdfFile:Hn,isValidExplicitDest:vl,noContextMenu:ke,normalizeUnicode:rl,renderRichText:$r,setLayerDimensions:Ss,shadow:X,stopEvent:Lt,updateUrlHash:Hr,version:Zr},Symbol.toStringTag,{value:"Module"}));zs.workerSrc=`https://unpkg.com/pdfjs-dist@${Zr}/build/pdf.worker.min.mjs`;async function Hl(o){const t=await o.arrayBuffer(),e=await Kr({data:t}).promise;let s="";const i=[];console.log(`📄 PDF Pages: ${e.numPages}`);for(let h=1;h<=e.numPages;h++){const u=(await(await e.getPage(h)).getTextContent()).items.filter(f=>"str"in f).map(f=>f.str).join(" ");i[h]=u,s+=u+" "}const n=xr(s);let r="";const a=[];for(let h=1;h<=e.numPages;h++){const c=xr(i[h]);a[h]=r.split(/\s+/).filter(u=>u.length>0).length,r+=c+" ";const d=c.split(/\s+/).filter(u=>u.length>0).length;(h<=5||h>e.numPages-2)&&console.log(`  Page ${h}: starts at word ${a[h]}, contains ${d} words`)}const l=n.split(/\s+/).filter(h=>h.length>0).length;return console.log(`✅ Total words extracted: ${l}`),console.log("📊 Page word counts:",a),{text:n,pageWordCounts:a}}async function Cu(o){return(await Hl(o)).text}async function Tu(o){const t=await Br(()=>Promise.resolve().then(()=>xu),[]);t.GlobalWorkerOptions.workerSrc=`https://unpkg.com/pdfjs-dist@${t.version}/build/pdf.worker.min.mjs`;const e=await o.arrayBuffer(),s=await t.getDocument({data:e}).promise;try{const i=await s.getOutline();if(!i||i.length===0)return[];const n=[];async function r(a,l=0){for(const h of a){if(h.dest)try{const c=typeof h.dest=="string"?await s.getDestination(h.dest):h.dest;if(c){const d=await s.getPageIndex(c[0]);n.push({name:h.title||`Chapter ${n.length+1}`,pageNum:d+1,level:l})}}catch(c){console.warn("Could not process outline item:",c)}h.items&&h.items.length>0&&await r(h.items,l+1)}}return await r(i),console.log(`📚 Extracted ${n.length} chapters from PDF outline:`,n.map(a=>({name:a.name,pageNum:a.pageNum}))),n}catch(i){return console.error("Error extracting PDF chapters:",i),[]}}async function Pu(o){const t=(await Br(async()=>{const{default:r}=await import("./index-CxsfLtQA.js");return{default:r}},[])).default,e=await o.arrayBuffer(),s=t(e);await s.ready,await s.loaded.spine;let i="";const n=s.spine?.spineItems||s.spine?.items||[];for(const r of n)try{const a=r.href||r.url;if(!a)continue;const l=await s.load(a);if(l){let h="";typeof l=="string"?h=new DOMParser().parseFromString(l,"text/html").body?.textContent||"":l.body?h=l.body.textContent||"":l.documentElement&&(h=l.documentElement.textContent||""),i+=h+" "}}catch(a){console.warn("Could not load section:",a)}return xr(i)}async function ku(o){const t=(await Br(async()=>{const{default:i}=await import("./index-CxsfLtQA.js");return{default:i}},[])).default,e=await o.arrayBuffer(),s=t(e);await s.ready,await s.loaded.navigation;try{let a=function(l,h=0){for(const c of l)r.push({name:c.label||c.title||`Chapter ${r.length+1}`,href:c.href,level:h}),c.subitems&&c.subitems.length>0&&a(c.subitems,h+1)};const n=s.navigation?.toc||[],r=[];return a(n),r}catch(i){return console.warn("Could not extract EPUB TOC:",i),[]}}function xr(o){return o.replace(/\s+/g," ").replace(/([.!?])\1+/g,"$1").trim()}async function Mu(o){const t=o.name.toLowerCase();if(t.endsWith(".pdf"))return Cu(o);if(t.endsWith(".epub"))return Pu(o);throw new Error(`Unsupported file type: ${t}`)}async function Ru(o){const t=o.name.toLowerCase();return t.endsWith(".pdf")?Tu(o):t.endsWith(".epub")?ku(o):[]}function uo(){return".pdf,.epub"}const rn="rsvp-reading-session";function Du(o){try{const t={text:o.text,currentWordIndex:o.currentWordIndex,totalWords:o.totalWords,settings:o.settings,chapters:o.chapters||[],savedAt:Date.now()};return localStorage.setItem(rn,JSON.stringify(t)),!0}catch(t){return console.error("Failed to save session:",t),!1}}function Lu(){try{const o=localStorage.getItem(rn);return o?JSON.parse(o):null}catch(o){return console.error("Failed to load session:",o),null}}function Iu(){try{return localStorage.getItem(rn)!==null}catch{return!1}}function fo(){try{return localStorage.removeItem(rn),!0}catch(o){return console.error("Failed to clear session:",o),!1}}function Fu(){try{const o=localStorage.getItem(rn);if(!o)return null;const t=JSON.parse(o);return{currentWordIndex:t.currentWordIndex,totalWords:t.totalWords,savedAt:t.savedAt,hasText:!!t.text}}catch{return null}}var Ou=G('&nbsp;<span class="context-words svelte-mzowth"> </span>',1),Nu=G(" <!>",1),Bu=G('<span class="context-words svelte-mzowth"> </span>&nbsp;',1),Uu=G("<!> ",1),Hu=G('<span class="context-words svelte-mzowth"> </span>&nbsp;',1),zu=G("<!> ",1),ju=G('&nbsp;<span class="context-words svelte-mzowth"> </span>',1),$u=G(" <!>",1),Wu=G('<span class="orp svelte-mzowth"> </span> <span class="before-orp svelte-mzowth"><!></span> <span class="after-orp svelte-mzowth"><!></span>',1),Vu=G('<span class="placeholder svelte-mzowth">Ready</span>'),Gu=G('<div class="rsvp-display svelte-mzowth"><div class="focus-marker svelte-mzowth"><div class="marker-line top svelte-mzowth"></div> <div class="marker-line bottom svelte-mzowth"></div></div> <div><!></div></div>');function qu(o,t){Es(t,!1);const e=V(),s=V(),i=V(),n=V(),r=V(),a=V(),l=V(),h=V(),c=V();let d=J(t,"word",8,""),u=J(t,"wordGroup",24,()=>[]),f=J(t,"highlightIndex",8,0),p=J(t,"opacity",8,1),g=J(t,"fadeDuration",8,150),b=J(t,"fadeEnabled",8,!0),v=J(t,"multiWordEnabled",8,!1),w=J(t,"orpColor",8,"#ff4444"),y=J(t,"wordColor",8,"#ffffff"),_=J(t,"highlightColor",8,"#ff4444");Jt(()=>(zt(v()),zt(u())),()=>{x(e,v()&&u().length>0)}),Jt(()=>(m(e),zt(u()),zt(f()),zt(d())),()=>{x(s,m(e)?u()[f()]||"":d())}),Jt(()=>(m(s),Na),()=>{x(i,m(s)?Na(m(s)):-1)}),Jt(()=>(m(s),m(i)),()=>{x(n,m(s)?m(s).slice(0,m(i)):"")}),Jt(()=>(m(s),m(i)),()=>{x(r,m(s)&&m(s)[m(i)]||"")}),Jt(()=>(m(s),m(i)),()=>{x(a,m(s)?m(s).slice(m(i)+1):"")}),Jt(()=>(m(e),zt(u()),zt(f())),()=>{x(l,m(e)?u().slice(0,f()):[])}),Jt(()=>(m(e),zt(u()),zt(f())),()=>{x(h,m(e)?u().slice(f()+1):[])}),Jt(()=>m(s),()=>{x(c,/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/.test(m(s)))}),Fr(),qs();var A=Gu(),S=M(A),E=k(S,2);let T;var C=M(E);{var D=I=>{var z=Wu(),U=ne(z),Q=M(U),L=k(U,2),O=M(L);{var j=ut=>{var Et=Nu(),it=ne(Et,!0),dt=k(it);{var Xt=vt=>{var at=Ou(),_t=k(ne(at)),bt=M(_t);lt(yt=>pt(bt,yt),[()=>(m(h),et(()=>m(h).join(" ")))]),$(vt,at)};st(dt,vt=>{m(e),m(h),et(()=>m(e)&&m(h).length>0)&&vt(Xt)})}lt(()=>pt(it,m(a))),$(ut,Et)},ft=ut=>{var Et=Uu(),it=ne(Et);{var dt=vt=>{var at=Bu(),_t=ne(at),bt=M(_t);lt(yt=>pt(bt,yt),[()=>(m(l),et(()=>m(l).join(" ")))]),$(vt,at)};st(it,vt=>{m(e),m(l),et(()=>m(e)&&m(l).length>0)&&vt(dt)})}var Xt=k(it,1,!0);lt(()=>pt(Xt,m(n))),$(ut,Et)};st(O,ut=>{m(c)?ut(j):ut(ft,!1)})}var Rt=k(L,2),ct=M(Rt);{var tt=ut=>{var Et=zu(),it=ne(Et);{var dt=vt=>{var at=Hu(),_t=ne(at),bt=M(_t);lt(yt=>pt(bt,yt),[()=>(m(l),et(()=>m(l).join(" ")))]),$(vt,at)};st(it,vt=>{m(e),m(l),et(()=>m(e)&&m(l).length>0)&&vt(dt)})}var Xt=k(it,1,!0);lt(()=>pt(Xt,m(n))),$(ut,Et)},rt=ut=>{var Et=$u(),it=ne(Et,!0),dt=k(it);{var Xt=vt=>{var at=ju(),_t=k(ne(at)),bt=M(_t);lt(yt=>pt(bt,yt),[()=>(m(h),et(()=>m(h).join(" ")))]),$(vt,at)};st(dt,vt=>{m(e),m(h),et(()=>m(e)&&m(h).length>0)&&vt(Xt)})}lt(()=>pt(it,m(a))),$(ut,Et)};st(ct,ut=>{m(c)?ut(tt):ut(rt,!1)})}lt(()=>{pt(Q,m(r)),si(L,`direction: ${m(c)?"rtl":"ltr"}`),si(Rt,`direction: ${m(c)?"rtl":"ltr"}`)}),$(I,z)},R=I=>{var z=Vu();$(I,z)};st(C,I=>{m(s)?I(D):I(R,!1)})}lt(()=>{si(S,`--highlight-color: ${_()??""};`),T=Bt(E,1,"word-container svelte-mzowth",null,T,{"multi-mode":m(e)}),si(E,`opacity: ${p()??""}; transition: opacity ${(b()?g():0)??""}ms ease-in-out; --word-color: ${y()??""}; --orp-color: ${w()??""};`)}),$(o,A),xs()}var Xu=G('<span class="svelte-d1h2e2">Prev</span>'),Yu=G('<button class="control-btn chapter-nav svelte-d1h2e2" title="Previous Chapter"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg> <!></button>'),Ku=On('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M8 5v14l11-7z"></path></svg>'),Ju=G('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M8 5v14l11-7z"></path></svg> <span class="svelte-d1h2e2">Play</span>',1),Qu=G('<button class="control-btn play svelte-d1h2e2" title="Play (Space)"><!></button>'),Zu=On('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>'),tf=G('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg> <span class="svelte-d1h2e2">Pause</span>',1),ef=G('<button class="control-btn pause svelte-d1h2e2" title="Pause (Space)"><!></button>'),sf=On('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M8 5v14l11-7z"></path></svg>'),nf=G('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M8 5v14l11-7z"></path></svg> <span class="svelte-d1h2e2">Resume</span>',1),rf=G('<button class="control-btn play svelte-d1h2e2" title="Resume (Space)"><!></button>'),af=On('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M6 6h12v12H6z"></path></svg>'),of=G('<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M6 6h12v12H6z"></path></svg> <span class="svelte-d1h2e2">Stop</span>',1),lf=G('<button class="control-btn restart svelte-d1h2e2" title="Restart"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"></path></svg> <span class="svelte-d1h2e2">Restart</span></button>'),hf=G('<span class="svelte-d1h2e2">Next</span>'),cf=G('<button class="control-btn chapter-nav svelte-d1h2e2" title="Next Chapter"><!> <svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d1h2e2"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button>'),df=G('<div><!> <!> <button class="control-btn stop svelte-d1h2e2" title="Stop (Esc)"><!></button> <!> <!></div>');function uf(o,t){Es(t,!1);let e=J(t,"isPlaying",8,!1),s=J(t,"isPaused",8,!1),i=J(t,"canPlay",8,!0),n=J(t,"minimal",8,!1),r=J(t,"chapterMode",8,!1),a=J(t,"hasChapters",8,!1);const l=Yi();qs();var h=df();let c;var d=M(h);{var u=T=>{var C=Yu(),D=k(M(C),2);{var R=I=>{var z=Xu();$(I,z)};st(D,I=>{n()||I(R)})}q("click",C,()=>l("previousChapter")),$(T,C)};st(d,T=>{r()&&a()&&T(u)})}var f=k(d,2);{var p=T=>{var C=Qu(),D=M(C);{var R=z=>{var U=Ku();$(z,U)},I=z=>{var U=Ju();$(z,U)};st(D,z=>{n()?z(R):z(I,!1)})}lt(()=>C.disabled=!i()),q("click",C,()=>l("play")),$(T,C)},g=T=>{var C=lc(),D=ne(C);{var R=z=>{var U=ef(),Q=M(U);{var L=j=>{var ft=Zu();$(j,ft)},O=j=>{var ft=tf();$(j,ft)};st(Q,j=>{n()?j(L):j(O,!1)})}q("click",U,()=>l("pause")),$(z,U)},I=z=>{var U=rf(),Q=M(U);{var L=j=>{var ft=sf();$(j,ft)},O=j=>{var ft=nf();$(j,ft)};st(Q,j=>{n()?j(L):j(O,!1)})}q("click",U,()=>l("resume")),$(z,U)};st(D,z=>{e()?z(R):z(I,!1)},!0)}$(T,C)};st(f,T=>{!e()&&!s()?T(p):T(g,!1)})}var b=k(f,2),v=M(b);{var w=T=>{var C=af();$(T,C)},y=T=>{var C=of();$(T,C)};st(v,T=>{n()?T(w):T(y,!1)})}var _=k(b,2);{var A=T=>{var C=lf();lt(()=>C.disabled=!i()),q("click",C,()=>l("restart")),$(T,C)};st(_,T=>{n()||T(A)})}var S=k(_,2);{var E=T=>{var C=cf(),D=M(C);{var R=I=>{var z=hf();$(I,z)};st(D,I=>{n()||I(R)})}q("click",C,()=>l("nextChapter")),$(T,C)};st(S,T=>{r()&&a()&&T(E)})}lt(()=>{c=Bt(h,1,"controls svelte-d1h2e2",null,c,{minimal:n()}),b.disabled=!e()&&!s()}),q("click",b,()=>l("stop")),$(o,h),xs()}var ff=G("<button> </button>"),pf=G('<div class="wpm-control svelte-anx9w7"><div class="wpm-display svelte-anx9w7"><span class="wpm-value svelte-anx9w7"> </span> <span class="wpm-label svelte-anx9w7">words/min</span></div> <input type="range" min="50" max="1000" step="25" class="slider svelte-anx9w7"/> <div class="wpm-presets svelte-anx9w7"></div></div> <div class="control-row svelte-anx9w7"><div class="control-header svelte-anx9w7"><span class="svelte-anx9w7">Lower WPM for longer words</span> <span class="control-value svelte-anx9w7"> </span></div> <input type="range" min="0" max="50" step="1" class="slider svelte-anx9w7"/> <p class="hint-text svelte-anx9w7">How many percentage points each letter increases pause duration</p></div>',1),gf=G('<div class="control-row svelte-anx9w7"><div class="control-header svelte-anx9w7"><span class="svelte-anx9w7">Chapter Reading Mode</span></div> <label class="checkbox-label svelte-anx9w7"><input type="checkbox" class="svelte-anx9w7"/> <span class="svelte-anx9w7">Read by chapters (stop at chapter end, Prev/Next jump chapters)</span></label> <p class="hint-text svelte-anx9w7">When enabled, playback stops at the end of each chapter and Prev/Next buttons navigate between chapters</p></div> <div class="control-row svelte-anx9w7"><div class="control-header svelte-anx9w7"><span class="svelte-anx9w7">Words shown simultaneously</span> <span class="control-value svelte-anx9w7"> </span></div> <input type="range" min="1" max="7" step="2" class="slider svelte-anx9w7"/> <p class="hint-text svelte-anx9w7">Odd numbers (1, 3, 5, 7) center the highlight best</p></div>',1),mf=G('<div class="color-grid svelte-anx9w7"><div class="color-control svelte-anx9w7"><label for="orpColor" class="svelte-anx9w7">ORP & Highlight</label> <div class="color-input-wrapper svelte-anx9w7"><input id="orpColor" type="color" class="color-picker svelte-anx9w7"/> <span class="color-value svelte-anx9w7"> </span></div></div> <div class="color-control svelte-anx9w7"><label for="backgroundColor" class="svelte-anx9w7">Background</label> <div class="color-input-wrapper svelte-anx9w7"><input id="backgroundColor" type="color" class="color-picker svelte-anx9w7"/> <span class="color-value svelte-anx9w7"> </span></div></div> <div class="color-control svelte-anx9w7"><label for="wordColor" class="svelte-anx9w7">Word Text</label> <div class="color-input-wrapper svelte-anx9w7"><input id="wordColor" type="color" class="color-picker svelte-anx9w7"/> <span class="color-value svelte-anx9w7"> </span></div></div></div> <div class="control-row svelte-anx9w7"><div class="control-header svelte-anx9w7"><span class="svelte-anx9w7">Read words opacity</span> <span class="control-value svelte-anx9w7"> </span></div> <input type="range" min="0" max="1" step="0.05" class="slider svelte-anx9w7"/> <p class="hint-text svelte-anx9w7">Greying effect for already-read words</p></div>',1),vf=G('<div class="sub-control svelte-anx9w7"><div class="control-header svelte-anx9w7"><span class="svelte-anx9w7">Duration</span> <span class="control-value svelte-anx9w7"> </span></div> <input type="range" min="50" max="300" step="25" class="slider slider-sm svelte-anx9w7"/></div>'),bf=G('<div class="toggle-row svelte-anx9w7"><span class="toggle-label svelte-anx9w7">Word fade</span> <button role="switch" aria-label="Toggle word fade effect"><span class="toggle-thumb svelte-anx9w7"></span></button></div> <!>',1),yf=G('<div class="sub-control svelte-anx9w7"><div class="control-header svelte-anx9w7"><span class="svelte-anx9w7">Pause multiplier</span> <span class="control-value svelte-anx9w7"> </span></div> <input type="range" min="1" max="4" step="0.5" class="slider slider-sm svelte-anx9w7"/></div>'),wf=G('<div class="sub-control svelte-anx9w7"><div class="control-header svelte-anx9w7"><span class="svelte-anx9w7">Pause duration</span> <span class="control-value svelte-anx9w7"> </span></div> <input type="range" min="100" max="2000" step="100" class="slider slider-sm svelte-anx9w7"/></div>'),_f=G('<div class="toggle-row svelte-anx9w7"><span class="toggle-label svelte-anx9w7">Pause on punctuation</span> <button role="switch" aria-label="Toggle pause on punctuation"><span class="toggle-thumb svelte-anx9w7"></span></button></div> <!> <div class="control-row svelte-anx9w7"><div class="control-header svelte-anx9w7"><span class="svelte-anx9w7">Pause every N words</span> <span class="control-value svelte-anx9w7"> </span></div> <input type="range" min="0" max="50" step="5" class="slider svelte-anx9w7"/></div> <!>',1),Af=G('<div class="settings-panel svelte-anx9w7"><div class="settings-header svelte-anx9w7"><h3 class="svelte-anx9w7">Settings</h3> <button class="close-btn svelte-anx9w7" title="Close"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-anx9w7"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div> <div class="settings-body svelte-anx9w7"><nav class="settings-nav svelte-anx9w7"><button><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-anx9w7"><path d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"></path></svg> <span>Speed</span></button> <button><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-anx9w7"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"></path></svg> <span>Display</span></button> <button><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-anx9w7"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path></svg> <span>Colors</span></button> <button><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-anx9w7"><path d="M7.5 5.6L10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.996.996 0 0 0-1.41 0L1.29 18.96a.996.996 0 0 0 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05a.996.996 0 0 0 0-1.41l-2.33-2.35zm-1.03 5.49l-2.12-2.12 2.44-2.44 2.12 2.12-2.44 2.44z"></path></svg> <span>Effects</span></button> <button><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-anx9w7"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg> <span>Pauses</span></button></nav> <div class="settings-content svelte-anx9w7"><!> <!> <!> <!> <!></div></div></div>');function Sf(o,t){Es(t,!1);let e=J(t,"wordsPerMinute",12,300),s=J(t,"fadeEnabled",12,!0),i=J(t,"fadeDuration",12,150),n=J(t,"pauseOnPunctuation",12,!0),r=J(t,"punctuationPauseMultiplier",12,2),a=J(t,"pauseAfterWords",12,0),l=J(t,"pauseDuration",12,500),h=J(t,"frameWordCount",12,1),c=J(t,"wordLengthWPMMultiplier",12,5),d=J(t,"orpColor",12,"#ff4444"),u=J(t,"backgroundColor",12,"#000000"),f=J(t,"wordColor",12,"#ffffff"),p=J(t,"readOpacity",12,.75),g=J(t,"chapterMode",12,!0);const b=Yi();let v=V("speed");function w(){b("close")}const y=[200,300,400,500];qs();var _=Af(),A=M(_),S=k(M(A),2),E=k(A,2),T=M(E),C=M(T);let D;var R=k(C,2);let I;var z=k(R,2);let U;var Q=k(z,2);let L;var O=k(Q,2);let j;var ft=k(T,2),Rt=M(ft);{var ct=at=>{var _t=pf(),bt=ne(_t),yt=M(bt),ee=M(yt),de=M(ee),$t=k(yt,2),ue=k($t,2);tl(ue,5,()=>y,Zo,(Cs,Yt)=>{var re=ff();let Me;var ss=M(re);lt(()=>{Me=Bt(re,1,"preset-btn svelte-anx9w7",null,Me,{active:e()===m(Yt)}),pt(ss,m(Yt))}),q("click",re,()=>e(m(Yt))),$(Cs,re)});var fe=k(bt,2),Se=M(fe),Ne=k(M(Se),2),ts=M(Ne),es=k(Se,2);lt(()=>{pt(de,e()),pt(ts,`${c()??""}%`)}),be($t,e),be(es,c),$(at,_t)};st(Rt,at=>{m(v)==="speed"&&at(ct)})}var tt=k(Rt,2);{var rt=at=>{var _t=gf(),bt=ne(_t),yt=k(M(bt),2),ee=M(yt),de=k(bt,2),$t=M(de),ue=k(M($t),2),fe=M(ue),Se=k($t,2);lt(()=>pt(fe,h())),Ac(ee,g),be(Se,h),$(at,_t)};st(tt,at=>{m(v)==="display"&&at(rt)})}var ut=k(tt,2);{var Et=at=>{var _t=mf(),bt=ne(_t),yt=M(bt),ee=k(M(yt),2),de=M(ee),$t=k(de,2),ue=M($t),fe=k(yt,2),Se=k(M(fe),2),Ne=M(Se),ts=k(Ne,2),es=M(ts),Cs=k(fe,2),Yt=k(M(Cs),2),re=M(Yt),Me=k(re,2),ss=M(Me),Ts=k(bt,2),ps=M(Ts),Wn=k(M(ps),2),Ps=M(Wn),Vn=k(ps,2);lt(an=>{pt(ue,d()),pt(es,u()),pt(ss,f()),pt(Ps,`${an??""}%`)},[()=>(zt(p()),et(()=>Math.round(p()*100)))]),be(de,d),be(Ne,u),be(re,f),be(Vn,p),$(at,_t)};st(ut,at=>{m(v)==="colors"&&at(Et)})}var it=k(ut,2);{var dt=at=>{var _t=bf(),bt=ne(_t),yt=k(M(bt),2);let ee;var de=k(bt,2);{var $t=ue=>{var fe=vf(),Se=M(fe),Ne=k(M(Se),2),ts=M(Ne),es=k(Se,2);lt(()=>pt(ts,`${i()??""}ms`)),be(es,i),$(ue,fe)};st(de,ue=>{s()&&ue($t)})}lt(()=>{ee=Bt(yt,1,"toggle svelte-anx9w7",null,ee,{active:s()}),Ye(yt,"aria-checked",s())}),q("click",yt,()=>s(!s())),$(at,_t)};st(it,at=>{m(v)==="effects"&&at(dt)})}var Xt=k(it,2);{var vt=at=>{var _t=_f(),bt=ne(_t),yt=k(M(bt),2);let ee;var de=k(bt,2);{var $t=Yt=>{var re=yf(),Me=M(re),ss=k(M(Me),2),Ts=M(ss),ps=k(Me,2);lt(()=>pt(Ts,`${r()??""}x`)),be(ps,r),$(Yt,re)};st(de,Yt=>{n()&&Yt($t)})}var ue=k(de,2),fe=M(ue),Se=k(M(fe),2),Ne=M(Se),ts=k(fe,2),es=k(ue,2);{var Cs=Yt=>{var re=wf(),Me=M(re),ss=k(M(Me),2),Ts=M(ss),ps=k(Me,2);lt(()=>pt(Ts,`${l()??""}ms`)),be(ps,l),$(Yt,re)};st(es,Yt=>{a()>0&&Yt(Cs)})}lt(()=>{ee=Bt(yt,1,"toggle svelte-anx9w7",null,ee,{active:n()}),Ye(yt,"aria-checked",n()),pt(Ne,a()===0?"Off":a())}),q("click",yt,()=>n(!n())),be(ts,a),$(at,_t)};st(Xt,at=>{m(v)==="pauses"&&at(vt)})}lt(()=>{D=Bt(C,1,"nav-tab svelte-anx9w7",null,D,{active:m(v)==="speed"}),I=Bt(R,1,"nav-tab svelte-anx9w7",null,I,{active:m(v)==="display"}),U=Bt(z,1,"nav-tab svelte-anx9w7",null,U,{active:m(v)==="colors"}),L=Bt(Q,1,"nav-tab svelte-anx9w7",null,L,{active:m(v)==="effects"}),j=Bt(O,1,"nav-tab svelte-anx9w7",null,j,{active:m(v)==="pauses"})}),q("click",S,w),q("click",C,()=>x(v,"speed")),q("click",R,()=>x(v,"display")),q("click",z,()=>x(v,"colors")),q("click",Q,()=>x(v,"effects")),q("click",O,()=>x(v,"pauses")),$(o,_),xs()}var Ef=G('<p class="loading-message svelte-d9edf1"> </p>'),xf=G('<div class="text-input-panel svelte-d9edf1"><div class="panel-header svelte-d9edf1"><h3 class="svelte-d9edf1">Load Content</h3> <button class="close-icon svelte-d9edf1" title="Close"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d9edf1"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div> <div class="upload-section svelte-d9edf1"><input type="file" class="hidden-input svelte-d9edf1"/> <button class="upload-btn svelte-d9edf1"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-d9edf1"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11 8 15.01z"></path></svg> <span>Upload PDF or EPUB</span></button> <!></div> <div class="divider svelte-d9edf1"><span class="svelte-d9edf1">or paste text</span></div> <textarea placeholder="Paste or type your text here..." rows="8" class="svelte-d9edf1"></textarea> <div class="panel-actions svelte-d9edf1"><button class="btn-secondary svelte-d9edf1">Cancel</button> <button class="btn-primary svelte-d9edf1">Load Text</button></div></div>');function Cf(o,t){Es(t,!1);let e=J(t,"text",12,""),s=J(t,"isLoading",8,!1),i=J(t,"loadingMessage",8,"");const n=Yi();let r=V();function a(){n("apply",{text:e()})}function l(){n("close")}function h(E){n("fileselect",{file:E.target.files?.[0]})}function c(){m(r)?.click()}qs();var d=xf(),u=M(d),f=k(M(u),2),p=k(u,2),g=M(p);Sc(g,E=>x(r,E),()=>m(r));var b=k(g,2),v=k(b,2);{var w=E=>{var T=Ef(),C=M(T);lt(()=>pt(C,i())),$(E,T)};st(v,E=>{i()&&E(w)})}var y=k(p,4),_=k(y,2),A=M(_),S=k(A,2);lt((E,T)=>{Ye(g,"accept",E),b.disabled=s(),y.disabled=s(),S.disabled=T},[()=>(zt(uo),et(uo)),()=>(zt(s()),zt(e()),et(()=>s()||!e().trim()))]),q("click",f,l),q("change",g,h),q("click",b,c),be(y,e),q("click",A,l),q("click",S,a),$(o,d),xs()}var Tf=G('<div class="stats svelte-1qjgclg"><span class="stat svelte-1qjgclg"> </span> <span class="stat wpm svelte-1qjgclg"> </span> <span class="stat svelte-1qjgclg"> </span></div>'),Pf=G('<div><div><div class="progress-bar svelte-1qjgclg"></div></div> <!></div>');function kf(o,t){Es(t,!1);let e=J(t,"progress",8,0),s=J(t,"currentWord",8,0),i=J(t,"totalWords",8,0),n=J(t,"wpm",8,300),r=J(t,"timeRemaining",8,"0:00"),a=J(t,"minimal",8,!1),l=J(t,"clickable",8,!1);const h=Yi();function c(y){if(!l())return;const _=y.currentTarget.getBoundingClientRect(),S=(y.clientX-_.left)/_.width*100;h("seek",{percentage:Math.max(0,Math.min(100,S))})}function d(y){if(!l())return;const _=y.shiftKey?10:1;y.key==="ArrowLeft"||y.key==="ArrowDown"?(y.preventDefault(),h("seek",{percentage:Math.max(0,e()-_)})):y.key==="ArrowRight"||y.key==="ArrowUp"?(y.preventDefault(),h("seek",{percentage:Math.min(100,e()+_)})):y.key==="Home"?(y.preventDefault(),h("seek",{percentage:0})):y.key==="End"&&(y.preventDefault(),h("seek",{percentage:100}))}qs();var u=Pf();let f;var p=M(u);let g;var b=M(p),v=k(p,2);{var w=y=>{var _=Tf(),A=M(_),S=M(A),E=k(A,2),T=M(E),C=k(E,2),D=M(C);lt(()=>{pt(S,`${s()??""} / ${i()??""}`),pt(T,`${n()??""} WPM`),pt(D,r())}),$(y,_)};st(v,y=>{a()||y(w)})}lt(y=>{f=Bt(u,1,"progress-wrapper svelte-1qjgclg",null,f,{minimal:a()}),g=Bt(p,1,"progress-container svelte-1qjgclg",null,g,{clickable:l()}),Ye(p,"role",l()?"slider":void 0),Ye(p,"tabindex",l()?0:void 0),Ye(p,"aria-valuenow",y),Ye(p,"aria-valuemin",l()?0:void 0),Ye(p,"aria-valuemax",l()?100:void 0),Ye(p,"aria-label",l()?"Reading progress":void 0),si(b,`width: ${e()??""}%`)},[()=>(zt(l()),zt(e()),et(()=>l()?Math.round(e()):void 0))]),q("click",p,c),q("keydown",p,d),$(o,u),xs()}var Mf=G('<div class="empty-state svelte-129hoe0"><p class="svelte-129hoe0">No chapters available</p> <p class="hint svelte-129hoe0">Chapters will appear here when you load a book with table of contents or add them manually.</p></div>'),Rf=G('<div class="chapter-preview svelte-129hoe0"> </div>'),Df=G('<div><button class="chapter-link svelte-129hoe0"><span class="chapter-marker svelte-129hoe0"> </span> <span class="chapter-name svelte-129hoe0"> </span></button> <!></div>'),Lf=G('<div class="chapter-tree svelte-129hoe0"></div>'),If=G('<div><div class="sidebar-header svelte-129hoe0"><h3 class="svelte-129hoe0">Chapters</h3> <button class="close-btn svelte-129hoe0" aria-label="Close sidebar"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-129hoe0"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div> <div class="sidebar-content svelte-129hoe0"><!></div></div>');function Ff(o,t){Es(t,!1);let e=J(t,"chapters",24,()=>[]),s=J(t,"currentWordIndex",8,0),i=J(t,"isOpen",8,!1);const n=Yi();function r(b,v){n("jump",{wordIndex:b,chapterName:v})}function a(b){const v="ABCDEFGHIJKLMNOPQRSTUVWXYZ";if(b<26)return v[b];const w=Math.floor(b/26)-1,y=b%26;return v[w]+v[y]}Jt(()=>(zt(e()),zt(i())),()=>{console.log("Sidebar chapters:",e(),"isOpen:",i())}),Fr(),qs();var l=If();let h;var c=M(l),d=k(M(c),2),u=k(c,2),f=M(u);{var p=b=>{var v=Mf();$(b,v)},g=b=>{var v=Lf();tl(v,5,e,Zo,(w,y,_)=>{var A=Df();let S;var E=M(A),T=M(E),C=M(T),D=k(T,2),R=M(D),I=k(E,2);{var z=U=>{var Q=Rf(),L=M(Q);lt(()=>pt(L,(m(y),et(()=>m(y).preview)))),$(U,Q)};st(I,U=>{m(y),et(()=>m(y).preview)&&U(z)})}lt(U=>{S=Bt(A,1,"chapter-item svelte-129hoe0",null,S,{current:s()>=m(y).startWordIndex&&(_===e().length-1||s()<e()[_+1]?.startWordIndex)}),Ye(E,"title",`Jump to ${m(y),et(()=>m(y).name)??""}`),pt(C,U),pt(R,(m(y),et(()=>m(y).name)))},[()=>et(()=>a(_))]),q("click",E,()=>r(m(y).startWordIndex,m(y).name)),$(w,A)}),$(b,v)};st(f,b=>{zt(e()),et(()=>e().length===0)?b(p):b(g,!1)})}lt(()=>h=Bt(l,1,"sidebar svelte-129hoe0",null,h,{open:i()})),q("click",d,()=>n("close")),$(o,l),xs()}var Of=G('<header class="svelte-1n46o8q"><h1 class="svelte-1n46o8q">RSVP Reader</h1> <div class="header-actions svelte-1n46o8q"><button title="Chapters"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1n46o8q"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"></path></svg></button> <button class="icon-btn svelte-1n46o8q" title="Add Chapter Marker"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1n46o8q"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z M13 13h-2v3H9v-3H6v-2h3V8h2v3h3v2z"></path></svg></button> <button title="Jump to word (G)"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1n46o8q"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg></button> <button class="icon-btn svelte-1n46o8q" title="Save progress (Ctrl+S)"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1n46o8q"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"></path></svg></button> <button title="Load Content"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1n46o8q"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"></path></svg></button> <button title="Settings"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1n46o8q"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"></path></svg></button></div></header>'),Nf=G('<div class="panel-overlay svelte-1n46o8q"><!></div>'),Bf=G('<div class="panel-overlay svelte-1n46o8q"><!></div>'),Uf=G('<div class="panel-overlay svelte-1n46o8q" role="presentation"><div class="jump-to-panel svelte-1n46o8q"><h3 class="svelte-1n46o8q">Jump to position</h3> <p class="jump-hint svelte-1n46o8q">Enter word number (e.g., 150) or percentage (e.g., 50%)</p> <form><input type="text" placeholder="Word # or %" class="svelte-1n46o8q"/> <div class="jump-actions svelte-1n46o8q"><button type="button" class="secondary svelte-1n46o8q">Cancel</button> <button type="submit" class="primary svelte-1n46o8q">Go</button></div></form> <div class="quick-jumps svelte-1n46o8q"><button class="svelte-1n46o8q">Start</button> <button class="svelte-1n46o8q">25%</button> <button class="svelte-1n46o8q">50%</button> <button class="svelte-1n46o8q">75%</button></div></div></div>'),Hf=G('<div class="panel-overlay svelte-1n46o8q"><div class="saved-session-panel svelte-1n46o8q"><h3 class="svelte-1n46o8q">Resume reading?</h3> <p class="svelte-1n46o8q"> </p> <p class="saved-time svelte-1n46o8q"> </p> <div class="session-actions svelte-1n46o8q"><button class="secondary svelte-1n46o8q">Start Fresh</button> <button class="primary svelte-1n46o8q">Resume</button></div></div></div>'),zf=G('<div class="panel-overlay svelte-1n46o8q" role="presentation"><div class="chapter-dialog svelte-1n46o8q"><h3 class="svelte-1n46o8q">Add Chapter Marker</h3> <p class="dialog-hint svelte-1n46o8q"> </p> <form><input type="text" placeholder="Chapter name" class="svelte-1n46o8q"/> <div class="dialog-actions svelte-1n46o8q"><button type="button" class="secondary svelte-1n46o8q">Cancel</button> <button type="submit" class="primary svelte-1n46o8q">Add Chapter</button></div></form></div></div>'),jf=G('<div class="shortcuts desktop-only svelte-1n46o8q"><kbd class="svelte-1n46o8q">Space</kbd> Play <kbd class="svelte-1n46o8q">Esc</kbd> Exit <kbd class="svelte-1n46o8q">↑↓</kbd> Speed <kbd class="svelte-1n46o8q">←→</kbd> Skip <kbd class="svelte-1n46o8q">G</kbd> Jump <kbd class="svelte-1n46o8q">Ctrl+S</kbd> Save</div> <div class="touch-controls mobile-only svelte-1n46o8q"><button class="touch-btn svelte-1n46o8q" title="Back 5 words"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1n46o8q"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></button> <button class="touch-btn svelte-1n46o8q" title="Slower"><span>−WPM</span></button> <span class="wpm-display svelte-1n46o8q"> </span> <button class="touch-btn svelte-1n46o8q" title="Faster"><span>+WPM</span></button> <button class="touch-btn svelte-1n46o8q" title="Forward 5 words"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1n46o8q"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"></path></svg></button></div>',1),$f=G('<main><!> <!> <!> <!> <!> <!> <!> <div class="display-area svelte-1n46o8q"><!></div> <div><!> <div class="controls-area svelte-1n46o8q"><!></div> <!></div></main>');function Wf(o,t){Es(t,!1);const e=V(),s=V(),i=V(),n=V(),r=V(),a=V();let l=V(1);const h=`Welcome to RSVP Reader

RSVP Reader is a Svelte-based Rapid Serial Visual Presentation (RSVP) reader for speed reading. Rapid Serial Visual Presentation is a technique where text is displayed one word at a time at a fixed focal point. This eliminates the need for eye movements during reading, potentially allowing for significantly faster reading speeds.

How It Works

The app uses Optimal Recognition Point (ORP) highlighting. The red letter in each word indicates the point where your eye naturally focuses for fastest word recognition. This is calculated based on word length: 1-3 letter words highlight the first letter, 4-5 letter words the second, 6-9 letter words the third, and 10+ letter words the fourth.

Getting Started

Press Space to play and start reading. Use the arrow keys to increase or decrease words per minute. Load your own PDF or EPUB with the document icon, or paste text directly. Click the gear icon for settings: adjust fade effects, punctuation pauses, periodic breaks, colors, and more. Save your progress with Ctrl+S and resume later.

Features

- PDF & EPUB Support: Upload documents directly
- Adjustable Speed: 50-1000 words per minute (WPM)
- ORP Highlighting: Red focal letter for recognition
- Fade Effects: Optional smooth transitions between words
- Punctuation Pauses: Extra pause on sentence endings
- Periodic Pauses: Take breaks every N words
- Progress Tracking: Visual progress bar and time remaining
- Save Sessions: Save and resume your reading
- Jump to Position: Skip to any word or percentage
- Keyboard Control: Full hands-free control
- Dark Theme: Easy on the eyes

Keyboard Shortcuts

Space: Play/Pause/Resume
Escape: Exit focus mode
Arrow Up/Down: Increase/Decrease speed
Arrow Left/Right: Go back/forward one word
G: Open jump to position dialog
Ctrl+S or Cmd+S: Save progress

Start by loading a PDF, EPUB, or pasting text. Press Space when ready.`;let c=V(h),d=V([]),u=V(0),f=V(!1),p=V(!1),g=V(!1),b=V(!1),v=V(0),w=V(!1),y=V(""),_=V(!1),A=V(""),S=V(null),E=V(!1),T=V(!1),C=V([]),D=V(!1),R=V(""),I=V(300),z=V(!0),U=V(150),Q=V(0),L=V(500),O=V(!0),j=V(2),ft=V(5),Rt=V("#ff4444"),ct=V("#000000"),tt=V("#ffffff"),rt=V(.75),ut=V(!0),Et=V(1),it=null,dt=null;function Xt(P){return re(P)}function vt(){x(d,kc(m(c))),x(u,0),x(v,0)}function at(P){return Dc(P,m(I),m(O),m(j),m(ft))}function _t(){if(m(ut)&&m(C).length>0&&m(u)>=m(a)){$t();return}if(m(u)>=m(d).length){$t();return}if(Ic(m(u),m(Q))){x(p,!0),setTimeout(()=>{m(f)&&(x(p,!1),bt())},m(L));return}m(z)&&(x(Et,0),dt=setTimeout(()=>{x(Et,1)},10)),x(v,(m(u)+1)/m(d).length*100),Aa(u),bt()}function bt(){if(!m(f)||m(u)>=m(d).length)return;const P=m(d)[m(u)-1]||"";it=setTimeout(_t,at(P))}function yt(){if(m(d).length===0&&vt(),m(d).length!==0){if(m(ut)&&m(C).length>0){const P=m(C)[m(r)]?.startWordIndex??0;(m(u)<P||m(u)>=m(a))&&(x(u,P),x(v,m(u)/m(d).length*100))}x(f,!0),x(p,!1),x(g,!1),x(b,!1),_t()}}function ee(){x(f,!1),x(p,!0),it&&(clearTimeout(it),it=null)}function de(){m(u)<m(d).length&&(x(f,!0),x(p,!1),bt())}function $t(){x(f,!1),x(p,!1),x(u,0),x(v,0),x(Et,1),it&&(clearTimeout(it),it=null)}function ue(){$t(),yt()}function fe(P){x(c,P.detail.text),$t(),vt(),x(b,!1)}async function Se(P){const N=P.detail.file;if(N){x(w,!0),x(y,`Loading ${N.name}...`);try{let Z=null;if(N.name.toLowerCase().endsWith(".pdf")){const B=await Hl(N);x(c,B.text),Z=B.pageWordCounts}else x(c,await Mu(N));$t(),vt();try{console.log("🔍 Attempting to extract chapters from:",N.name);const B=await Ru(N);console.log("📋 Extracted chapters (raw):",B),B&&B.length>0?(N.name.endsWith(".pdf")&&Z?(console.log("🗺️  Mapping chapters to word indices using page word counts..."),x(C,B.map(Tt=>{const Pt=Z[Tt.pageNum]||0;return console.log(`  • "${Tt.name}" (page ${Tt.pageNum}) → word ${Pt}`),{name:Tt.name,startWordIndex:Pt,isManual:!1,level:Tt.level}}))):x(C,B.map((Tt,Pt)=>({name:Tt.name,startWordIndex:Math.floor(Pt/B.length*m(d).length),isManual:!1,level:Tt.level||0}))),console.log("✅ Final chapters:",m(C))):console.log("⚠️  No chapters found in file")}catch(B){console.error("❌ Could not extract chapters:",B)}x(b,!1),x(y,"")}catch(Z){console.error("Error parsing file:",Z),x(y,`Error: ${Z.message}`),setTimeout(()=>{x(y,"")},3e3)}finally{x(w,!1)}}}function Ne(){return m(d).length===0?!1:Du({text:m(c),currentWordIndex:m(u),totalWords:m(d).length,chapters:m(C),settings:{wordsPerMinute:m(I),fadeEnabled:m(z),fadeDuration:m(U),pauseOnPunctuation:m(O),punctuationPauseMultiplier:m(j),wordLengthWPMMultiplier:m(ft),pauseAfterWords:m(Q),pauseDuration:m(L),frameWordCount:m(l),orpColor:m(Rt),backgroundColor:m(ct),wordColor:m(tt),readOpacity:m(rt),chapterMode:m(ut)}})}function ts(){const P=Lu();return P?(x(c,P.text),vt(),x(u,P.currentWordIndex),x(v,m(u)/m(d).length*100),P.settings&&(x(I,P.settings.wordsPerMinute??m(I)),x(z,P.settings.fadeEnabled??m(z)),x(U,P.settings.fadeDuration??m(U)),x(O,P.settings.pauseOnPunctuation??m(O)),x(j,P.settings.punctuationPauseMultiplier??m(j)),x(ft,P.settings.wordLengthWPMMultiplier??m(ft)),x(Q,P.settings.pauseAfterWords??m(Q)),x(L,P.settings.pauseDuration??m(L)),x(l,P.settings.frameWordCount??m(l)),x(Rt,P.settings.orpColor??m(Rt)),x(ct,P.settings.backgroundColor??m(ct)),x(tt,P.settings.wordColor??m(tt)),x(rt,P.settings.readOpacity??m(rt)),x(ut,P.settings.chapterMode??m(ut))),P.chapters&&Array.isArray(P.chapters)&&(x(C,P.chapters),console.log("Restored chapters from session:",m(C))),x(E,!1),!0):!1}function es(){fo(),x(E,!1),x(S,null)}function Cs(P){const N=P.detail.wordIndex,Z=P.detail.chapterName;if(N>=0&&N<m(d).length){const B=Z?Yt(Z,N):N;x(u,B),x(v,m(u)/m(d).length*100),x(T,!1)}}function Yt(P,N,Z=500){if(m(d).length===0)return N;const B=Math.max(0,N-Z),Tt=Math.min(m(d).length,N+Z),Pt=m(d).slice(B,Tt).join(" ").toLowerCase(),ae=P.toLowerCase(),pe=Pt.indexOf(ae);if(pe!==-1){const Wt=B+Pt.substring(0,pe).split(/\s+/).length;return console.log(`  ✅ Found "${P}" at word ${Wt} (adjusted from ${N})`),Math.max(0,Wt)}const se=P.split(/\s+/).filter(Wt=>Wt.length>3);for(const Wt of se){const ge=Pt.indexOf(Wt.toLowerCase());if(ge!==-1){const ks=B+Pt.substring(0,ge).split(/\s+/).length;return console.log(`  ℹ️  Found keyword "${Wt}" at word ${ks} (adjusted from ${N})`),Math.max(0,ks)}}return console.log(`  ⚠️  Chapter heading not found, using mapped position ${N}`),N}function re(P){if(!m(C)||m(C).length===0)return 0;for(let N=m(C).length-1;N>=0;N--)if(P>=m(C)[N].startWordIndex)return N;return 0}function Me(P){return!m(C)||m(C).length===0||P>=m(C).length-1?m(d).length:m(C)[P+1].startWordIndex}function ss(){if(m(C).length===0)return;const P=m(r)+1;if(P<m(C).length){const N=m(C)[P];console.log(`⏭️  Jumping to chapter "${N.name}" (index ${P})`);const Z=Yt(N.name,N.startWordIndex);x(u,Z),x(v,m(u)/m(d).length*100),console.log(`   Page estimate: ~${Math.ceil(Z/250)}`)}}function Ts(){if(m(C).length===0)return;const P=m(r)-1;if(P>=0){const N=m(C)[P];console.log(`⏮️  Jumping to chapter "${N.name}" (index ${P})`);const Z=Yt(N.name,N.startWordIndex);x(u,Z),x(v,m(u)/m(d).length*100),console.log(`   Page estimate: ~${Math.ceil(Z/250)}`)}}function ps(){x(R,""),x(D,!0)}function Wn(){if(!m(R).trim()||m(d).length===0)return;const P={name:m(R).trim(),startWordIndex:m(u),isManual:!0};x(C,[...m(C),P].sort((N,Z)=>N.startWordIndex-Z.startWordIndex)),x(D,!1),x(R,"")}function Ps(P){if(!P||m(d).length===0)return;let N;const Z=P.trim();if(Z.endsWith("%")){const B=parseFloat(Z.slice(0,-1));isNaN(B)||(N=Math.floor(Math.max(0,Math.min(100,B))/100*m(d).length))}else{const B=parseInt(Z,10);isNaN(B)||(N=Math.max(0,Math.min(m(d).length,B)))}N!==void 0&&(x(u,N),x(v,m(u)/m(d).length*100)),x(_,!1),x(A,"")}function Vn(P){const N=P.detail.percentage,Z=Math.floor(N/100*m(d).length);x(u,Math.max(0,Math.min(m(d).length,Z))),x(v,m(u)/m(d).length*100)}function an(P){if(!(P.target.tagName==="TEXTAREA"||P.target.tagName==="INPUT"))switch(P.code){case"Space":P.preventDefault(),m(f)?ee():m(p)?de():yt();break;case"Escape":m(_)?(x(_,!1),x(A,"")):m(g)||m(b)?(x(g,!1),x(b,!1)):m(E)?x(E,!1):(m(f)||m(p))&&(x(f,!1),x(p,!1),it&&(clearTimeout(it),it=null));break;case"KeyG":!m(f)&&!m(g)&&!m(b)&&(P.preventDefault(),x(_,!m(_)));break;case"KeyS":(P.ctrlKey||P.metaKey)&&(P.preventDefault(),Ne());break;case"ArrowUp":P.preventDefault(),x(I,Math.min(1e3,m(I)+25));break;case"ArrowDown":P.preventDefault(),x(I,Math.max(50,m(I)-25));break;case"ArrowLeft":P.preventDefault(),m(u)>1&&(x(u,Math.max(0,m(u)-2)),x(v,m(u)/m(d).length*100));break;case"ArrowRight":P.preventDefault(),m(u)<m(d).length&&(x(v,(m(u)+1)/m(d).length*100),Aa(u));break}}el(async()=>{vt(),window.addEventListener("keydown",an),Iu()&&(x(S,Fu()),console.log("Found saved session:",m(S)),m(S)?.hasText?x(E,!0):(fo(),x(S,null))),(!m(d)||m(d).length===0)&&(console.warn("No words parsed on mount, resetting to default text."),x(c,h),vt())}),xc(()=>{it&&clearTimeout(it),dt&&clearTimeout(dt),window.removeEventListener("keydown",an)}),Jt(()=>(m(d),m(u)),()=>{x(e,m(d)[m(u)-1]||(m(d).length>0?m(d)[0]:""))}),Jt(()=>(m(d),m(u),m(l)),()=>{x(s,Fc(m(d),Math.max(0,m(u)-1),m(l)))}),Jt(()=>(m(d),m(u),m(I)),()=>{x(i,Lc(m(d).length-m(u),m(I)))}),Jt(()=>(m(f),m(p)),()=>{x(n,m(f)||m(p))}),Jt(()=>m(u),()=>{x(r,Xt(m(u)))}),Jt(()=>m(r),()=>{x(a,Me(m(r)))}),Jt(()=>m(ct),()=>{(m(ct)==="#ffffff"||m(ct).toLowerCase()==="#fff")&&x(tt,"#000000")}),Fr(),qs();var Gn=$f();let ra;var aa=M(Gn);{var zl=P=>{var N=Of(),Z=k(M(N),2),B=M(Z);let Tt;var Pt=k(B,2),ae=k(Pt,2);let pe;var se=k(ae,2),Wt=k(se,2);let ge;var ks=k(Wt,2);let on;lt(()=>{Tt=Bt(B,1,"icon-btn svelte-1n46o8q",null,Tt,{active:m(T)}),Pt.disabled=(m(d),et(()=>m(d).length===0)),pe=Bt(ae,1,"icon-btn svelte-1n46o8q",null,pe,{active:m(_)}),se.disabled=(m(d),et(()=>m(d).length===0)),ge=Bt(Wt,1,"icon-btn svelte-1n46o8q",null,ge,{active:m(b)}),on=Bt(ks,1,"icon-btn svelte-1n46o8q",null,on,{active:m(g)})}),q("click",B,()=>{x(T,!m(T)),x(g,!1),x(b,!1),x(_,!1)}),q("click",Pt,ps),q("click",ae,()=>{x(_,!m(_)),x(g,!1),x(b,!1),x(T,!1)}),q("click",se,Ne),q("click",Wt,()=>{x(b,!m(b)),x(g,!1),x(_,!1),x(T,!1)}),q("click",ks,()=>{x(g,!m(g)),x(b,!1),x(_,!1),x(T,!1)}),$(P,N)};st(aa,P=>{m(n)||P(zl)})}var oa=k(aa,2);{var jl=P=>{Ff(P,{get chapters(){return m(C)},get currentWordIndex(){return m(u)},get isOpen(){return m(T)},$$events:{jump:Cs,close:()=>x(T,!1)}})};st(oa,P=>{m(T)&&!m(n)&&P(jl)})}var la=k(oa,2);{var $l=P=>{var N=Nf(),Z=M(N);Cf(Z,{get text(){return m(c)},get isLoading(){return m(w)},get loadingMessage(){return m(y)},$$events:{apply:fe,fileselect:Se,close:()=>x(b,!1)}}),$(P,N)};st(la,P=>{m(b)&&!m(n)&&P($l)})}var ha=k(la,2);{var Wl=P=>{var N=Bf(),Z=M(N);Sf(Z,{get wordsPerMinute(){return m(I)},set wordsPerMinute(B){x(I,B)},get fadeEnabled(){return m(z)},set fadeEnabled(B){x(z,B)},get fadeDuration(){return m(U)},set fadeDuration(B){x(U,B)},get pauseOnPunctuation(){return m(O)},set pauseOnPunctuation(B){x(O,B)},get punctuationPauseMultiplier(){return m(j)},set punctuationPauseMultiplier(B){x(j,B)},get wordLengthWPMMultiplier(){return m(ft)},set wordLengthWPMMultiplier(B){x(ft,B)},get pauseAfterWords(){return m(Q)},set pauseAfterWords(B){x(Q,B)},get pauseDuration(){return m(L)},set pauseDuration(B){x(L,B)},get frameWordCount(){return m(l)},set frameWordCount(B){x(l,B)},get orpColor(){return m(Rt)},set orpColor(B){x(Rt,B)},get backgroundColor(){return m(ct)},set backgroundColor(B){x(ct,B)},get wordColor(){return m(tt)},set wordColor(B){x(tt,B)},get readOpacity(){return m(rt)},set readOpacity(B){x(rt,B)},get chapterMode(){return m(ut)},set chapterMode(B){x(ut,B)},$$events:{close:()=>x(g,!1)},$$legacy:!0}),$(P,N)};st(ha,P=>{m(g)&&!m(n)&&P(Wl)})}var ca=k(ha,2);{var Vl=P=>{var N=Uf(),Z=M(N),B=k(M(Z),4),Tt=M(B);Ea(Tt);var Pt=k(Tt,2),ae=M(Pt),pe=k(B,2),se=M(pe),Wt=k(se,2),ge=k(Wt,2),ks=k(ge,2);be(Tt,()=>m(A),on=>x(A,on)),q("click",ae,()=>x(_,!1)),q("submit",B,Fa(()=>Ps(m(A)))),q("click",se,()=>Ps("0")),q("click",Wt,()=>Ps("25%")),q("click",ge,()=>Ps("50%")),q("click",ks,()=>Ps("75%")),q("click",N,Ia(()=>x(_,!1))),$(P,N)};st(ca,P=>{m(_)&&!m(n)&&P(Vl)})}var da=k(ca,2);{var Gl=P=>{var N=Hf(),Z=M(N),B=k(M(Z),2),Tt=M(B),Pt=k(B,2),ae=M(Pt),pe=k(Pt,2),se=M(pe),Wt=k(se,2);lt(ge=>{pt(Tt,`You have a saved session at word ${m(S),et(()=>m(S).currentWordIndex)??""} of ${m(S),et(()=>m(S).totalWords)??""}`),pt(ae,`Saved ${ge??""}`)},[()=>(m(S),et(()=>new Date(m(S).savedAt).toLocaleString()))]),q("click",se,es),q("click",Wt,ts),$(P,N)};st(da,P=>{m(E)&&m(S)&&P(Gl)})}var ua=k(da,2);{var ql=P=>{var N=zf(),Z=M(N),B=k(M(Z),2),Tt=M(B),Pt=k(B,2),ae=M(Pt);Ea(ae);var pe=k(ae,2),se=M(pe),Wt=k(se,2);lt(ge=>{pt(Tt,`Mark word ${m(u)??""} of ${m(d),et(()=>m(d).length)??""} as the start of a new chapter`),Wt.disabled=ge},[()=>(m(R),et(()=>!m(R).trim()))]),be(ae,()=>m(R),ge=>x(R,ge)),q("click",se,()=>x(D,!1)),q("submit",Pt,Fa(Wn)),q("click",N,Ia(()=>x(D,!1))),$(P,N)};st(ua,P=>{m(D)&&!m(n)&&P(ql)})}var qn=k(ua,2),Xl=M(qn);{let P=Ds(()=>m(l)>1);qu(Xl,{get word(){return m(e)},get wordGroup(){return m(s),et(()=>m(s).subset)},get highlightIndex(){return m(s),et(()=>m(s).centerOffset)},get opacity(){return m(Et)},get fadeDuration(){return m(U)},get fadeEnabled(){return m(z)},get multiWordEnabled(){return m(P)},get orpColor(){return m(Rt)},get wordColor(){return m(tt)},get highlightColor(){return m(Rt)}})}var fa=k(qn,2);let pa;var ga=M(fa);{let P=Ds(()=>!m(f));kf(ga,{get progress(){return m(v)},get currentWord(){return m(u)},get totalWords(){return m(d),et(()=>m(d).length)},get wpm(){return m(I)},get timeRemaining(){return m(i)},get minimal(){return m(n)},get clickable(){return m(P)},$$events:{seek:Vn}})}var ma=k(ga,2),Yl=M(ma);{let P=Ds(()=>(m(d),et(()=>m(d).length>0))),N=Ds(()=>(m(C),et(()=>m(C).length>0)));uf(Yl,{get isPlaying(){return m(f)},get isPaused(){return m(p)},get canPlay(){return m(P)},get minimal(){return m(n)},get chapterMode(){return m(ut)},get hasChapters(){return m(N)},$$events:{play:yt,pause:ee,resume:de,stop:$t,restart:ue,nextChapter:ss,previousChapter:Ts}})}var Kl=k(ma,2);{var Jl=P=>{var N=jf(),Z=k(ne(N),2),B=M(Z),Tt=k(B,2),Pt=k(Tt,2),ae=M(Pt),pe=k(Pt,2),se=k(pe,2);lt(()=>pt(ae,m(I))),q("click",B,()=>x(u,Math.max(0,m(u)-5))),q("click",Tt,()=>x(I,Math.max(50,m(I)-50))),q("click",pe,()=>x(I,Math.min(1e3,m(I)+50))),q("click",se,()=>x(u,Math.min(m(d).length,m(u)+5))),$(P,N)};st(Kl,P=>{m(n)||P(Jl)})}lt(()=>{ra=Bt(Gn,1,"svelte-1n46o8q",null,ra,{"focus-mode":m(n)}),si(qn,`background-color: ${m(ct)??""}; color: ${m(tt)??""};`),pa=Bt(fa,1,"bottom-bar svelte-1n46o8q",null,pa,{minimal:m(n)})}),$(o,Gn),xs()}hc(Wf,{target:document.getElementById("app")});
